{"version":3,"file":"umbraco-media-snapshot2.js","sources":["../../../Client/src/snapshot-dashboard.ts"],"sourcesContent":["import { LitElement, html, css, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { svg } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbElementMixin } from '@umbraco-cms/backoffice/element-api';\r\nimport { UmbLocalizationController } from '@umbraco-cms/backoffice/localization-api';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\n\r\ninterface FolderSummary {\r\n    folderName: string;\r\n    mediaKey: string | null;\r\n    mediaName: string | null;\r\n    snapshotCount: number;\r\n    totalSizeBytes: number;\r\n    totalSizeFormatted: string;\r\n    latestSnapshotDate: string | null;\r\n    oldestSnapshotDate: string | null;\r\n}\r\n\r\ninterface SettingsSummary {\r\n    maxSnapshotsPerMedia: number;\r\n    maxSnapshotAgeDays: number;\r\n    enableAutomaticCleanup: boolean;\r\n    sasTokenExpirationHours: number;\r\n    trackedMediaTypes: string[];\r\n    storageQuotaWarningGB: number;\r\n    quotaExceeded: boolean;\r\n    quotaUsagePercent: number | null;\r\n}\r\n\r\ninterface TrendDataPoint {\r\n    date: string;\r\n    count: number;\r\n    sizeBytes: number;\r\n}\r\n\r\ninterface MediaTypeBreakdownItem {\r\n    category: string;\r\n    count: number;\r\n    sizeBytes: number;\r\n    sizeFormatted: string;\r\n    percentage: number;\r\n}\r\n\r\ninterface StorageStats {\r\n    totalSnapshotCount: number;\r\n    totalSizeBytes: number;\r\n    totalSizeFormatted: string;\r\n    mediaItemCount: number;\r\n    topConsumers: FolderSummary[];\r\n    settings: SettingsSummary;\r\n    trendData: TrendDataPoint[];\r\n    mediaTypeBreakdown: MediaTypeBreakdownItem[];\r\n}\r\n\r\n/**\r\n * Snapshot Storage Dashboard\r\n * Displays aggregated storage statistics for all media snapshots\r\n */\r\n@customElement('snapshot-dashboard')\r\nexport class SnapshotDashboardElement extends UmbElementMixin(LitElement) {\r\n\r\n    readonly #localize = new UmbLocalizationController(this);\r\n\r\n    /** Shorthand for localize.term with the package prefix */\r\n    #t(key: string): string {\r\n        return this.#localize.term(`umbracoMediaSnapshot_${key}`);\r\n    }\r\n\r\n    @state()\r\n    private _stats: StorageStats | null = null;\r\n\r\n    @state()\r\n    private _loading = true;\r\n\r\n    @state()\r\n    private _error = '';\r\n\r\n    @state()\r\n    private _trendPeriod: 7 | 30 | 90 = 30;\r\n\r\n    private _authContext?: typeof UMB_AUTH_CONTEXT.TYPE;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.consumeContext(UMB_AUTH_CONTEXT, (instance) => {\r\n            this._authContext = instance;\r\n            this._fetchStats();\r\n        });\r\n    }\r\n\r\n    private async _fetchStats() {\r\n        this._loading = true;\r\n        this._error = '';\r\n\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) {\r\n            this._error = this.#t('noAuthToken');\r\n            this._loading = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch('/umbraco/management/api/v1/snapshot/storage-stats', {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            });\r\n\r\n            if (response.ok) {\r\n                this._stats = await response.json();\r\n            } else if (response.status === 401) {\r\n                this._error = this.#t('dashboardUnauthorized');\r\n            } else {\r\n                this._error = this.#t('dashboardLoadFailed');\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to fetch storage stats:', error);\r\n            this._error = this.#t('dashboardLoadError');\r\n        } finally {\r\n            this._loading = false;\r\n        }\r\n    }\r\n\r\n    private _formatDate(dateString: string | null): string {\r\n        if (!dateString) return '—';\r\n        const date = new Date(dateString);\r\n        return date.toLocaleDateString(undefined, {\r\n            day: '2-digit',\r\n            month: 'short',\r\n            year: 'numeric',\r\n            hour: '2-digit',\r\n            minute: '2-digit'\r\n        });\r\n    }\r\n\r\n    private _renderFolderCell(folder: FolderSummary) {\r\n        if (folder.mediaKey) {\r\n            const href = `/umbraco/section/media/workspace/media/edit/${folder.mediaKey}`;\r\n            const displayName = folder.mediaName || folder.folderName;\r\n            return html`\r\n                <a class=\"media-link\" href=\"${href}\" title=\"${this.#t('dashboardOpenInEditor').replace('{0}', displayName)}\">\r\n                    <uui-icon name=\"icon-picture\"></uui-icon>\r\n                    <span class=\"media-link-name\">${displayName}</span>\r\n                    <code class=\"folder-name-sub\">${folder.folderName}</code>\r\n                </a>\r\n            `;\r\n        }\r\n\r\n        return html`\r\n            <span class=\"folder-unresolved\" title=\"${this.#t('dashboardOrphanedTitle')}\">\r\n                <code class=\"folder-name\">${folder.folderName}</code>\r\n                <uui-tag look=\"secondary\" color=\"warning\">${this.#t('dashboardOrphaned')}</uui-tag>\r\n            </span>\r\n        `;\r\n    }\r\n\r\n    // --- Trend chart helpers ---\r\n\r\n    private _utcDateKey(daysAgo: number): string {\r\n        const d = new Date();\r\n        d.setUTCDate(d.getUTCDate() - daysAgo);\r\n        return d.toISOString().slice(0, 10);\r\n    }\r\n\r\n    private _getTrendDataForPeriod(): TrendDataPoint[] {\r\n        const raw = this._stats?.trendData ?? [];\r\n        const result: TrendDataPoint[] = [];\r\n        const dataMap = new Map(raw.map(d => [d.date, d]));\r\n\r\n        for (let i = this._trendPeriod - 1; i >= 0; i--) {\r\n            const key = this._utcDateKey(i);\r\n            result.push(dataMap.get(key) ?? { date: key, count: 0, sizeBytes: 0 });\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private _formatTrendLabel(dateStr: string): string {\r\n        const [year, month, day] = dateStr.split('-').map(Number);\r\n        const d = new Date(Date.UTC(year, month - 1, day));\r\n        return d.toLocaleDateString(undefined, { day: 'numeric', month: 'short', timeZone: 'UTC' });\r\n    }\r\n\r\n    private _renderTrendChart() {\r\n        const data = this._getTrendDataForPeriod();\r\n        const hasActivity = data.some(d => d.count > 0);\r\n\r\n        if (!hasActivity) {\r\n            return html`\r\n                <div class=\"trend-empty\">\r\n                    <uui-icon name=\"icon-chart\"></uui-icon>\r\n                    <p>${this.#t('dashboardTrendNoData')}</p>\r\n                </div>\r\n            `;\r\n        }\r\n\r\n        const width = 700;\r\n        const height = 220;\r\n        const pad = { top: 24, right: 16, bottom: 44, left: 44 };\r\n        const chartW = width - pad.left - pad.right;\r\n        const chartH = height - pad.top - pad.bottom;\r\n\r\n        const maxVal = Math.max(...data.map(d => d.count), 1);\r\n        const barW = chartW / data.length;\r\n        const gap = Math.max(1, barW * 0.25);\r\n\r\n        const gridLines = [0.25, 0.5, 0.75, 1].map(frac => ({\r\n            y: pad.top + chartH - frac * chartH,\r\n            label: Math.round(frac * maxVal)\r\n        }));\r\n\r\n        const labelInterval = Math.max(1, Math.floor(data.length / 7));\r\n\r\n        return html`\r\n            <svg viewBox=\"0 0 ${width} ${height}\" class=\"trend-svg\" preserveAspectRatio=\"xMidYMid meet\">\r\n                ${svg`\r\n                    <!-- Grid lines -->\r\n                    ${gridLines.map(g => svg`\r\n                        <line x1=\"${pad.left}\" y1=\"${g.y}\" x2=\"${width - pad.right}\" y2=\"${g.y}\" class=\"trend-grid\" />\r\n                        <text x=\"${pad.left - 8}\" y=\"${g.y + 4}\" class=\"trend-axis-label\" text-anchor=\"end\">${g.label}</text>\r\n                    `)}\r\n                    <!-- Baseline -->\r\n                    <line x1=\"${pad.left}\" y1=\"${pad.top + chartH}\" x2=\"${width - pad.right}\" y2=\"${pad.top + chartH}\" class=\"trend-baseline\" />\r\n\r\n                    <!-- Bars -->\r\n                    ${data.map((d, i) => {\r\n                        const barH = maxVal > 0 ? (d.count / maxVal) * chartH : 0;\r\n                        const x = pad.left + i * barW + gap / 2;\r\n                        const y = pad.top + chartH - barH;\r\n                        return svg`\r\n                            <rect\r\n                                x=\"${x}\" y=\"${barH > 0 ? y : pad.top + chartH - 1}\"\r\n                                width=\"${barW - gap}\"\r\n                                height=\"${barH > 0 ? barH : 1}\"\r\n                                class=\"trend-bar ${d.count === 0 ? 'trend-bar-zero' : ''}\"\r\n                                rx=\"2\">\r\n                                <title>${d.count} ${this.#t('snapshots')} — ${this._formatTrendLabel(d.date)}</title>\r\n                            </rect>\r\n                        `;\r\n                    })}\r\n\r\n                    <!-- X-axis labels -->\r\n                    ${data.map((d, i) => {\r\n                        const isRegular = i % labelInterval === 0;\r\n                        const isLast = i === data.length - 1;\r\n                        // Skip the forced last label if it's too close to the previous regular one\r\n                        if (!isRegular && !isLast) return svg``;\r\n                        if (isLast && !isRegular && (data.length - 1) % labelInterval < labelInterval / 2) return svg``;\r\n                        const x = pad.left + i * barW + barW / 2;\r\n                        return svg`\r\n                            <text x=\"${x}\" y=\"${height - 8}\" class=\"trend-axis-label\" text-anchor=\"middle\">\r\n                                ${this._formatTrendLabel(d.date)}\r\n                            </text>\r\n                        `;\r\n                    })}\r\n                `}}\r\n            </svg>\r\n        `;\r\n    }\r\n\r\n    // --- Media type breakdown helpers ---\r\n\r\n    /** Maps an API category name to a localised label */\r\n    private _getCategoryLabel(category: string): string {\r\n        const key = `dashboardMediaType${category}`;\r\n        return this.#t(key);\r\n    }\r\n\r\n    /** Maps an API category to an Umbraco icon name */\r\n    private _getCategoryIcon(category: string): string {\r\n        switch (category) {\r\n            case 'Image': return 'icon-picture';\r\n            case 'Video': return 'icon-video';\r\n            case 'Audio': return 'icon-sound-waves';\r\n            case 'Document': return 'icon-document';\r\n            default: return 'icon-folder';\r\n        }\r\n    }\r\n\r\n    /** Maps an API category to a CSS color for the breakdown chart */\r\n    private _getCategoryColor(category: string): string {\r\n        switch (category) {\r\n            case 'Image': return '#3544b1';\r\n            case 'Video': return '#2bc37c';\r\n            case 'Audio': return '#f0a30a';\r\n            case 'Document': return '#8b5cf6';\r\n            default: return '#6b7280';\r\n        }\r\n    }\r\n\r\n    /** Renders the media type breakdown section */\r\n    private _renderMediaTypeBreakdown() {\r\n        const items = this._stats?.mediaTypeBreakdown ?? [];\r\n\r\n        if (items.length === 0) {\r\n            return html``;\r\n        }\r\n\r\n        return html`\r\n            <uui-box>\r\n                <div class=\"breakdown-section\">\r\n                    <h3>\r\n                        <uui-icon name=\"icon-categories\"></uui-icon>\r\n                        ${this.#t('dashboardMediaTypeTitle')}\r\n                    </h3>\r\n\r\n                    <!-- Stacked bar -->\r\n                    <div class=\"breakdown-bar\">\r\n                        ${items.map(item => html`\r\n                            <div\r\n                                class=\"breakdown-bar-segment\"\r\n                                style=\"width: ${Math.max(item.percentage, 0.5)}%; background: ${this._getCategoryColor(item.category)};\"\r\n                                title=\"${this._getCategoryLabel(item.category)}: ${item.sizeFormatted} (${item.percentage}%)\">\r\n                            </div>\r\n                        `)}\r\n                    </div>\r\n\r\n                    <!-- Legend table -->\r\n                    <div class=\"breakdown-legend\">\r\n                        ${items.map(item => html`\r\n                            <div class=\"breakdown-row\">\r\n                                <div class=\"breakdown-row-label\">\r\n                                    <span class=\"breakdown-swatch\" style=\"background: ${this._getCategoryColor(item.category)};\"></span>\r\n                                    <uui-icon name=\"${this._getCategoryIcon(item.category)}\"></uui-icon>\r\n                                    <span>${this._getCategoryLabel(item.category)}</span>\r\n                                </div>\r\n                                <div class=\"breakdown-row-stats\">\r\n                                    <span class=\"breakdown-count\">${item.count.toLocaleString()}</span>\r\n                                    <span class=\"breakdown-size\">${item.sizeFormatted}</span>\r\n                                    <span class=\"breakdown-pct\">${item.percentage}%</span>\r\n                                </div>\r\n                            </div>\r\n                        `)}\r\n                    </div>\r\n                </div>\r\n            </uui-box>\r\n        `;\r\n    }\r\n\r\n    // --- Quota warning ---\r\n\r\n    /** Renders a warning or danger banner when storage quota is approaching or exceeded */\r\n    private _renderQuotaWarning() {\r\n        const settings = this._stats?.settings;\r\n        if (!settings || settings.storageQuotaWarningGB <= 0 || settings.quotaUsagePercent === null) {\r\n            return html``;\r\n        }\r\n\r\n        const pct = settings.quotaUsagePercent;\r\n        const quotaGB = settings.storageQuotaWarningGB;\r\n        const usedFormatted = this._stats!.totalSizeFormatted;\r\n\r\n        if (pct < 80) {\r\n            return html``;\r\n        }\r\n\r\n        const isDanger = pct >= 100;\r\n\r\n        return html`\r\n            <div class=\"quota-banner ${isDanger ? 'quota-danger' : 'quota-warning'}\">\r\n                <uui-icon name=\"${isDanger ? 'icon-alert' : 'icon-info'}\"></uui-icon>\r\n                <div class=\"quota-banner-content\">\r\n                    <strong>${isDanger ? this.#t('dashboardQuotaExceeded') : this.#t('dashboardQuotaWarning')}</strong>\r\n                    <span>${this.#t('dashboardQuotaUsage').replace('{0}', usedFormatted).replace('{1}', `${quotaGB} GB`).replace('{2}', `${pct}`)}</span>\r\n                </div>\r\n                <div class=\"quota-bar-track\">\r\n                    <div class=\"quota-bar-fill ${isDanger ? 'quota-bar-danger' : 'quota-bar-warn'}\"\r\n                         style=\"width: ${Math.min(pct, 100)}%;\">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    render() {\r\n        if (this._loading) {\r\n            return html`\r\n                <div class=\"dashboard-loading\">\r\n                    <uui-loader></uui-loader>\r\n                    ${this.#t('dashboardLoading')}\r\n                </div>\r\n            `;\r\n        }\r\n\r\n        if (this._error) {\r\n            return html`\r\n                <uui-box>\r\n                    <div class=\"dashboard-error\">\r\n                        <uui-icon name=\"icon-alert\"></uui-icon>\r\n                        <span>${this._error}</span>\r\n                        <uui-button look=\"primary\" compact @click=\"${this._fetchStats}\">\r\n                            <uui-icon name=\"icon-refresh\"></uui-icon> ${this.#t('dashboardRetry')}\r\n                        </uui-button>\r\n                    </div>\r\n                </uui-box>\r\n            `;\r\n        }\r\n\r\n        const stats = this._stats!;\r\n        const hours = stats.settings.sasTokenExpirationHours;\r\n\r\n        return html`\r\n            <div class=\"dashboard\">\r\n                <div class=\"dashboard-header\">\r\n                    <div>\r\n                        <h2>\r\n                            <uui-icon name=\"icon-history\"></uui-icon>\r\n                            ${this.#t('dashboardTitle')}\r\n                        </h2>\r\n                        <p class=\"dashboard-subtitle\">${this.#t('dashboardSubtitle')}</p>\r\n                    </div>\r\n                    <uui-button look=\"secondary\" compact @click=\"${this._fetchStats}\">\r\n                        <uui-icon name=\"icon-refresh\"></uui-icon> ${this.#t('dashboardRefresh')}\r\n                    </uui-button>\r\n                </div>\r\n\r\n                <!-- Quota Warning -->\r\n                ${this._renderQuotaWarning()}\r\n\r\n                <!-- Summary Cards -->\r\n                <div class=\"stats-grid\">\r\n                    <uui-box>\r\n                        <div class=\"stat-card\">\r\n                            <div class=\"stat-icon\" style=\"color: var(--uui-color-primary);\">\r\n                                <uui-icon name=\"icon-documents\"></uui-icon>\r\n                            </div>\r\n                            <div class=\"stat-content\">\r\n                                <span class=\"stat-value\">${stats.totalSnapshotCount.toLocaleString()}</span>\r\n                                <span class=\"stat-label\">${this.#t('dashboardTotalSnapshots')}</span>\r\n                            </div>\r\n                        </div>\r\n                    </uui-box>\r\n                    <uui-box>\r\n                        <div class=\"stat-card\">\r\n                            <div class=\"stat-icon\" style=\"color: var(--uui-color-positive);\">\r\n                                <uui-icon name=\"icon-server\"></uui-icon>\r\n                            </div>\r\n                            <div class=\"stat-content\">\r\n                                <span class=\"stat-value\">${stats.totalSizeFormatted}</span>\r\n                                <span class=\"stat-label\">${this.#t('dashboardTotalStorage')}</span>\r\n                            </div>\r\n                        </div>\r\n                    </uui-box>\r\n                    <uui-box>\r\n                        <div class=\"stat-card\">\r\n                            <div class=\"stat-icon\" style=\"color: var(--uui-color-warning);\">\r\n                                <uui-icon name=\"icon-pictures-alt-2\"></uui-icon>\r\n                            </div>\r\n                            <div class=\"stat-content\">\r\n                                <span class=\"stat-value\">${stats.mediaItemCount.toLocaleString()}</span>\r\n                                <span class=\"stat-label\">${this.#t('dashboardMediaItems')}</span>\r\n                            </div>\r\n                        </div>\r\n                    </uui-box>\r\n                    <uui-box>\r\n                        <div class=\"stat-card\">\r\n                            <div class=\"stat-icon\" style=\"color: var(--uui-color-text-alt);\">\r\n                                <uui-icon name=\"icon-chart\"></uui-icon>\r\n                            </div>\r\n                            <div class=\"stat-content\">\r\n                                <span class=\"stat-value\">\r\n                                    ${stats.totalSnapshotCount > 0 && stats.mediaItemCount > 0\r\n                                        ? (stats.totalSnapshotCount / stats.mediaItemCount).toFixed(1)\r\n                                        : '0'}\r\n                                </span>\r\n                                <span class=\"stat-label\">${this.#t('dashboardAvgSnapshots')}</span>\r\n                            </div>\r\n                        </div>\r\n                    </uui-box>\r\n                </div>\r\n\r\n                <!-- Trend Chart -->\r\n                <uui-box>\r\n                    <div class=\"trend-section\">\r\n                        <div class=\"trend-header\">\r\n                            <h3>\r\n                                <uui-icon name=\"icon-chart\"></uui-icon>\r\n                                ${this.#t('dashboardTrendTitle')}\r\n                            </h3>\r\n                            <div class=\"trend-period-selector\">\r\n                                <uui-button look=\"${this._trendPeriod === 7 ? 'primary' : 'secondary'}\" compact\r\n                                    @click=\"${() => this._trendPeriod = 7}\">${this.#t('dashboardTrend7Days')}</uui-button>\r\n                                <uui-button look=\"${this._trendPeriod === 30 ? 'primary' : 'secondary'}\" compact\r\n                                    @click=\"${() => this._trendPeriod = 30}\">${this.#t('dashboardTrend30Days')}</uui-button>\r\n                                <uui-button look=\"${this._trendPeriod === 90 ? 'primary' : 'secondary'}\" compact\r\n                                    @click=\"${() => this._trendPeriod = 90}\">${this.#t('dashboardTrend90Days')}</uui-button>\r\n                            </div>\r\n                        </div>\r\n                        ${this._renderTrendChart()}\r\n                    </div>\r\n                </uui-box>\r\n\r\n                <!-- Media Type Breakdown -->\r\n                ${this._renderMediaTypeBreakdown()}\r\n\r\n                <!-- Top Consumers -->\r\n                <uui-box headline=\"${this.#t('dashboardTopConsumers')}\">\r\n                    ${stats.topConsumers.length === 0\r\n                        ? html`\r\n                            <div class=\"empty-state\">\r\n                                <uui-icon name=\"icon-folder\" style=\"font-size: 2rem; color: var(--uui-color-text-alt);\"></uui-icon>\r\n                                <p>${this.#t('dashboardNoSnapshots')}</p>\r\n                            </div>\r\n                        `\r\n                        : html`\r\n                            <uui-table>\r\n                                <uui-table-head>\r\n                                    <uui-table-head-cell style=\"width: 40px;\">#</uui-table-head-cell>\r\n                                    <uui-table-head-cell>${this.#t('dashboardMediaItem')}</uui-table-head-cell>\r\n                                    <uui-table-head-cell>${this.#t('snapshots')}</uui-table-head-cell>\r\n                                    <uui-table-head-cell>${this.#t('dashboardStorageUsed')}</uui-table-head-cell>\r\n                                    <uui-table-head-cell>${this.#t('dashboardLatestSnapshot')}</uui-table-head-cell>\r\n                                    <uui-table-head-cell>${this.#t('dashboardOldestSnapshot')}</uui-table-head-cell>\r\n                                </uui-table-head>\r\n                                ${stats.topConsumers.map((folder, index) => html`\r\n                                    <uui-table-row>\r\n                                        <uui-table-cell>\r\n                                            <span class=\"rank-badge\">${index + 1}</span>\r\n                                        </uui-table-cell>\r\n                                        <uui-table-cell>${this._renderFolderCell(folder)}</uui-table-cell>\r\n                                        <uui-table-cell>${folder.snapshotCount}</uui-table-cell>\r\n                                        <uui-table-cell>${folder.totalSizeFormatted}</uui-table-cell>\r\n                                        <uui-table-cell>${this._formatDate(folder.latestSnapshotDate)}</uui-table-cell>\r\n                                        <uui-table-cell>${this._formatDate(folder.oldestSnapshotDate)}</uui-table-cell>\r\n                                    </uui-table-row>\r\n                                `)}\r\n                            </uui-table>\r\n                        `\r\n                    }\r\n                </uui-box>\r\n\r\n                <!-- Current Settings -->\r\n                <uui-box headline=\"${this.#t('dashboardActiveConfig')}\">\r\n                    <div class=\"settings-grid\">\r\n                        <div class=\"setting-item\">\r\n                            <span class=\"setting-label\">${this.#t('dashboardMaxPerMedia')}</span>\r\n                            <span class=\"setting-value\">\r\n                                ${stats.settings.maxSnapshotsPerMedia === 0\r\n                                    ? html`<uui-tag look=\"secondary\">${this.#t('dashboardUnlimited')}</uui-tag>`\r\n                                    : stats.settings.maxSnapshotsPerMedia}\r\n                            </span>\r\n                        </div>\r\n                        <div class=\"setting-item\">\r\n                            <span class=\"setting-label\">${this.#t('dashboardMaxAge')}</span>\r\n                            <span class=\"setting-value\">\r\n                                ${stats.settings.maxSnapshotAgeDays === 0\r\n                                    ? html`<uui-tag look=\"secondary\">${this.#t('dashboardNeverExpires')}</uui-tag>`\r\n                                    : `${stats.settings.maxSnapshotAgeDays} ${this.#t('dashboardDays')}`}\r\n                            </span>\r\n                        </div>\r\n                        <div class=\"setting-item\">\r\n                            <span class=\"setting-label\">${this.#t('dashboardAutoCleanup')}</span>\r\n                            <span class=\"setting-value\">\r\n                                ${stats.settings.enableAutomaticCleanup\r\n                                    ? html`<uui-tag look=\"primary\" color=\"positive\">${this.#t('dashboardEnabled')}</uui-tag>`\r\n                                    : html`<uui-tag look=\"primary\" color=\"danger\">${this.#t('dashboardDisabled')}</uui-tag>`}\r\n                            </span>\r\n                        </div>\r\n                        <div class=\"setting-item\">\r\n                            <span class=\"setting-label\">${this.#t('dashboardSasExpiration')}</span>\r\n                            <span class=\"setting-value\">${hours} ${hours !== 1 ? this.#t('dashboardHours') : this.#t('dashboardHour')}</span>\r\n                        </div>\r\n                        <div class=\"setting-item\">\r\n                            <span class=\"setting-label\">${this.#t('dashboardTrackedTypes')}</span>\r\n                            <span class=\"setting-value setting-value-tags\">\r\n                                ${stats.settings.trackedMediaTypes.map(t => html`\r\n                                    <uui-tag look=\"primary\">${t}</uui-tag>\r\n                                `)}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                </uui-box>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    static styles = css`\r\n        :host {\r\n            display: block;\r\n            padding: var(--uui-size-space-5);\r\n        }\r\n\r\n        .dashboard {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-5);\r\n            max-width: 1200px;\r\n        }\r\n\r\n        .dashboard-loading {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-3);\r\n            padding: var(--uui-size-space-6);\r\n            color: var(--uui-color-text-alt);\r\n            font-size: 1rem;\r\n        }\r\n\r\n        .dashboard-error {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-3);\r\n            color: var(--uui-color-danger);\r\n        }\r\n\r\n        .dashboard-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: flex-start;\r\n        }\r\n\r\n        .dashboard-header h2 {\r\n            margin: 0;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n            font-size: 1.5rem;\r\n        }\r\n\r\n        .dashboard-subtitle {\r\n            margin: var(--uui-size-space-2) 0 0 0;\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        .stats-grid {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\r\n            gap: var(--uui-size-space-4);\r\n        }\r\n\r\n        .stat-card {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-4);\r\n            padding: var(--uui-size-space-2);\r\n        }\r\n\r\n        .stat-icon { font-size: 2rem; flex-shrink: 0; }\r\n        .stat-content { display: flex; flex-direction: column; }\r\n        .stat-value { font-size: 1.6rem; font-weight: 700; line-height: 1.2; }\r\n        .stat-label { font-size: 0.85rem; color: var(--uui-color-text-alt); margin-top: 2px; }\r\n\r\n        /* Trend chart */\r\n        .trend-section { display: flex; flex-direction: column; gap: var(--uui-size-space-4); }\r\n        .trend-header { display: flex; justify-content: space-between; align-items: center; }\r\n        .trend-header h3 { margin: 0; font-size: 1.1rem; display: flex; align-items: center; gap: var(--uui-size-space-2); }\r\n        .trend-period-selector { display: flex; gap: 4px; }\r\n        .trend-svg { width: 100%; height: auto; max-height: 240px; }\r\n        .trend-bar { fill: var(--uui-color-primary); opacity: 0.85; transition: opacity 0.15s; }\r\n        .trend-bar:hover { opacity: 1; cursor: pointer; }\r\n        .trend-bar-zero { fill: var(--uui-color-border); opacity: 0.3; }\r\n        .trend-grid { stroke: var(--uui-color-border); stroke-width: 1; stroke-dasharray: 4 3; }\r\n        .trend-baseline { stroke: var(--uui-color-border); stroke-width: 1; }\r\n        .trend-axis-label { fill: var(--uui-color-text-alt); font-size: 10px; font-family: inherit; }\r\n        .trend-empty { display: flex; flex-direction: column; align-items: center; gap: var(--uui-size-space-3); padding: var(--uui-size-space-6); color: var(--uui-color-text-alt); }\r\n        .trend-empty uui-icon { font-size: 2rem; opacity: 0.4; }\r\n\r\n        /* Media type breakdown */\r\n        .breakdown-section {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-4);\r\n        }\r\n\r\n        .breakdown-section h3 {\r\n            margin: 0;\r\n            font-size: 1.1rem;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .breakdown-bar {\r\n            display: flex;\r\n            height: 24px;\r\n            border-radius: var(--uui-border-radius);\r\n            overflow: hidden;\r\n            gap: 2px;\r\n        }\r\n\r\n        .breakdown-bar-segment {\r\n            min-width: 4px;\r\n            transition: opacity 0.15s;\r\n        }\r\n\r\n        .breakdown-bar-segment:hover {\r\n            opacity: 0.8;\r\n        }\r\n\r\n        .breakdown-legend {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .breakdown-row {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            padding: var(--uui-size-space-2) var(--uui-size-space-3);\r\n            border-radius: var(--uui-border-radius);\r\n            transition: background 0.15s;\r\n        }\r\n\r\n        .breakdown-row:hover {\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .breakdown-row-label {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n            font-weight: 500;\r\n        }\r\n\r\n        .breakdown-swatch {\r\n            width: 12px;\r\n            height: 12px;\r\n            border-radius: 3px;\r\n            flex-shrink: 0;\r\n        }\r\n\r\n        .breakdown-row-stats {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-4);\r\n            font-size: 0.85rem;\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        .breakdown-count { min-width: 50px; text-align: right; }\r\n        .breakdown-size { min-width: 70px; text-align: right; font-weight: 600; color: var(--uui-color-text); }\r\n        .breakdown-pct { min-width: 45px; text-align: right; font-weight: 600; }\r\n\r\n        /* Top consumers table */\r\n        uui-table { border: 1px solid var(--uui-color-border); border-radius: var(--uui-border-radius); background: var(--uui-color-surface); }\r\n        uui-table-head-cell { font-weight: bold; }\r\n        .rank-badge { display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 50%; background: var(--uui-color-surface-alt); border: 1px solid var(--uui-color-border); font-size: 0.8rem; font-weight: 600; }\r\n        .folder-name { font-family: monospace; font-size: 0.85rem; background: var(--uui-color-surface-alt); padding: 2px 6px; border-radius: 3px; }\r\n        .media-link { display: flex; align-items: center; gap: var(--uui-size-space-2); color: var(--uui-color-interactive); text-decoration: none; transition: color 0.2s; }\r\n        .media-link:hover { color: var(--uui-color-interactive-emphasis); text-decoration: underline; }\r\n        .media-link uui-icon { color: var(--uui-color-primary); flex-shrink: 0; }\r\n        .media-link-name { font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\r\n        .folder-name-sub { font-family: monospace; font-size: 0.75rem; color: var(--uui-color-text-alt); background: var(--uui-color-surface-alt); padding: 1px 4px; border-radius: 3px; flex-shrink: 0; }\r\n        .folder-unresolved { display: flex; align-items: center; gap: var(--uui-size-space-2); }\r\n        .empty-state { display: flex; flex-direction: column; align-items: center; gap: var(--uui-size-space-3); padding: var(--uui-size-space-6); color: var(--uui-color-text-alt); }\r\n\r\n        /* Settings grid */\r\n        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: var(--uui-size-space-4); }\r\n        .setting-item { display: flex; flex-direction: column; gap: var(--uui-size-space-1); padding: var(--uui-size-space-3); background: var(--uui-color-surface-alt); border-radius: var(--uui-border-radius); }\r\n        .setting-label { font-size: 0.8rem; color: var(--uui-color-text-alt); text-transform: uppercase; letter-spacing: 0.5px; }\r\n        .setting-value { font-size: 1.1rem; font-weight: 600; }\r\n        .setting-value-tags { display: flex; flex-wrap: wrap; gap: 4px; font-size: 0.85rem; }\r\n\r\n        /* Quota warning banner */\r\n        .quota-banner {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-3);\r\n            padding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n            border-radius: var(--uui-border-radius);\r\n            font-size: 0.9rem;\r\n        }\r\n\r\n        .quota-warning {\r\n            background: #fef3cd;\r\n            border: 1px solid #f0a30a;\r\n            color: #664d03;\r\n        }\r\n\r\n        .quota-danger {\r\n            background: #f8d7da;\r\n            border: 1px solid #dc3545;\r\n            color: #842029;\r\n        }\r\n\r\n        .quota-banner uui-icon {\r\n            font-size: 1.3rem;\r\n            flex-shrink: 0;\r\n        }\r\n\r\n        .quota-banner-content {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: 2px;\r\n            flex: 1;\r\n        }\r\n\r\n        .quota-bar-track {\r\n            width: 120px;\r\n            height: 8px;\r\n            background: rgba(0, 0, 0, 0.1);\r\n            border-radius: 4px;\r\n            overflow: hidden;\r\n            flex-shrink: 0;\r\n        }\r\n\r\n        .quota-bar-fill {\r\n            height: 100%;\r\n            border-radius: 4px;\r\n            transition: width 0.3s;\r\n        }\r\n\r\n        .quota-bar-warn {\r\n            background: #f0a30a;\r\n        }\r\n\r\n        .quota-bar-danger {\r\n            background: #dc3545;\r\n        }\r\n\r\n        @media (max-width: 768px) {\r\n            .stats-grid { grid-template-columns: repeat(2, 1fr); }\r\n            .settings-grid { grid-template-columns: 1fr; }\r\n            .dashboard-header { flex-direction: column; gap: var(--uui-size-space-3); }\r\n            .trend-header { flex-direction: column; gap: var(--uui-size-space-3); align-items: flex-start; }\r\n            .breakdown-row-stats { gap: var(--uui-size-space-2); }\r\n        }\r\n    `;\r\n}\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'snapshot-dashboard': SnapshotDashboardElement;\r\n    }\r\n}"],"names":["_localize","_SnapshotDashboardElement_instances","t_fn","SnapshotDashboardElement","UmbElementMixin","LitElement","__privateAdd","UmbLocalizationController","UMB_AUTH_CONTEXT","instance","token","__privateMethod","response","error","dateString","folder","href","displayName","html","daysAgo","d","raw","result","dataMap","i","key","dateStr","year","month","day","data","width","height","pad","chartW","chartH","maxVal","barW","gap","gridLines","frac","labelInterval","svg","g","barH","x","y","isRegular","isLast","category","items","item","settings","pct","quotaGB","usedFormatted","isDanger","stats","hours","index","t","__privateGet","css","__decorateClass","state","customElement"],"mappings":"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"}