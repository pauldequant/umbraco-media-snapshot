{"version":3,"file":"umbraco-media-snapshot.js","sources":["../../../Client/src/snapshot-viewer.ts"],"sourcesContent":["import { LitElement, html, css, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbElementMixin } from '@umbraco-cms/backoffice/element-api';\r\nimport { UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_NOTIFICATION_CONTEXT } from '@umbraco-cms/backoffice/notification';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_CONFIRM_MODAL } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbEntityWorkspaceContext } from '@umbraco-cms/backoffice/workspace';\r\nimport type { UmbNotificationContext } from '@umbraco-cms/backoffice/notification';\r\nimport type { UmbModalManagerContext } from '@umbraco-cms/backoffice/modal';\r\n\r\n/**\r\n * Snapshot Viewer Property Editor\r\n * Displays a list of file versions from the umbraco-snapshots Azure container\r\n */\r\n@customElement('snapshot-viewer')\r\nexport class SnapshotViewerElement extends UmbElementMixin(LitElement) {\r\n\r\n    @state()\r\n    private _versions: any[] = [];\r\n\r\n    @state()\r\n    private _loading = true;\r\n\r\n    @state()\r\n    private _mediaKey = '';\r\n\r\n    @state()\r\n    private _previewImageUrl: string | null = null;\r\n\r\n    @state()\r\n    private _previewImageName: string = '';\r\n\r\n    @state()\r\n    private _showPreview = false;\r\n\r\n    @state()\r\n    private _isRestoring = false;\r\n\r\n    @state()\r\n    private _currentPage = 1;\r\n\r\n    // --- Comparison state ---\r\n    @state()\r\n    private _showComparison = false;\r\n\r\n    @state()\r\n    private _comparisonSnapshot: any = null;\r\n\r\n    @state()\r\n    private _comparisonCurrent: any = null;\r\n\r\n    @state()\r\n    private _comparisonLoading = false;\r\n\r\n    @state()\r\n    private _comparisonMode: 'side-by-side' | 'slider' = 'side-by-side';\r\n\r\n    @state()\r\n    private _sliderPosition = 50;\r\n\r\n    // --- Delete / selection state ---\r\n    @state()\r\n    private _selectedSnapshots: Set<string> = new Set();\r\n\r\n    @state()\r\n    private _isDeleting = false;\r\n\r\n    // --- Note editing state ---\r\n    @state()\r\n    private _editingNoteName: string | null = null;\r\n\r\n    @state()\r\n    private _editingNoteValue: string = '';\r\n\r\n    @state()\r\n    private _savingNote = false;\r\n\r\n    private _pageSize = 10;\r\n\r\n    private _authContext?: typeof UMB_AUTH_CONTEXT.TYPE;\r\n    private _notificationContext?: UmbNotificationContext;\r\n    private _modalManagerContext?: UmbModalManagerContext;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        // 1. Consume the Auth Context to manage tokens\r\n        this.consumeContext(UMB_AUTH_CONTEXT, (instance) => {\r\n            this._authContext = instance;\r\n        });\r\n\r\n        // Consume the Notification Context\r\n        this.consumeContext(UMB_NOTIFICATION_CONTEXT, (instance) => {\r\n            this._notificationContext = instance;\r\n        });\r\n\r\n        // Consume the Modal Manager Context\r\n        this.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => {\r\n            this._modalManagerContext = instance;\r\n        });\r\n\r\n        this.consumeContext(UMB_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n            const entityWorkspace = workspaceContext as unknown as UmbEntityWorkspaceContext;\r\n            if (entityWorkspace.unique) {\r\n                this.observe(entityWorkspace.unique, (unique) => {\r\n                    if (unique && unique !== this._mediaKey) {\r\n                        this._mediaKey = unique.toString();\r\n                        this._currentPage = 1;\r\n                        this._fetchVersions(this._mediaKey);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Calls the C# Management API to get the list of blobs\r\n     * Umbraco 17 automatically injects Auth Bearer tokens into fetch \r\n     * requests starting with /umbraco/management/api/\r\n     */\r\n    private async _fetchVersions(mediaKey: string) {\r\n        this._loading = true;\r\n\r\n        // 2. Get the latest token from the auth context\r\n        const token = await this._authContext?.getLatestToken();\r\n\r\n        if (!token) {\r\n            console.error(\"No authentication token available.\");\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Authentication Error', message: 'No authentication token available.' } \r\n            });\r\n            this._loading = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const url = `/umbraco/management/api/v1/snapshot/versions/${mediaKey}`;\r\n\r\n            // 3. Manually add the Authorization header\r\n            const response = await fetch(url, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            });\r\n\r\n            if (response.ok) {\r\n                this._versions = await response.json();\r\n                // Clear selection when versions are refreshed\r\n                this._selectedSnapshots = new Set();\r\n            } else if (response.status === 401) {\r\n                console.error(\"Unauthorized: The session may have expired.\");\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { headline: 'Unauthorized', message: 'The session may have expired.' } \r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch snapshots:\", error);\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Error', message: 'Failed to fetch snapshots.' } \r\n            });\r\n        } finally {\r\n            this._loading = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fetches the current (live) media file metadata and SAS URL\r\n     */\r\n    private async _fetchCurrentMedia(): Promise<any | null> {\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) return null;\r\n\r\n        try {\r\n            const url = `/umbraco/management/api/v1/snapshot/current/${this._mediaKey}`;\r\n            const response = await fetch(url, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            });\r\n\r\n            if (response.ok) {\r\n                return await response.json();\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch current media:\", error);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Opens the comparison panel for a specific snapshot version\r\n     */\r\n    private async _openComparison(snapshotVersion: any) {\r\n        this._comparisonLoading = true;\r\n        this._comparisonSnapshot = snapshotVersion;\r\n        this._showComparison = true;\r\n        this._sliderPosition = 50;\r\n\r\n        const currentMedia = await this._fetchCurrentMedia();\r\n        this._comparisonCurrent = currentMedia;\r\n        this._comparisonLoading = false;\r\n    }\r\n\r\n    /**\r\n     * Closes the comparison panel\r\n     */\r\n    private _closeComparison() {\r\n        this._showComparison = false;\r\n        this._comparisonSnapshot = null;\r\n        this._comparisonCurrent = null;\r\n    }\r\n\r\n    /**\r\n     * Toggles the comparison mode between side-by-side and slider\r\n     */\r\n    private _toggleComparisonMode() {\r\n        this._comparisonMode = this._comparisonMode === 'side-by-side' ? 'slider' : 'side-by-side';\r\n    }\r\n\r\n    /**\r\n     * Handles the slider input for overlay comparison\r\n     */\r\n    private _onSliderInput(e: Event) {\r\n        const input = e.target as HTMLInputElement;\r\n        this._sliderPosition = parseInt(input.value, 10);\r\n    }\r\n\r\n    /**\r\n     * Returns the total number of pages based on versions count and page size\r\n     */\r\n    private get _totalPages(): number {\r\n        return Math.max(1, Math.ceil(this._versions.length / this._pageSize));\r\n    }\r\n\r\n    /**\r\n     * Returns the versions for the current page\r\n     */\r\n    private get _pagedVersions(): any[] {\r\n        const start = (this._currentPage - 1) * this._pageSize;\r\n        return this._versions.slice(start, start + this._pageSize);\r\n    }\r\n\r\n    /**\r\n     * Handles page change from the pagination component\r\n     */\r\n    private _onPageChange(event: Event) {\r\n        const target = event.target as HTMLElement & { current: number };\r\n        this._currentPage = target.current;\r\n    }\r\n\r\n    /**\r\n     * Checks if a filename is an image based on extension\r\n     */\r\n    private _isImage(filename: string): boolean {\r\n        const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp', '.svg'];\r\n        const extension = filename.substring(filename.lastIndexOf('.')).toLowerCase();\r\n        return imageExtensions.includes(extension);\r\n    }\r\n\r\n    /**\r\n     * Opens the image preview panel\r\n     */\r\n    private _openImagePreview(version: any) {\r\n        if (!this._isImage(version.name)) return;\r\n        \r\n        this._previewImageUrl = version.url;\r\n        this._previewImageName = version.name;\r\n        this._showPreview = true;\r\n    }\r\n\r\n    /**\r\n     * Closes the image preview panel\r\n     */\r\n    private _closePreview() {\r\n        this._showPreview = false;\r\n        this._previewImageUrl = null;\r\n        this._previewImageName = '';\r\n    }\r\n\r\n    // --- Selection helpers ---\r\n\r\n    /**\r\n     * Toggles a single snapshot's selection state\r\n     */\r\n    private _toggleSelection(name: string) {\r\n        const updated = new Set(this._selectedSnapshots);\r\n        if (updated.has(name)) {\r\n            updated.delete(name);\r\n        } else {\r\n            updated.add(name);\r\n        }\r\n        this._selectedSnapshots = updated;\r\n    }\r\n\r\n    /**\r\n     * Toggles select-all for the current page (excluding the latest version at index 0)\r\n     */\r\n    private _toggleSelectAll() {\r\n        const pageOffset = (this._currentPage - 1) * this._pageSize;\r\n        const selectableOnPage = this._pagedVersions\r\n            .filter((_, i) => (pageOffset + i) !== 0)\r\n            .map(v => v.name);\r\n\r\n        const allSelected = selectableOnPage.every(name => this._selectedSnapshots.has(name));\r\n        const updated = new Set(this._selectedSnapshots);\r\n\r\n        if (allSelected) {\r\n            // Deselect all on this page\r\n            selectableOnPage.forEach(name => updated.delete(name));\r\n        } else {\r\n            // Select all on this page\r\n            selectableOnPage.forEach(name => updated.add(name));\r\n        }\r\n\r\n        this._selectedSnapshots = updated;\r\n    }\r\n\r\n    /**\r\n     * Whether all selectable items on the current page are selected\r\n     */\r\n    private get _allPageSelected(): boolean {\r\n        const pageOffset = (this._currentPage - 1) * this._pageSize;\r\n        const selectableOnPage = this._pagedVersions\r\n            .filter((_, i) => (pageOffset + i) !== 0);\r\n        return selectableOnPage.length > 0\r\n            && selectableOnPage.every(v => this._selectedSnapshots.has(v.name));\r\n    }\r\n\r\n    /**\r\n     * Clears all selections\r\n     */\r\n    private _clearSelection() {\r\n        this._selectedSnapshots = new Set();\r\n    }\r\n\r\n    // --- Delete operations ---\r\n\r\n    /**\r\n     * Deletes a single snapshot after confirmation\r\n     */\r\n    private async _deleteSnapshot(version: any) {\r\n        if (this._isDeleting) return;\r\n\r\n        if (!this._modalManagerContext) {\r\n            console.error(\"Modal manager context not available\");\r\n            return;\r\n        }\r\n\r\n        const modalHandler = this._modalManagerContext.open(this, UMB_CONFIRM_MODAL, {\r\n            data: {\r\n                headline: 'Delete Snapshot',\r\n                content: html`\r\n                    <p>Are you sure you want to permanently delete <strong>\"${version.name}\"</strong>?</p>\r\n                    <uui-box>\r\n                        <p style=\"margin: 0;\">\r\n                            <uui-icon name=\"icon-alert\"></uui-icon>\r\n                            <strong>Warning:</strong> This action cannot be undone. The snapshot will be permanently removed from storage.\r\n                        </p>\r\n                    </uui-box>\r\n                `,\r\n                color: 'danger',\r\n                confirmLabel: 'Delete'\r\n            }\r\n        });\r\n\r\n        try {\r\n            await modalHandler.onSubmit();\r\n        } catch {\r\n            return;\r\n        }\r\n\r\n        this._isDeleting = true;\r\n\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) {\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Authentication Error', message: 'No authentication token available.' } \r\n            });\r\n            this._isDeleting = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch(`/umbraco/management/api/v1/snapshot/delete`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    mediaKey: this._mediaKey,\r\n                    snapshotName: version.name\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                const result = await response.json();\r\n                this._notificationContext?.peek('positive', { \r\n                    data: { headline: 'Snapshot Deleted', message: result.message } \r\n                });\r\n                await this._fetchVersions(this._mediaKey);\r\n            } else if (response.status === 401) {\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { headline: 'Unauthorized', message: 'Your session may have expired. Please refresh the page.' } \r\n                });\r\n            } else {\r\n                const error = await response.json();\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { headline: 'Delete Failed', message: error.detail || 'Unknown error' } \r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to delete snapshot:\", error);\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Error', message: 'An error occurred while deleting the snapshot.' } \r\n            });\r\n        } finally {\r\n            this._isDeleting = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Deletes all selected snapshots after confirmation\r\n     */\r\n    private async _bulkDeleteSnapshots() {\r\n        if (this._isDeleting || this._selectedSnapshots.size === 0) return;\r\n\r\n        if (!this._modalManagerContext) {\r\n            console.error(\"Modal manager context not available\");\r\n            return;\r\n        }\r\n\r\n        const count = this._selectedSnapshots.size;\r\n        const modalHandler = this._modalManagerContext.open(this, UMB_CONFIRM_MODAL, {\r\n            data: {\r\n                headline: 'Delete Selected Snapshots',\r\n                content: html`\r\n                    <p>Are you sure you want to permanently delete <strong>${count} snapshot${count > 1 ? 's' : ''}</strong>?</p>\r\n                    <uui-box>\r\n                        <p style=\"margin: 0;\">\r\n                            <uui-icon name=\"icon-alert\"></uui-icon>\r\n                            <strong>Warning:</strong> This action cannot be undone. All selected snapshots will be permanently removed from storage.\r\n                        </p>\r\n                    </uui-box>\r\n                `,\r\n                color: 'danger',\r\n                confirmLabel: `Delete ${count} Snapshot${count > 1 ? 's' : ''}`\r\n            }\r\n        });\r\n\r\n        try {\r\n            await modalHandler.onSubmit();\r\n        } catch {\r\n            return;\r\n        }\r\n\r\n        this._isDeleting = true;\r\n\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) {\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Authentication Error', message: 'No authentication token available.' } \r\n            });\r\n            this._isDeleting = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch(`/umbraco/management/api/v1/snapshot/delete-bulk`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    mediaKey: this._mediaKey,\r\n                    snapshotNames: Array.from(this._selectedSnapshots)\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                const result = await response.json();\r\n                this._notificationContext?.peek('positive', { \r\n                    data: { headline: 'Snapshots Deleted', message: result.message } \r\n                });\r\n                await this._fetchVersions(this._mediaKey);\r\n            } else if (response.status === 401) {\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { headline: 'Unauthorized', message: 'Your session may have expired. Please refresh the page.' } \r\n                });\r\n            } else {\r\n                const error = await response.json();\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { headline: 'Bulk Delete Failed', message: error.detail || 'Unknown error' } \r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to bulk delete snapshots:\", error);\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Error', message: 'An error occurred while deleting snapshots.' } \r\n            });\r\n        } finally {\r\n            this._isDeleting = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restores a specific snapshot version as the current file\r\n     */\r\n    private async _restoreVersion(version: any) {\r\n        // Prevent multiple simultaneous restore operations\r\n        if (this._isRestoring) {\r\n            console.warn(\"Restore already in progress\");\r\n            return;\r\n        }\r\n\r\n        if (!this._modalManagerContext) {\r\n            console.error(\"Modal manager context not available\");\r\n            return;\r\n        }\r\n\r\n        // Show Umbraco-styled confirmation modal\r\n        const modalHandler = this._modalManagerContext.open(this, UMB_CONFIRM_MODAL, {\r\n            data: {\r\n                headline: 'Restore File Version',\r\n                content: html`\r\n                    <p>Are you sure you want to restore <strong>\"${version.name}\"</strong>?</p>\r\n                    <p>This will replace the current file and create a new snapshot.</p>\r\n                    <uui-box>\r\n                        <p style=\"margin: 0;\">\r\n                            <uui-icon name=\"icon-alert\"></uui-icon>\r\n                            <strong>Warning:</strong> This action cannot be undone.\r\n                        </p>\r\n                    </uui-box>\r\n                `,\r\n                color: 'danger',\r\n                confirmLabel: 'Restore'\r\n            }\r\n        });\r\n\r\n        // Wait for user to confirm or cancel\r\n        try {\r\n            await modalHandler.onSubmit();\r\n        } catch {\r\n            // User cancelled the modal\r\n            return;\r\n        }\r\n\r\n        // Set the restoring flag\r\n        this._isRestoring = true;\r\n\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) {\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Authentication Error', message: 'No authentication token available.' } \r\n            });\r\n            this._isRestoring = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const url = `/umbraco/management/api/v1/snapshot/restore`;\r\n            const response = await fetch(url, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    mediaKey: this._mediaKey,\r\n                    snapshotName: version.name\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                const result = await response.json();\r\n                \r\n                // Use Umbraco notification instead of alert\r\n                this._notificationContext?.peek('positive', { \r\n                    data: { \r\n                        headline: 'Snapshot Restored', \r\n                        message: result.message \r\n                    } \r\n                });\r\n                \r\n                // Refresh the version list\r\n                await this._fetchVersions(this._mediaKey);\r\n            } else if (response.status === 401) {\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { \r\n                        headline: 'Unauthorized', \r\n                        message: 'Your session may have expired. Please refresh the page.' \r\n                    } \r\n                });\r\n            } else {\r\n                const error = await response.json();\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { \r\n                        headline: 'Restore Failed', \r\n                        message: error.detail || 'Unknown error' \r\n                    } \r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to restore snapshot:\", error);\r\n            this._notificationContext?.peek('danger', { \r\n                data: { \r\n                    headline: 'Error', \r\n                    message: 'An error occurred while restoring the snapshot. Please try again.' \r\n                } \r\n            });\r\n        } finally {\r\n            // Always reset the restoring flag\r\n            this._isRestoring = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Formats a byte count into a human-readable size string\r\n     */\r\n    private _formatSize(bytes: number): string {\r\n        if (bytes === 0) return '0 B';\r\n        const units = ['B', 'KB', 'MB', 'GB'];\r\n        const i = Math.floor(Math.log(bytes) / Math.log(1024));\r\n        return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + units[i];\r\n    }\r\n\r\n    /**\r\n     * Renders a compact inline status badge for a snapshot version\r\n     */\r\n    private _renderStatus(version: any, index: number) {\r\n        if (version.isRestored) {\r\n            return html`<uui-tag class=\"status-badge\" look=\"primary\" color=\"positive\">Restored</uui-tag>`;\r\n        }\r\n        if (index === 0) {\r\n            return html`<uui-tag class=\"status-badge\" look=\"primary\" color=\"default\">Latest</uui-tag>`;\r\n        }\r\n        return html``;\r\n    }\r\n\r\n    /**\r\n     * Renders the comparison panel content\r\n     */\r\n    private _renderComparison() {\r\n        if (!this._showComparison) return '';\r\n\r\n        const snapshot = this._comparisonSnapshot;\r\n        const current = this._comparisonCurrent;\r\n        const bothAreImages = snapshot && current\r\n            && this._isImage(snapshot.name) && this._isImage(current.name);\r\n\r\n        return html`\r\n            <div class=\"preview-overlay\" @click=\"${this._closeComparison}\"></div>\r\n            <div class=\"comparison-panel\">\r\n                <div class=\"preview-header\">\r\n                    <h3>\r\n                        <uui-icon name=\"icon-split\"></uui-icon>\r\n                        Compare Versions\r\n                    </h3>\r\n                    <div style=\"display: flex; gap: 8px; align-items: center;\">\r\n                        ${bothAreImages ? html`\r\n                            <uui-button\r\n                                look=\"secondary\"\r\n                                compact\r\n                                @click=\"${this._toggleComparisonMode}\"\r\n                                title=\"Toggle comparison mode\">\r\n                                <uui-icon name=\"${this._comparisonMode === 'side-by-side' ? 'icon-layers-alt' : 'icon-split'}\"></uui-icon>\r\n                                ${this._comparisonMode === 'side-by-side' ? 'Slider' : 'Side-by-Side'}\r\n                            </uui-button>\r\n                        ` : ''}\r\n                        <uui-button\r\n                            look=\"secondary\"\r\n                            compact\r\n                            @click=\"${this._closeComparison}\">\r\n                            <uui-icon name=\"icon-delete\"></uui-icon>\r\n                        </uui-button>\r\n                    </div>\r\n                </div>\r\n                <div class=\"comparison-content\">\r\n                    ${this._comparisonLoading\r\n                        ? html`<div class=\"loader\"><uui-loader></uui-loader> Loading current file...</div>`\r\n                        : !current\r\n                            ? html`<uui-box><p>Unable to load the current media file for comparison.</p></uui-box>`\r\n                            : bothAreImages\r\n                                ? this._renderImageComparison(current, snapshot)\r\n                                : this._renderMetadataComparison(current, snapshot)\r\n                    }\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Renders a side-by-side or slider image comparison\r\n     */\r\n    private _renderImageComparison(current: any, snapshot: any) {\r\n        if (this._comparisonMode === 'slider') {\r\n            return html`\r\n                <div class=\"slider-comparison\">\r\n                    <div class=\"slider-container\">\r\n                        <img class=\"slider-img-under\" src=\"${current.url}\" alt=\"Current\" />\r\n                        <div class=\"slider-img-over\" style=\"width: ${this._sliderPosition}%;\">\r\n                            <img src=\"${snapshot.url}\" alt=\"Snapshot\" />\r\n                        </div>\r\n                        <div class=\"slider-handle\" style=\"left: ${this._sliderPosition}%;\">\r\n                            <div class=\"slider-handle-line\"></div>\r\n                        </div>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"0\"\r\n                            max=\"100\"\r\n                            .value=\"${String(this._sliderPosition)}\"\r\n                            @input=\"${this._onSliderInput}\"\r\n                            class=\"slider-range\"\r\n                        />\r\n                    </div>\r\n                    <div class=\"slider-labels\">\r\n                        <span><uui-tag look=\"primary\" color=\"default\">Snapshot</uui-tag> ${snapshot.name}</span>\r\n                        <span><uui-tag look=\"primary\" color=\"positive\">Current</uui-tag> ${current.name}</span>\r\n                    </div>\r\n                </div>\r\n                ${this._renderMetadataComparison(current, snapshot)}\r\n            `;\r\n        }\r\n\r\n        return html`\r\n            <div class=\"side-by-side\">\r\n                <div class=\"compare-column\">\r\n                    <div class=\"compare-label\">\r\n                        <uui-tag look=\"primary\" color=\"default\">Snapshot</uui-tag>\r\n                        <span class=\"compare-filename\">${snapshot.name}</span>\r\n                    </div>\r\n                    <div class=\"compare-image-container\">\r\n                        <img src=\"${snapshot.url}\" alt=\"${snapshot.name}\" />\r\n                    </div>\r\n                </div>\r\n                <div class=\"compare-divider\"></div>\r\n                <div class=\"compare-column\">\r\n                    <div class=\"compare-label\">\r\n                        <uui-tag look=\"primary\" color=\"positive\">Current</uui-tag>\r\n                        <span class=\"compare-filename\">${current.name}</span>\r\n                    </div>\r\n                    <div class=\"compare-image-container\">\r\n                        <img src=\"${current.url}\" alt=\"${current.name}\" />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            ${this._renderMetadataComparison(current, snapshot)}\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Renders a metadata diff table comparing the snapshot and current file\r\n     */\r\n    private _renderMetadataComparison(current: any, snapshot: any) {\r\n        const sizeDiff = current.size - snapshot.size;\r\n        const sizeDiffLabel = sizeDiff > 0\r\n            ? `+${this._formatSize(sizeDiff)}`\r\n            : sizeDiff < 0\r\n                ? `-${this._formatSize(Math.abs(sizeDiff))}`\r\n                : 'No change';\r\n\r\n        return html`\r\n            <div class=\"metadata-comparison\">\r\n                <h4>File Details</h4>\r\n                <uui-table>\r\n                    <uui-table-head>\r\n                        <uui-table-head-cell>Property</uui-table-head-cell>\r\n                        <uui-table-head-cell>Snapshot</uui-table-head-cell>\r\n                        <uui-table-head-cell>Current</uui-table-head-cell>\r\n                        <uui-table-head-cell>Difference</uui-table-head-cell>\r\n                    </uui-table-head>\r\n                    <uui-table-row>\r\n                        <uui-table-cell><strong>Filename</strong></uui-table-cell>\r\n                        <uui-table-cell>${snapshot.name}</uui-table-cell>\r\n                        <uui-table-cell>${current.name}</uui-table-cell>\r\n                        <uui-table-cell>\r\n                            ${snapshot.name === current.name\r\n                                ? html`<uui-tag look=\"secondary\" color=\"default\">Same</uui-tag>`\r\n                                : html`<uui-tag look=\"primary\" color=\"warning\">Changed</uui-tag>`\r\n                            }\r\n                        </uui-table-cell>\r\n                    </uui-table-row>\r\n                    <uui-table-row>\r\n                        <uui-table-cell><strong>File Size</strong></uui-table-cell>\r\n                        <uui-table-cell>${this._formatSize(snapshot.size)}</uui-table-cell>\r\n                        <uui-table-cell>${this._formatSize(current.size)}</uui-table-cell>\r\n                        <uui-table-cell>\r\n                            <uui-tag look=\"secondary\" color=\"${sizeDiff === 0 ? 'default' : sizeDiff > 0 ? 'warning' : 'positive'}\">\r\n                                ${sizeDiffLabel}\r\n                            </uui-tag>\r\n                        </uui-table-cell>\r\n                    </uui-table-row>\r\n                    <uui-table-row>\r\n                        <uui-table-cell><strong>Date</strong></uui-table-cell>\r\n                        <uui-table-cell>${this._formatDate(snapshot.date)}</uui-table-cell>\r\n                        <uui-table-cell>${this._formatDate(current.lastModified)}</uui-table-cell>\r\n                        <uui-table-cell></uui-table-cell>\r\n                    </uui-table-row>\r\n                    ${snapshot.uploader ? html`\r\n                        <uui-table-row>\r\n                            <uui-table-cell><strong>Uploaded By</strong></uui-table-cell>\r\n                            <uui-table-cell>${snapshot.uploader.replace(/_/g, ' ')}</uui-table-cell>\r\n                            <uui-table-cell>—</uui-table-cell>\r\n                            <uui-table-cell></uui-table-cell>\r\n                        </uui-table-row>\r\n                    ` : ''}\r\n                </uui-table>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Renders a compact summary stats strip for this media item's snapshots\r\n     */\r\n    private _renderStats() {\r\n        if (this._versions.length === 0) return '';\r\n\r\n        const totalSize = this._versions.reduce((sum, v) => sum + (v.size || 0), 0);\r\n        const dates = this._versions.map(v => new Date(v.date).getTime()).filter(t => !isNaN(t));\r\n        const oldestDate = dates.length > 0 ? new Date(Math.min(...dates)) : null;\r\n        const newestDate = dates.length > 0 ? new Date(Math.max(...dates)) : null;\r\n        const uniqueUploaders = new Set(this._versions.map(v => v.uploader).filter(Boolean));\r\n\r\n        return html`\r\n            <div class=\"stats-strip\">\r\n                <div class=\"stats-strip-item\">\r\n                    <uui-icon name=\"icon-documents\"></uui-icon>\r\n                    <span class=\"stats-strip-value\">${this._versions.length}</span>\r\n                    <span class=\"stats-strip-label\">Snapshot${this._versions.length !== 1 ? 's' : ''}</span>\r\n                </div>\r\n                <div class=\"stats-strip-divider\"></div>\r\n                <div class=\"stats-strip-item\">\r\n                    <uui-icon name=\"icon-server\"></uui-icon>\r\n                    <span class=\"stats-strip-value\">${this._formatSize(totalSize)}</span>\r\n                    <span class=\"stats-strip-label\">Total Size</span>\r\n                </div>\r\n                <div class=\"stats-strip-divider\"></div>\r\n                <div class=\"stats-strip-item\">\r\n                    <uui-icon name=\"icon-calendar\"></uui-icon>\r\n                    <span class=\"stats-strip-value\">${oldestDate ? this._formatDate(oldestDate.toISOString()) : '—'}</span>\r\n                    <span class=\"stats-strip-label\">Oldest</span>\r\n                </div>\r\n                <div class=\"stats-strip-divider\"></div>\r\n                <div class=\"stats-strip-item\">\r\n                    <uui-icon name=\"icon-calendar\"></uui-icon>\r\n                    <span class=\"stats-strip-value\">${newestDate ? this._formatDate(newestDate.toISOString()) : '—'}</span>\r\n                    <span class=\"stats-strip-label\">Latest</span>\r\n                </div>\r\n                <div class=\"stats-strip-divider\"></div>\r\n                <div class=\"stats-strip-item\">\r\n                    <uui-icon name=\"icon-users\"></uui-icon>\r\n                    <span class=\"stats-strip-value\">${uniqueUploaders.size}</span>\r\n                    <span class=\"stats-strip-label\">Contributor${uniqueUploaders.size !== 1 ? 's' : ''}</span>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    render() {\r\n        if (this._loading) {\r\n            return html`<div class=\"loader\"><uui-loader></uui-loader> Fetching snapshots...</div>`;\r\n        }\r\n\r\n        if (this._versions.length === 0) {\r\n            return html`\r\n                <uui-box>\r\n                    <div style=\"display: flex; align-items: center; gap: var(--uui-size-space-3);\">\r\n                        <uui-icon name=\"info\" style=\"color: var(--uui-color-primary);\"></uui-icon>\r\n                        <span>No previous versions found in the snapshots container.</span>\r\n                    </div>\r\n                </uui-box>\r\n            `;\r\n        }\r\n\r\n        const isSingleVersion = this._versions.length === 1;\r\n        const pagedVersions = this._pagedVersions;\r\n        const pageOffset = (this._currentPage - 1) * this._pageSize;\r\n        const hasSelection = this._selectedSnapshots.size > 0;\r\n\r\n        return html`\r\n            <div class=\"snapshot-container\">\r\n\r\n                <!-- Summary stats for this media item -->\r\n                ${this._renderStats()}\r\n\r\n                <!-- Bulk action toolbar -->\r\n                ${hasSelection ? html`\r\n                    <div class=\"bulk-toolbar\">\r\n                        <span class=\"bulk-toolbar-count\">\r\n                            <uui-icon name=\"icon-check\"></uui-icon>\r\n                            ${this._selectedSnapshots.size} snapshot${this._selectedSnapshots.size > 1 ? 's' : ''} selected\r\n                        </span>\r\n                        <div class=\"bulk-toolbar-actions\">\r\n                            <uui-button\r\n                                look=\"secondary\"\r\n                                compact\r\n                                @click=\"${this._clearSelection}\">\r\n                                Clear Selection\r\n                            </uui-button>\r\n                            <uui-button\r\n                                look=\"primary\"\r\n                                color=\"danger\"\r\n                                compact\r\n                                ?disabled=\"${this._isDeleting}\"\r\n                                @click=\"${this._bulkDeleteSnapshots}\">\r\n                                <uui-icon name=\"icon-trash\"></uui-icon>\r\n                                ${this._isDeleting ? 'Deleting...' : `Delete ${this._selectedSnapshots.size} Snapshot${this._selectedSnapshots.size > 1 ? 's' : ''}`}\r\n                            </uui-button>\r\n                        </div>\r\n                    </div>\r\n                ` : ''}\r\n\r\n                <uui-table>\r\n                    <uui-table-head>\r\n                        <uui-table-head-cell style=\"width: 40px;\">\r\n                            <input\r\n                                type=\"checkbox\"\r\n                                .checked=\"${this._allPageSelected}\"\r\n                                @change=\"${this._toggleSelectAll}\"\r\n                                title=\"Select all on this page\"\r\n                                class=\"select-checkbox\"\r\n                            />\r\n                        </uui-table-head-cell>\r\n                        <uui-table-head-cell>Version</uui-table-head-cell>\r\n                        <uui-table-head-cell>Uploaded</uui-table-head-cell>\r\n                        <uui-table-head-cell style=\"text-align: right;\">Actions</uui-table-head-cell>\r\n                    </uui-table-head>\r\n\r\n                    ${pagedVersions.map((v, i) => {\r\n                        const globalIndex = pageOffset + i;\r\n                        const isLatest = globalIndex === 0;\r\n                        const isSelected = this._selectedSnapshots.has(v.name);\r\n\r\n                        return html`\r\n                            <uui-table-row class=\"${isSelected ? 'row-selected' : ''}\">\r\n                                <uui-table-cell style=\"width: 40px;\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        .checked=\"${isSelected}\"\r\n                                        ?disabled=\"${isLatest}\"\r\n                                        @change=\"${() => this._toggleSelection(v.name)}\"\r\n                                        title=\"${isLatest ? 'Cannot select the latest version' : 'Select this snapshot'}\"\r\n                                        class=\"select-checkbox\"\r\n                                    />\r\n                                </uui-table-cell>\r\n\r\n                                <!-- Version: filename + status badge + note -->\r\n                                <uui-table-cell>\r\n                                    <div class=\"version-cell\">\r\n                                        <div class=\"version-cell-primary\">\r\n                                            ${this._isImage(v.name)\r\n                                                ? html`\r\n                                                    <button\r\n                                                        class=\"filename-link\"\r\n                                                        @click=\"${() => this._openImagePreview(v)}\"\r\n                                                        title=\"Click to preview image\">\r\n                                                        <uui-icon name=\"icon-picture\"></uui-icon>\r\n                                                        ${v.name}\r\n                                                    </button>\r\n                                                `\r\n                                                : html`<span class=\"filename-text\">${v.name}</span>`\r\n                                            }\r\n                                            ${this._renderStatus(v, globalIndex)}\r\n                                        </div>\r\n                                        <div class=\"version-cell-secondary\">\r\n                                            ${this._renderNoteCell(v)}\r\n                                        </div>\r\n                                    </div>\r\n                                </uui-table-cell>\r\n\r\n                                <!-- Uploaded: date + uploader stacked -->\r\n                                <uui-table-cell>\r\n                                    <div class=\"upload-cell\">\r\n                                        <span class=\"upload-date\">${this._formatDate(v.date)}</span>\r\n                                        <span class=\"upload-user\">${v.uploader.replace(/_/g, ' ')}</span>\r\n                                    </div>\r\n                                </uui-table-cell>\r\n\r\n                                <!-- Actions: icon-only buttons -->\r\n                                <uui-table-cell>\r\n                                    <div class=\"actions-cell\">\r\n                                        <uui-button\r\n                                            look=\"secondary\"\r\n                                            compact\r\n                                            ?disabled=\"${isLatest}\"\r\n                                            title=\"${isLatest ? 'This is the latest version' : 'Compare with current file'}\"\r\n                                            @click=\"${() => this._openComparison(v)}\">\r\n                                            <uui-icon name=\"icon-split\"></uui-icon>\r\n                                        </uui-button>\r\n                                        <uui-button\r\n                                            look=\"secondary\"\r\n                                            compact\r\n                                            href=\"${v.url}\"\r\n                                            target=\"_blank\"\r\n                                            title=\"Download this version\">\r\n                                            <uui-icon name=\"icon-download-alt\"></uui-icon>\r\n                                        </uui-button>\r\n                                        <uui-button\r\n                                            look=\"primary\"\r\n                                            color=\"positive\"\r\n                                            compact\r\n                                            ?disabled=\"${isSingleVersion || this._isRestoring || isLatest}\"\r\n                                            title=\"${isSingleVersion ? 'Cannot restore when only one version exists' : isLatest ? 'This is already the latest version' : 'Restore this version'}\"\r\n                                            @click=\"${() => this._restoreVersion(v)}\">\r\n                                            <uui-icon name=\"icon-refresh\"></uui-icon>\r\n                                        </uui-button>\r\n                                        <uui-button\r\n                                            look=\"secondary\"\r\n                                            color=\"danger\"\r\n                                            compact\r\n                                            ?disabled=\"${isLatest || this._isDeleting}\"\r\n                                            title=\"${isLatest ? 'Cannot delete the latest version' : 'Delete this snapshot'}\"\r\n                                            @click=\"${() => this._deleteSnapshot(v)}\">\r\n                                            <uui-icon name=\"icon-trash\"></uui-icon>\r\n                                        </uui-button>\r\n                                    </div>\r\n                                </uui-table-cell>\r\n                            </uui-table-row>\r\n                        `;\r\n                    })}\r\n                </uui-table>\r\n\r\n                ${this._totalPages > 1 ? html`\r\n                    <div class=\"pagination-container\">\r\n                        <uui-pagination\r\n                            .current=\"${this._currentPage}\"\r\n                            .total=\"${this._totalPages}\"\r\n                            @change=\"${this._onPageChange}\">\r\n                        </uui-pagination>\r\n                    </div>\r\n                ` : ''}\r\n\r\n                <!-- Image Preview Side Panel -->\r\n                ${this._showPreview ? html`\r\n                    <div class=\"preview-overlay\" @click=\"${this._closePreview}\"></div>\r\n                    <div class=\"preview-panel\">\r\n                        <div class=\"preview-header\">\r\n                            <h3>\r\n                                <uui-icon name=\"icon-picture\"></uui-icon>\r\n                                Image Preview\r\n                            </h3>\r\n                            <uui-button \r\n                                look=\"secondary\" \r\n                                compact\r\n                                @click=\"${this._closePreview}\">\r\n                                <uui-icon name=\"icon-delete\"></uui-icon>\r\n                            </uui-button>\r\n                        </div>\r\n                        <div class=\"preview-content\">\r\n                            <div class=\"preview-filename\">\r\n                                <strong>Filename:</strong> <br/>${this._previewImageName}\r\n                            </div>\r\n                            <div class=\"preview-image-container\">\r\n                                ${this._previewImageUrl \r\n                                    ? html`\r\n                                        <img \r\n                                            src=\"${this._previewImageUrl}\" \r\n                                            alt=\"${this._previewImageName}\"\r\n                                            @error=\"${() => {\r\n                                                this._notificationContext?.peek('warning', { \r\n                                                    data: { \r\n                                                        headline: 'Preview Error', \r\n                                                        message: 'Unable to load image preview' \r\n                                                    } \r\n                                                });\r\n                                            }}\"\r\n                                        />\r\n                                    `\r\n                                    : html`<uui-loader></uui-loader>`\r\n                                }\r\n                            </div>\r\n                            <div class=\"preview-actions\">\r\n                                <uui-button \r\n                                    look=\"primary\" \r\n                                    href=\"${this._previewImageUrl}\" \r\n                                    target=\"_blank\">\r\n                                    <uui-icon name=\"icon-out\"></uui-icon> Open in New Tab\r\n                                </uui-button>\r\n                                <uui-button \r\n                                    look=\"secondary\" \r\n                                    href=\"${this._previewImageUrl}\" \r\n                                    download=\"${this._previewImageName}\">\r\n                                    <uui-icon name=\"icon-download-alt\"></uui-icon> Download\r\n                                </uui-button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ` : ''}\r\n\r\n                <!-- Comparison Panel -->\r\n                ${this._renderComparison()}\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    private _formatDate(dateString: string) {\r\n        const date = new Date(dateString);\r\n        return date.toLocaleDateString(undefined, {\r\n            day: '2-digit',\r\n            month: 'short',\r\n            year: 'numeric',\r\n            hour: '2-digit',\r\n            minute: '2-digit'\r\n        });\r\n    }\r\n\r\n    // --- Note operations ---\r\n\r\n    /**\r\n     * Enters inline edit mode for a snapshot's note\r\n     */\r\n    private _startEditNote(version: any) {\r\n        this._editingNoteName = version.name;\r\n        this._editingNoteValue = version.note || '';\r\n    }\r\n\r\n    /**\r\n     * Cancels note editing\r\n     */\r\n    private _cancelEditNote() {\r\n        this._editingNoteName = null;\r\n        this._editingNoteValue = '';\r\n    }\r\n\r\n    /**\r\n     * Saves the note to the snapshot's blob metadata\r\n     */\r\n    private async _saveNote(version: any) {\r\n        if (this._savingNote) return;\r\n\r\n        this._savingNote = true;\r\n\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) {\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: 'Authentication Error', message: 'No authentication token available.' }\r\n            });\r\n            this._savingNote = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch('/umbraco/management/api/v1/snapshot/update-note', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    mediaKey: this._mediaKey,\r\n                    snapshotName: version.name,\r\n                    note: this._editingNoteValue\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                // Update the local version object so the UI reflects the change immediately\r\n                version.note = this._editingNoteValue.trim() || null;\r\n                this._editingNoteName = null;\r\n                this._editingNoteValue = '';\r\n                this.requestUpdate();\r\n            } else {\r\n                const error = await response.json();\r\n                this._notificationContext?.peek('danger', {\r\n                    data: { headline: 'Save Failed', message: error.detail || 'Failed to save note' }\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to save note:\", error);\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: 'Error', message: 'An error occurred while saving the note.' }\r\n            });\r\n        } finally {\r\n            this._savingNote = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handles keydown in the note input — Enter saves, Escape cancels\r\n     */\r\n    private _onNoteKeydown(e: KeyboardEvent, version: any) {\r\n        if (e.key === 'Enter') {\r\n            e.preventDefault();\r\n            this._saveNote(version);\r\n        } else if (e.key === 'Escape') {\r\n            this._cancelEditNote();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Renders the note cell for a snapshot row\r\n     */\r\n    private _renderNoteCell(version: any) {\r\n        const isEditing = this._editingNoteName === version.name;\r\n\r\n        if (isEditing) {\r\n            return html`\r\n                <div class=\"note-edit\">\r\n                    <input\r\n                        type=\"text\"\r\n                        class=\"note-input\"\r\n                        maxlength=\"500\"\r\n                        placeholder=\"Add a note…\"\r\n                        .value=\"${this._editingNoteValue}\"\r\n                        @input=\"${(e: Event) => this._editingNoteValue = (e.target as HTMLInputElement).value}\"\r\n                        @keydown=\"${(e: KeyboardEvent) => this._onNoteKeydown(e, version)}\"\r\n                    />\r\n                    <div class=\"note-edit-actions\">\r\n                        <uui-button\r\n                            look=\"primary\"\r\n                            compact\r\n                            ?disabled=\"${this._savingNote}\"\r\n                            @click=\"${() => this._saveNote(version)}\">\r\n                            <uui-icon name=\"icon-check\"></uui-icon>\r\n                        </uui-button>\r\n                        <uui-button\r\n                            look=\"secondary\"\r\n                            compact\r\n                            @click=\"${this._cancelEditNote}\">\r\n                            <uui-icon name=\"icon-delete\"></uui-icon>\r\n                        </uui-button>\r\n                    </div>\r\n                </div>\r\n            `;\r\n        }\r\n\r\n        if (version.note) {\r\n            return html`\r\n                <button class=\"note-display\" @click=\"${() => this._startEditNote(version)}\" title=\"Click to edit note\">\r\n                    <uui-icon name=\"icon-edit\"></uui-icon>\r\n                    <span class=\"note-text\">${version.note}</span>\r\n                </button>\r\n            `;\r\n        }\r\n\r\n        return html`\r\n            <button class=\"note-add\" @click=\"${() => this._startEditNote(version)}\" title=\"Add a note\">\r\n                <uui-icon name=\"icon-edit\"></uui-icon> Add note\r\n            </button>\r\n        `;\r\n    }\r\n\r\n    static styles = css`\r\n        :host {\r\n            display: block;\r\n            margin-bottom: 20px;\r\n        }\r\n\r\n        .snapshot-container {\r\n            position: relative;\r\n        }\r\n        \r\n        .loader {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 10px;\r\n            padding: 20px;\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        uui-table {\r\n            border: 1px solid var(--uui-color-border);\r\n            border-radius: var(--uui-border-radius);\r\n            background: var(--uui-color-surface);\r\n        }\r\n\r\n        uui-table-head-cell {\r\n            font-weight: bold;\r\n        }\r\n\r\n        uui-icon {\r\n            margin-right: 4px;\r\n        }\r\n\r\n        .filename-link {\r\n            background: none;\r\n            border: none;\r\n            color: var(--uui-color-interactive);\r\n            cursor: pointer;\r\n            padding: 0;\r\n            font: inherit;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n            text-decoration: underline;\r\n            transition: color 0.2s;\r\n        }\r\n\r\n        .filename-link:hover {\r\n            color: var(--uui-color-interactive-emphasis);\r\n        }\r\n\r\n        .filename-link uui-icon {\r\n            margin-right: 4px;\r\n            color: var(--uui-color-primary);\r\n        }\r\n\r\n        /* Selection checkbox */\r\n        .select-checkbox {\r\n            cursor: pointer;\r\n            width: 16px;\r\n            height: 16px;\r\n            accent-color: var(--uui-color-interactive);\r\n        }\r\n\r\n        .select-checkbox:disabled {\r\n            cursor: not-allowed;\r\n            opacity: 0.3;\r\n        }\r\n\r\n        /* Selected row highlight */\r\n        .row-selected {\r\n            background-color: color-mix(in srgb, var(--uui-color-selected) 10%, transparent);\r\n        }\r\n\r\n        /* Bulk action toolbar */\r\n        .bulk-toolbar {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            padding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n            margin-bottom: var(--uui-size-space-3);\r\n            background: color-mix(in srgb, var(--uui-color-selected) 8%, var(--uui-color-surface));\r\n            border: 1px solid var(--uui-color-selected);\r\n            border-radius: var(--uui-border-radius);\r\n            animation: fadeIn 0.2s ease-in;\r\n        }\r\n\r\n        .bulk-toolbar-count {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n            font-weight: 600;\r\n            color: var(--uui-color-selected);\r\n        }\r\n\r\n        .bulk-toolbar-actions {\r\n            display: flex;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        /* Pagination Styles */\r\n        .pagination-container {\r\n            display: flex;\r\n            justify-content: center;\r\n            padding: var(--uui-size-space-5) 0;\r\n        }\r\n\r\n        /* Preview Panel Styles */\r\n        .preview-overlay {\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            background: rgba(0, 0, 0, 0.5);\r\n            z-index: 1000;\r\n            animation: fadeIn 0.2s ease-in;\r\n        }\r\n\r\n        @keyframes fadeIn {\r\n            from { opacity: 0; }\r\n            to { opacity: 1; }\r\n        }\r\n\r\n        @keyframes slideIn {\r\n            from { transform: translateX(100%); }\r\n            to { transform: translateX(0); }\r\n        }\r\n\r\n        .preview-panel {\r\n            position: fixed;\r\n            top: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            width: 500px;\r\n            max-width: 90vw;\r\n            background: var(--uui-color-surface);\r\n            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);\r\n            z-index: 1001;\r\n            display: flex;\r\n            flex-direction: column;\r\n            animation: slideIn 0.3s ease-out;\r\n        }\r\n\r\n        .preview-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            padding: var(--uui-size-space-5);\r\n            border-bottom: 1px solid var(--uui-color-border);\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .preview-header h3 {\r\n            margin: 0;\r\n            font-size: 1.2rem;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .preview-content {\r\n            flex: 1;\r\n            overflow-y: auto;\r\n            padding: var(--uui-size-space-5);\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-4);\r\n        }\r\n\r\n        .preview-filename {\r\n            padding: var(--uui-size-space-3);\r\n            background: var(--uui-color-surface-alt);\r\n            border-radius: var(--uui-border-radius);\r\n            word-break: break-all;\r\n        }\r\n\r\n        .preview-image-container {\r\n            flex: 1;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            background: var(--uui-color-surface-alt);\r\n            border-radius: var(--uui-border-radius);\r\n            padding: var(--uui-size-space-4);\r\n            min-height: 300px;\r\n        }\r\n\r\n        .preview-image-container img {\r\n            max-width: 100%;\r\n            max-height: 60vh;\r\n            object-fit: contain;\r\n            border-radius: var(--uui-border-radius);\r\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n        }\r\n\r\n        .preview-actions {\r\n            display: flex;\r\n            gap: var(--uui-size-space-3);\r\n            padding-top: var(--uui-size-space-4);\r\n            border-top: 1px solid var(--uui-color-border);\r\n        }\r\n\r\n        .preview-actions uui-button {\r\n            flex: 1;\r\n        }\r\n\r\n        /* Comparison Panel Styles */\r\n        .comparison-panel {\r\n            position: fixed;\r\n            top: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            width: 900px;\r\n            max-width: 95vw;\r\n            background: var(--uui-color-surface);\r\n            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);\r\n            z-index: 1001;\r\n            display: flex;\r\n            flex-direction: column;\r\n            animation: slideIn 0.3s ease-out;\r\n        }\r\n\r\n        .comparison-content {\r\n            flex: 1;\r\n            overflow-y: auto;\r\n            padding: var(--uui-size-space-5);\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-5);\r\n        }\r\n\r\n        /* Side-by-side image layout */\r\n        .side-by-side {\r\n            display: flex;\r\n            gap: var(--uui-size-space-4);\r\n            align-items: flex-start;\r\n        }\r\n\r\n        .compare-column {\r\n            flex: 1;\r\n            min-width: 0;\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-3);\r\n        }\r\n\r\n        .compare-label {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .compare-filename {\r\n            font-size: 0.85rem;\r\n            color: var(--uui-color-text-alt);\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            white-space: nowrap;\r\n        }\r\n\r\n        .compare-image-container {\r\n            background: var(--uui-color-surface-alt);\r\n            border-radius: var(--uui-border-radius);\r\n            padding: var(--uui-size-space-3);\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            min-height: 200px;\r\n            border: 1px solid var(--uui-color-border);\r\n        }\r\n\r\n        .compare-image-container img {\r\n            max-width: 100%;\r\n            max-height: 50vh;\r\n            object-fit: contain;\r\n            border-radius: var(--uui-border-radius);\r\n        }\r\n\r\n        .compare-divider {\r\n            width: 1px;\r\n            align-self: stretch;\r\n            background: var(--uui-color-border);\r\n        }\r\n\r\n        /* Slider comparison */\r\n        .slider-comparison {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-3);\r\n        }\r\n\r\n        .slider-container {\r\n            position: relative;\r\n            overflow: hidden;\r\n            border-radius: var(--uui-border-radius);\r\n            border: 1px solid var(--uui-color-border);\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .slider-img-under {\r\n            display: block;\r\n            width: 100%;\r\n            max-height: 50vh;\r\n            object-fit: contain;\r\n        }\r\n\r\n        .slider-img-over {\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n            bottom: 0;\r\n            overflow: hidden;\r\n        }\r\n\r\n        .slider-img-over img {\r\n            display: block;\r\n            height: 100%;\r\n            max-height: 50vh;\r\n            object-fit: contain;\r\n        }\r\n\r\n        .slider-handle {\r\n            position: absolute;\r\n            top: 0;\r\n            bottom: 0;\r\n            width: 3px;\r\n            background: var(--uui-color-interactive);\r\n            transform: translateX(-50%);\r\n            pointer-events: none;\r\n        }\r\n\r\n        .slider-handle-line {\r\n            position: absolute;\r\n            top: 50%;\r\n            left: 50%;\r\n            transform: translate(-50%, -50%);\r\n            width: 28px;\r\n            height: 28px;\r\n            border-radius: 50%;\r\n            background: var(--uui-color-interactive);\r\n            border: 2px solid var(--uui-color-surface);\r\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\r\n        }\r\n\r\n        .slider-range {\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            opacity: 0;\r\n            cursor: ew-resize;\r\n            margin: 0;\r\n        }\r\n\r\n        .slider-labels {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            font-size: 0.85rem;\r\n        }\r\n\r\n        .slider-labels span {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        /* Metadata diff table */\r\n        .metadata-comparison {\r\n            border-top: 1px solid var(--uui-color-border);\r\n            padding-top: var(--uui-size-space-4);\r\n        }\r\n\r\n        .metadata-comparison h4 {\r\n            margin: 0 0 var(--uui-size-space-3) 0;\r\n            font-size: 1rem;\r\n        }\r\n\r\n        /* Stats strip */\r\n        .stats-strip {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-4);\r\n            padding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n            margin-bottom: var(--uui-size-space-4);\r\n            background: var(--uui-color-surface-alt);\r\n            border: 1px solid var(--uui-color-border);\r\n            border-radius: var(--uui-border-radius);\r\n            flex-wrap: wrap;\r\n        }\r\n\r\n        .stats-strip-item {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .stats-strip-item uui-icon {\r\n            color: var(--uui-color-primary);\r\n            font-size: 0.9rem;\r\n        }\r\n\r\n        .stats-strip-value {\r\n            font-weight: 700;\r\n            font-size: 0.9rem;\r\n        }\r\n\r\n        .stats-strip-label {\r\n            font-size: 0.8rem;\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        .stats-strip-divider {\r\n            width: 1px;\r\n            height: 20px;\r\n            background: var(--uui-color-border);\r\n        }\r\n\r\n        /* Note cell */\r\n        .note-edit {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n        }\r\n\r\n        .note-input {\r\n            flex: 1;\r\n            padding: 4px 8px;\r\n            border: 1px solid var(--uui-color-border);\r\n            border-radius: var(--uui-border-radius);\r\n            font: inherit;\r\n            font-size: 0.85rem;\r\n            min-width: 120px;\r\n            background: var(--uui-color-surface);\r\n            color: var(--uui-color-text);\r\n        }\r\n\r\n        .note-input:focus {\r\n            outline: none;\r\n            border-color: var(--uui-color-interactive);\r\n            box-shadow: 0 0 0 1px var(--uui-color-interactive);\r\n        }\r\n\r\n        .note-edit-actions {\r\n            display: flex;\r\n            gap: 2px;\r\n            flex-shrink: 0;\r\n        }\r\n\r\n        .note-display {\r\n            background: none;\r\n            border: none;\r\n            cursor: pointer;\r\n            padding: 2px 4px;\r\n            font: inherit;\r\n            font-size: 0.85rem;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n            color: var(--uui-color-text);\r\n            border-radius: var(--uui-border-radius);\r\n            transition: background 0.2s;\r\n            max-width: 200px;\r\n        }\r\n\r\n        .note-display:hover {\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .note-display uui-icon {\r\n            color: var(--uui-color-text-alt);\r\n            font-size: 0.75rem;\r\n            flex-shrink: 0;\r\n            opacity: 0;\r\n            transition: opacity 0.2s;\r\n        }\r\n\r\n        .note-display:hover uui-icon {\r\n            opacity: 1;\r\n        }\r\n\r\n        .note-text {\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            white-space: nowrap;\r\n        }\r\n\r\n        .note-add {\r\n            background: none;\r\n            border: none;\r\n            cursor: pointer;\r\n            padding: 2px 4px;\r\n            font: inherit;\r\n            font-size: 0.8rem;\r\n            color: var(--uui-color-text-alt);\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n            opacity: 0.5;\r\n            transition: opacity 0.2s;\r\n        }\r\n\r\n        .note-add:hover {\r\n            opacity: 1;\r\n            color: var(--uui-color-interactive);\r\n        }\r\n\r\n        /* Version cell: stacked filename + note */\r\n        .version-cell {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: 2px;\r\n        }\r\n\r\n        .version-cell-primary {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .version-cell-secondary {\r\n            padding-left: 0;\r\n        }\r\n\r\n        .filename-text {\r\n            font-weight: 500;\r\n        }\r\n\r\n        .status-badge {\r\n            flex-shrink: 0;\r\n            font-size: 0.7rem;\r\n        }\r\n\r\n        /* Upload cell: date + user stacked */\r\n        .upload-cell {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: 2px;\r\n        }\r\n\r\n        .upload-date {\r\n            font-size: 0.85rem;\r\n        }\r\n\r\n        .upload-user {\r\n            font-size: 0.8rem;\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        /* Actions cell: right-aligned icon buttons */\r\n        .actions-cell {\r\n            display: flex;\r\n            gap: 4px;\r\n            justify-content: flex-end;\r\n        }\r\n\r\n        @media (max-width: 768px) {\r\n            .preview-panel {\r\n                width: 100vw;\r\n                max-width: 100vw;\r\n            }\r\n            .comparison-panel {\r\n                width: 100vw;\r\n                max-width: 100vw;\r\n            }\r\n            .side-by-side {\r\n                flex-direction: column;\r\n            }\r\n            .compare-divider {\r\n                width: 100%;\r\n                height: 1px;\r\n            }\r\n            .bulk-toolbar {\r\n                flex-direction: column;\r\n                gap: var(--uui-size-space-3);\r\n                text-align: center;\r\n            }\r\n        }\r\n    `;\r\n}\r\n\r\n// Global declaration for TS intellisense\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'snapshot-viewer': SnapshotViewerElement;\r\n    }\r\n}"],"names":["SnapshotViewerElement","UmbElementMixin","LitElement","UMB_AUTH_CONTEXT","instance","UMB_NOTIFICATION_CONTEXT","UMB_MODAL_MANAGER_CONTEXT","UMB_WORKSPACE_CONTEXT","workspaceContext","entityWorkspace","unique","mediaKey","token","url","response","error","snapshotVersion","currentMedia","input","start","event","target","filename","imageExtensions","extension","version","name","updated","pageOffset","selectableOnPage","_","i","v","allSelected","modalHandler","UMB_CONFIRM_MODAL","html","result","count","bytes","units","index","snapshot","current","bothAreImages","sizeDiff","sizeDiffLabel","totalSize","sum","dates","t","oldestDate","newestDate","uniqueUploaders","isSingleVersion","pagedVersions","hasSelection","globalIndex","isLatest","isSelected","dateString","e","css","__decorateClass","state","customElement"],"mappings":"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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA7sCRC,EAAA;AAAA,EADPC,EAAA;AAAM,GAFEhE,EAGD,WAAA,aAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GALEhE,EAMD,WAAA,YAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GAREhE,EASD,WAAA,aAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GAXEhE,EAYD,WAAA,oBAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GAdEhE,EAeD,WAAA,qBAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GAjBEhE,EAkBD,WAAA,gBAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GApBEhE,EAqBD,WAAA,gBAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GAvBEhE,EAwBD,WAAA,gBAAA,CAAA;AAIA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GA3BEhE,EA4BD,WAAA,mBAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GA9BEhE,EA+BD,WAAA,uBAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GAjCEhE,EAkCD,WAAA,sBAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GApCEhE,EAqCD,WAAA,sBAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GAvCEhE,EAwCD,WAAA,mBAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GA1CEhE,EA2CD,WAAA,mBAAA,CAAA;AAIA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GA9CEhE,EA+CD,WAAA,sBAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GAjDEhE,EAkDD,WAAA,eAAA,CAAA;AAIA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GArDEhE,EAsDD,WAAA,oBAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GAxDEhE,EAyDD,WAAA,qBAAA,CAAA;AAGA+D,EAAA;AAAA,EADPC,EAAA;AAAM,GA3DEhE,EA4DD,WAAA,eAAA,CAAA;AA5DCA,IAAN+D,EAAA;AAAA,EADNE,EAAc,iBAAiB;AAAA,GACnBjE,CAAA;"}