{"version":3,"file":"umbraco-media-snapshot.js","sources":["../../../Client/src/snapshot-viewer.ts"],"sourcesContent":["import { LitElement, html, css, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbElementMixin } from '@umbraco-cms/backoffice/element-api';\r\nimport { UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_NOTIFICATION_CONTEXT } from '@umbraco-cms/backoffice/notification';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_CONFIRM_MODAL } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbEntityWorkspaceContext } from '@umbraco-cms/backoffice/workspace';\r\nimport type { UmbNotificationContext } from '@umbraco-cms/backoffice/notification';\r\nimport type { UmbModalManagerContext } from '@umbraco-cms/backoffice/modal';\r\n\r\n/**\r\n * Snapshot Viewer Property Editor\r\n * Displays a list of file versions from the umbraco-snapshots Azure container\r\n */\r\n@customElement('snapshot-viewer')\r\nexport class SnapshotViewerElement extends UmbElementMixin(LitElement) {\r\n\r\n    @state()\r\n    private _versions: any[] = [];\r\n\r\n    @state()\r\n    private _loading = true;\r\n\r\n    @state()\r\n    private _mediaKey = '';\r\n\r\n    @state()\r\n    private _previewImageUrl: string | null = null;\r\n\r\n    @state()\r\n    private _previewImageName: string = '';\r\n\r\n    @state()\r\n    private _showPreview = false;\r\n\r\n    @state()\r\n    private _isRestoring = false;\r\n\r\n    @state()\r\n    private _currentPage = 1;\r\n\r\n    // --- Comparison state ---\r\n    @state()\r\n    private _showComparison = false;\r\n\r\n    @state()\r\n    private _comparisonSnapshot: any = null;\r\n\r\n    @state()\r\n    private _comparisonCurrent: any = null;\r\n\r\n    @state()\r\n    private _comparisonLoading = false;\r\n\r\n    @state()\r\n    private _comparisonMode: 'side-by-side' | 'slider' = 'side-by-side';\r\n\r\n    @state()\r\n    private _sliderPosition = 50;\r\n\r\n    private _pageSize = 10;\r\n\r\n    private _authContext?: typeof UMB_AUTH_CONTEXT.TYPE;\r\n    private _notificationContext?: UmbNotificationContext;\r\n    private _modalManagerContext?: UmbModalManagerContext;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        // 1. Consume the Auth Context to manage tokens\r\n        this.consumeContext(UMB_AUTH_CONTEXT, (instance) => {\r\n            this._authContext = instance;\r\n        });\r\n\r\n        // Consume the Notification Context\r\n        this.consumeContext(UMB_NOTIFICATION_CONTEXT, (instance) => {\r\n            this._notificationContext = instance;\r\n        });\r\n\r\n        // Consume the Modal Manager Context\r\n        this.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => {\r\n            this._modalManagerContext = instance;\r\n        });\r\n\r\n        this.consumeContext(UMB_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n            const entityWorkspace = workspaceContext as unknown as UmbEntityWorkspaceContext;\r\n            if (entityWorkspace.unique) {\r\n                this.observe(entityWorkspace.unique, (unique) => {\r\n                    if (unique && unique !== this._mediaKey) {\r\n                        this._mediaKey = unique.toString();\r\n                        this._currentPage = 1;\r\n                        this._fetchVersions(this._mediaKey);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Calls the C# Management API to get the list of blobs\r\n     * Umbraco 17 automatically injects Auth Bearer tokens into fetch \r\n     * requests starting with /umbraco/management/api/\r\n     */\r\n    private async _fetchVersions(mediaKey: string) {\r\n        this._loading = true;\r\n\r\n        // 2. Get the latest token from the auth context\r\n        const token = await this._authContext?.getLatestToken();\r\n\r\n        if (!token) {\r\n            console.error(\"No authentication token available.\");\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Authentication Error', message: 'No authentication token available.' } \r\n            });\r\n            this._loading = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const url = `/umbraco/management/api/v1/snapshot/versions/${mediaKey}`;\r\n\r\n            // 3. Manually add the Authorization header\r\n            const response = await fetch(url, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            });\r\n\r\n            if (response.ok) {\r\n                this._versions = await response.json();\r\n            } else if (response.status === 401) {\r\n                console.error(\"Unauthorized: The session may have expired.\");\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { headline: 'Unauthorized', message: 'The session may have expired.' } \r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch snapshots:\", error);\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Error', message: 'Failed to fetch snapshots.' } \r\n            });\r\n        } finally {\r\n            this._loading = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fetches the current (live) media file metadata and SAS URL\r\n     */\r\n    private async _fetchCurrentMedia(): Promise<any | null> {\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) return null;\r\n\r\n        try {\r\n            const url = `/umbraco/management/api/v1/snapshot/current/${this._mediaKey}`;\r\n            const response = await fetch(url, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            });\r\n\r\n            if (response.ok) {\r\n                return await response.json();\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch current media:\", error);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Opens the comparison panel for a specific snapshot version\r\n     */\r\n    private async _openComparison(snapshotVersion: any) {\r\n        this._comparisonLoading = true;\r\n        this._comparisonSnapshot = snapshotVersion;\r\n        this._showComparison = true;\r\n        this._sliderPosition = 50;\r\n\r\n        const currentMedia = await this._fetchCurrentMedia();\r\n        this._comparisonCurrent = currentMedia;\r\n        this._comparisonLoading = false;\r\n    }\r\n\r\n    /**\r\n     * Closes the comparison panel\r\n     */\r\n    private _closeComparison() {\r\n        this._showComparison = false;\r\n        this._comparisonSnapshot = null;\r\n        this._comparisonCurrent = null;\r\n    }\r\n\r\n    /**\r\n     * Toggles the comparison mode between side-by-side and slider\r\n     */\r\n    private _toggleComparisonMode() {\r\n        this._comparisonMode = this._comparisonMode === 'side-by-side' ? 'slider' : 'side-by-side';\r\n    }\r\n\r\n    /**\r\n     * Handles the slider input for overlay comparison\r\n     */\r\n    private _onSliderInput(e: Event) {\r\n        const input = e.target as HTMLInputElement;\r\n        this._sliderPosition = parseInt(input.value, 10);\r\n    }\r\n\r\n    /**\r\n     * Returns the total number of pages based on versions count and page size\r\n     */\r\n    private get _totalPages(): number {\r\n        return Math.max(1, Math.ceil(this._versions.length / this._pageSize));\r\n    }\r\n\r\n    /**\r\n     * Returns the versions for the current page\r\n     */\r\n    private get _pagedVersions(): any[] {\r\n        const start = (this._currentPage - 1) * this._pageSize;\r\n        return this._versions.slice(start, start + this._pageSize);\r\n    }\r\n\r\n    /**\r\n     * Handles page change from the pagination component\r\n     */\r\n    private _onPageChange(event: Event) {\r\n        const target = event.target as HTMLElement & { current: number };\r\n        this._currentPage = target.current;\r\n    }\r\n\r\n    /**\r\n     * Checks if a filename is an image based on extension\r\n     */\r\n    private _isImage(filename: string): boolean {\r\n        const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp', '.svg'];\r\n        const extension = filename.substring(filename.lastIndexOf('.')).toLowerCase();\r\n        return imageExtensions.includes(extension);\r\n    }\r\n\r\n    /**\r\n     * Opens the image preview panel\r\n     */\r\n    private _openImagePreview(version: any) {\r\n        if (!this._isImage(version.name)) return;\r\n        \r\n        this._previewImageUrl = version.url;\r\n        this._previewImageName = version.name;\r\n        this._showPreview = true;\r\n    }\r\n\r\n    /**\r\n     * Closes the image preview panel\r\n     */\r\n    private _closePreview() {\r\n        this._showPreview = false;\r\n        this._previewImageUrl = null;\r\n        this._previewImageName = '';\r\n    }\r\n\r\n    /**\r\n     * Restores a specific snapshot version as the current file\r\n     */\r\n    private async _restoreVersion(version: any) {\r\n        // Prevent multiple simultaneous restore operations\r\n        if (this._isRestoring) {\r\n            console.warn(\"Restore already in progress\");\r\n            return;\r\n        }\r\n\r\n        if (!this._modalManagerContext) {\r\n            console.error(\"Modal manager context not available\");\r\n            return;\r\n        }\r\n\r\n        // Show Umbraco-styled confirmation modal\r\n        const modalHandler = this._modalManagerContext.open(this, UMB_CONFIRM_MODAL, {\r\n            data: {\r\n                headline: 'Restore File Version',\r\n                content: html`\r\n                    <p>Are you sure you want to restore <strong>\"${version.name}\"</strong>?</p>\r\n                    <p>This will replace the current file and create a new snapshot.</p>\r\n                    <uui-box>\r\n                        <p style=\"margin: 0;\">\r\n                            <uui-icon name=\"icon-alert\"></uui-icon>\r\n                            <strong>Warning:</strong> This action cannot be undone.\r\n                        </p>\r\n                    </uui-box>\r\n                `,\r\n                color: 'danger',\r\n                confirmLabel: 'Restore'\r\n            }\r\n        });\r\n\r\n        // Wait for user to confirm or cancel\r\n        try {\r\n            await modalHandler.onSubmit();\r\n        } catch {\r\n            // User cancelled the modal\r\n            return;\r\n        }\r\n\r\n        // Set the restoring flag\r\n        this._isRestoring = true;\r\n\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) {\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Authentication Error', message: 'No authentication token available.' } \r\n            });\r\n            this._isRestoring = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const url = `/umbraco/management/api/v1/snapshot/restore`;\r\n            const response = await fetch(url, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    mediaKey: this._mediaKey,\r\n                    snapshotName: version.name\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                const result = await response.json();\r\n                \r\n                // Use Umbraco notification instead of alert\r\n                this._notificationContext?.peek('positive', { \r\n                    data: { \r\n                        headline: 'Snapshot Restored', \r\n                        message: result.message \r\n                    } \r\n                });\r\n                \r\n                // Refresh the version list\r\n                await this._fetchVersions(this._mediaKey);\r\n            } else if (response.status === 401) {\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { \r\n                        headline: 'Unauthorized', \r\n                        message: 'Your session may have expired. Please refresh the page.' \r\n                    } \r\n                });\r\n            } else {\r\n                const error = await response.json();\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { \r\n                        headline: 'Restore Failed', \r\n                        message: error.detail || 'Unknown error' \r\n                    } \r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to restore snapshot:\", error);\r\n            this._notificationContext?.peek('danger', { \r\n                data: { \r\n                    headline: 'Error', \r\n                    message: 'An error occurred while restoring the snapshot. Please try again.' \r\n                } \r\n            });\r\n        } finally {\r\n            // Always reset the restoring flag\r\n            this._isRestoring = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Formats a byte count into a human-readable size string\r\n     */\r\n    private _formatSize(bytes: number): string {\r\n        if (bytes === 0) return '0 B';\r\n        const units = ['B', 'KB', 'MB', 'GB'];\r\n        const i = Math.floor(Math.log(bytes) / Math.log(1024));\r\n        return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + units[i];\r\n    }\r\n\r\n    /**\r\n     * Renders the status tag for a snapshot version based on its metadata\r\n     */\r\n    private _renderStatus(version: any, index: number) {\r\n        if (version.isRestored) {\r\n            return html`\r\n                <uui-tag look=\"primary\" color=\"positive\">\r\n                    <uui-icon name=\"icon-refresh\"></uui-icon>\r\n                    Restored ${version.restoredDate ? this._formatDate(version.restoredDate) : ''}\r\n                </uui-tag>\r\n            `;\r\n        }\r\n\r\n        // The first item (index 0) in the sorted-by-date-descending list is the latest version\r\n        if (index === 0) {\r\n            return html`\r\n                <uui-tag look=\"primary\" color=\"default\">\r\n                    <uui-icon name=\"icon-check\"></uui-icon>\r\n                    Latest\r\n                </uui-tag>\r\n            `;\r\n        }\r\n\r\n        return html`\r\n            <uui-tag look=\"secondary\" color=\"default\">\r\n                Original\r\n            </uui-tag>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Renders the comparison panel content\r\n     */\r\n    private _renderComparison() {\r\n        if (!this._showComparison) return '';\r\n\r\n        const snapshot = this._comparisonSnapshot;\r\n        const current = this._comparisonCurrent;\r\n        const bothAreImages = snapshot && current\r\n            && this._isImage(snapshot.name) && this._isImage(current.name);\r\n\r\n        return html`\r\n            <div class=\"preview-overlay\" @click=\"${this._closeComparison}\"></div>\r\n            <div class=\"comparison-panel\">\r\n                <div class=\"preview-header\">\r\n                    <h3>\r\n                        <uui-icon name=\"icon-split\"></uui-icon>\r\n                        Compare Versions\r\n                    </h3>\r\n                    <div style=\"display: flex; gap: 8px; align-items: center;\">\r\n                        ${bothAreImages ? html`\r\n                            <uui-button\r\n                                look=\"secondary\"\r\n                                compact\r\n                                @click=\"${this._toggleComparisonMode}\"\r\n                                title=\"Toggle comparison mode\">\r\n                                <uui-icon name=\"${this._comparisonMode === 'side-by-side' ? 'icon-layers-alt' : 'icon-split'}\"></uui-icon>\r\n                                ${this._comparisonMode === 'side-by-side' ? 'Slider' : 'Side-by-Side'}\r\n                            </uui-button>\r\n                        ` : ''}\r\n                        <uui-button\r\n                            look=\"secondary\"\r\n                            compact\r\n                            @click=\"${this._closeComparison}\">\r\n                            <uui-icon name=\"icon-delete\"></uui-icon>\r\n                        </uui-button>\r\n                    </div>\r\n                </div>\r\n                <div class=\"comparison-content\">\r\n                    ${this._comparisonLoading\r\n                        ? html`<div class=\"loader\"><uui-loader></uui-loader> Loading current file...</div>`\r\n                        : !current\r\n                            ? html`<uui-box><p>Unable to load the current media file for comparison.</p></uui-box>`\r\n                            : bothAreImages\r\n                                ? this._renderImageComparison(current, snapshot)\r\n                                : this._renderMetadataComparison(current, snapshot)\r\n                    }\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Renders a side-by-side or slider image comparison\r\n     */\r\n    private _renderImageComparison(current: any, snapshot: any) {\r\n        if (this._comparisonMode === 'slider') {\r\n            return html`\r\n                <div class=\"slider-comparison\">\r\n                    <div class=\"slider-container\">\r\n                        <img class=\"slider-img-under\" src=\"${current.url}\" alt=\"Current\" />\r\n                        <div class=\"slider-img-over\" style=\"width: ${this._sliderPosition}%;\">\r\n                            <img src=\"${snapshot.url}\" alt=\"Snapshot\" />\r\n                        </div>\r\n                        <div class=\"slider-handle\" style=\"left: ${this._sliderPosition}%;\">\r\n                            <div class=\"slider-handle-line\"></div>\r\n                        </div>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"0\"\r\n                            max=\"100\"\r\n                            .value=\"${String(this._sliderPosition)}\"\r\n                            @input=\"${this._onSliderInput}\"\r\n                            class=\"slider-range\"\r\n                        />\r\n                    </div>\r\n                    <div class=\"slider-labels\">\r\n                        <span><uui-tag look=\"primary\" color=\"default\">Snapshot</uui-tag> ${snapshot.name}</span>\r\n                        <span><uui-tag look=\"primary\" color=\"positive\">Current</uui-tag> ${current.name}</span>\r\n                    </div>\r\n                </div>\r\n                ${this._renderMetadataComparison(current, snapshot)}\r\n            `;\r\n        }\r\n\r\n        return html`\r\n            <div class=\"side-by-side\">\r\n                <div class=\"compare-column\">\r\n                    <div class=\"compare-label\">\r\n                        <uui-tag look=\"primary\" color=\"default\">Snapshot</uui-tag>\r\n                        <span class=\"compare-filename\">${snapshot.name}</span>\r\n                    </div>\r\n                    <div class=\"compare-image-container\">\r\n                        <img src=\"${snapshot.url}\" alt=\"${snapshot.name}\" />\r\n                    </div>\r\n                </div>\r\n                <div class=\"compare-divider\"></div>\r\n                <div class=\"compare-column\">\r\n                    <div class=\"compare-label\">\r\n                        <uui-tag look=\"primary\" color=\"positive\">Current</uui-tag>\r\n                        <span class=\"compare-filename\">${current.name}</span>\r\n                    </div>\r\n                    <div class=\"compare-image-container\">\r\n                        <img src=\"${current.url}\" alt=\"${current.name}\" />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            ${this._renderMetadataComparison(current, snapshot)}\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Renders a metadata diff table comparing the snapshot and current file\r\n     */\r\n    private _renderMetadataComparison(current: any, snapshot: any) {\r\n        const sizeDiff = current.size - snapshot.size;\r\n        const sizeDiffLabel = sizeDiff > 0\r\n            ? `+${this._formatSize(sizeDiff)}`\r\n            : sizeDiff < 0\r\n                ? `-${this._formatSize(Math.abs(sizeDiff))}`\r\n                : 'No change';\r\n\r\n        return html`\r\n            <div class=\"metadata-comparison\">\r\n                <h4>File Details</h4>\r\n                <uui-table>\r\n                    <uui-table-head>\r\n                        <uui-table-head-cell>Property</uui-table-head-cell>\r\n                        <uui-table-head-cell>Snapshot</uui-table-head-cell>\r\n                        <uui-table-head-cell>Current</uui-table-head-cell>\r\n                        <uui-table-head-cell>Difference</uui-table-head-cell>\r\n                    </uui-table-head>\r\n                    <uui-table-row>\r\n                        <uui-table-cell><strong>Filename</strong></uui-table-cell>\r\n                        <uui-table-cell>${snapshot.name}</uui-table-cell>\r\n                        <uui-table-cell>${current.name}</uui-table-cell>\r\n                        <uui-table-cell>\r\n                            ${snapshot.name === current.name\r\n                                ? html`<uui-tag look=\"secondary\" color=\"default\">Same</uui-tag>`\r\n                                : html`<uui-tag look=\"primary\" color=\"warning\">Changed</uui-tag>`\r\n                            }\r\n                        </uui-table-cell>\r\n                    </uui-table-row>\r\n                    <uui-table-row>\r\n                        <uui-table-cell><strong>File Size</strong></uui-table-cell>\r\n                        <uui-table-cell>${this._formatSize(snapshot.size)}</uui-table-cell>\r\n                        <uui-table-cell>${this._formatSize(current.size)}</uui-table-cell>\r\n                        <uui-table-cell>\r\n                            <uui-tag look=\"secondary\" color=\"${sizeDiff === 0 ? 'default' : sizeDiff > 0 ? 'warning' : 'positive'}\">\r\n                                ${sizeDiffLabel}\r\n                            </uui-tag>\r\n                        </uui-table-cell>\r\n                    </uui-table-row>\r\n                    <uui-table-row>\r\n                        <uui-table-cell><strong>Date</strong></uui-table-cell>\r\n                        <uui-table-cell>${this._formatDate(snapshot.date)}</uui-table-cell>\r\n                        <uui-table-cell>${this._formatDate(current.lastModified)}</uui-table-cell>\r\n                        <uui-table-cell></uui-table-cell>\r\n                    </uui-table-row>\r\n                    ${snapshot.uploader ? html`\r\n                        <uui-table-row>\r\n                            <uui-table-cell><strong>Uploaded By</strong></uui-table-cell>\r\n                            <uui-table-cell>${snapshot.uploader.replace(/_/g, ' ')}</uui-table-cell>\r\n                            <uui-table-cell>â€”</uui-table-cell>\r\n                            <uui-table-cell></uui-table-cell>\r\n                        </uui-table-row>\r\n                    ` : ''}\r\n                </uui-table>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    render() {\r\n        if (this._loading) {\r\n            return html`<div class=\"loader\"><uui-loader></uui-loader> Fetching snapshots...</div>`;\r\n        }\r\n\r\n        if (this._versions.length === 0) {\r\n            return html`\r\n                <uui-box>\r\n                    <div style=\"display: flex; align-items: center; gap: var(--uui-size-space-3);\">\r\n                        <uui-icon name=\"info\" style=\"color: var(--uui-color-primary);\"></uui-icon>\r\n                        <span>No previous versions found in the snapshots container.</span>\r\n                    </div>\r\n                </uui-box>\r\n            `;\r\n        }\r\n\r\n        const isSingleVersion = this._versions.length === 1;\r\n        const pagedVersions = this._pagedVersions;\r\n        const pageOffset = (this._currentPage - 1) * this._pageSize;\r\n\r\n        return html`\r\n            <div class=\"snapshot-container\">\r\n                <uui-table>\r\n                    <uui-table-head>\r\n                        <uui-table-head-cell>Version Filename</uui-table-head-cell>\r\n                        <uui-table-head-cell>Date Uploaded</uui-table-head-cell>\r\n                        <uui-table-head-cell>Uploaded By</uui-table-head-cell>\r\n                        <uui-table-head-cell>Status</uui-table-head-cell>\r\n                        <uui-table-head-cell>Actions</uui-table-head-cell>\r\n                    </uui-table-head>\r\n\r\n                    ${pagedVersions.map((v, i) => html`\r\n                        <uui-table-row>\r\n                            <uui-table-cell>\r\n                                ${this._isImage(v.name) \r\n                                    ? html`\r\n                                        <button \r\n                                            class=\"filename-link\" \r\n                                            @click=\"${() => this._openImagePreview(v)}\"\r\n                                            title=\"Click to preview image\">\r\n                                            <uui-icon name=\"icon-picture\"></uui-icon>\r\n                                            ${v.name}\r\n                                        </button>\r\n                                    `\r\n                                    : html`<span>${v.name}</span>`\r\n                                }\r\n                            </uui-table-cell>\r\n                            <uui-table-cell>${this._formatDate(v.date)}</uui-table-cell>\r\n                            <uui-table-cell>${v.uploader.replace(/_/g, ' ')}</uui-table-cell>\r\n                            <uui-table-cell>\r\n                                ${this._renderStatus(v, pageOffset + i)}\r\n                            </uui-table-cell>\r\n                            <uui-table-cell>\r\n                                <div style=\"display: flex; gap: 8px;\">\r\n                                    <uui-button\r\n                                        look=\"secondary\"\r\n                                        compact\r\n                                        ?disabled=\"${(pageOffset + i) === 0}\"\r\n                                        title=\"${(pageOffset + i) === 0 ? 'This is the latest version' : 'Compare with current file'}\"\r\n                                        @click=\"${() => this._openComparison(v)}\">\r\n                                        <uui-icon name=\"icon-split\"></uui-icon> Compare\r\n                                    </uui-button>\r\n                                    <uui-button \r\n                                        look=\"secondary\" \r\n                                        compact \r\n                                        href=\"${v.url}\" \r\n                                        target=\"_blank\">\r\n                                        <uui-icon name=\"icon-download-alt\"></uui-icon> Download\r\n                                    </uui-button>\r\n                                    <uui-button \r\n                                        look=\"primary\" \r\n                                        color=\"positive\"\r\n                                        compact\r\n                                        ?disabled=\"${isSingleVersion || this._isRestoring || (pageOffset + i) === 0}\"\r\n                                        title=\"${isSingleVersion ? 'Cannot restore when only one version exists' : (pageOffset + i) === 0 ? 'This is already the latest version' : 'Restore this version'}\"\r\n                                        @click=\"${() => this._restoreVersion(v)}\">\r\n                                        <uui-icon name=\"icon-refresh\"></uui-icon> ${this._isRestoring ? 'Restoring...' : 'Restore'}\r\n                                    </uui-button>\r\n                                </div>\r\n                            </uui-table-cell>\r\n                        </uui-table-row>\r\n                    `)}\r\n                </uui-table>\r\n\r\n                ${this._totalPages > 1 ? html`\r\n                    <div class=\"pagination-container\">\r\n                        <uui-pagination\r\n                            .current=\"${this._currentPage}\"\r\n                            .total=\"${this._totalPages}\"\r\n                            @change=\"${this._onPageChange}\">\r\n                        </uui-pagination>\r\n                    </div>\r\n                ` : ''}\r\n\r\n                <!-- Image Preview Side Panel -->\r\n                ${this._showPreview ? html`\r\n                    <div class=\"preview-overlay\" @click=\"${this._closePreview}\"></div>\r\n                    <div class=\"preview-panel\">\r\n                        <div class=\"preview-header\">\r\n                            <h3>\r\n                                <uui-icon name=\"icon-picture\"></uui-icon>\r\n                                Image Preview\r\n                            </h3>\r\n                            <uui-button \r\n                                look=\"secondary\" \r\n                                compact\r\n                                @click=\"${this._closePreview}\">\r\n                                <uui-icon name=\"icon-delete\"></uui-icon>\r\n                            </uui-button>\r\n                        </div>\r\n                        <div class=\"preview-content\">\r\n                            <div class=\"preview-filename\">\r\n                                <strong>Filename:</strong> <br/>${this._previewImageName}\r\n                            </div>\r\n                            <div class=\"preview-image-container\">\r\n                                ${this._previewImageUrl \r\n                                    ? html`\r\n                                        <img \r\n                                            src=\"${this._previewImageUrl}\" \r\n                                            alt=\"${this._previewImageName}\"\r\n                                            @error=\"${() => {\r\n                                                this._notificationContext?.peek('warning', { \r\n                                                    data: { \r\n                                                        headline: 'Preview Error', \r\n                                                        message: 'Unable to load image preview' \r\n                                                    } \r\n                                                });\r\n                                            }}\"\r\n                                        />\r\n                                    `\r\n                                    : html`<uui-loader></uui-loader>`\r\n                                }\r\n                            </div>\r\n                            <div class=\"preview-actions\">\r\n                                <uui-button \r\n                                    look=\"primary\" \r\n                                    href=\"${this._previewImageUrl}\" \r\n                                    target=\"_blank\">\r\n                                    <uui-icon name=\"icon-out\"></uui-icon> Open in New Tab\r\n                                </uui-button>\r\n                                <uui-button \r\n                                    look=\"secondary\" \r\n                                    href=\"${this._previewImageUrl}\" \r\n                                    download=\"${this._previewImageName}\">\r\n                                    <uui-icon name=\"icon-download-alt\"></uui-icon> Download\r\n                                </uui-button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ` : ''}\r\n\r\n                <!-- Comparison Panel -->\r\n                ${this._renderComparison()}\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    private _formatDate(dateString: string) {\r\n        const date = new Date(dateString);\r\n        return date.toLocaleDateString(undefined, {\r\n            day: '2-digit',\r\n            month: 'short',\r\n            year: 'numeric',\r\n            hour: '2-digit',\r\n            minute: '2-digit'\r\n        });\r\n    }\r\n\r\n    static styles = css`\r\n        :host {\r\n            display: block;\r\n            margin-bottom: 20px;\r\n        }\r\n\r\n        .snapshot-container {\r\n            position: relative;\r\n        }\r\n        \r\n        .loader {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 10px;\r\n            padding: 20px;\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        uui-table {\r\n            border: 1px solid var(--uui-color-border);\r\n            border-radius: var(--uui-border-radius);\r\n            background: var(--uui-color-surface);\r\n        }\r\n\r\n        uui-table-head-cell {\r\n            font-weight: bold;\r\n        }\r\n\r\n        uui-icon {\r\n            margin-right: 4px;\r\n        }\r\n\r\n        .filename-link {\r\n            background: none;\r\n            border: none;\r\n            color: var(--uui-color-interactive);\r\n            cursor: pointer;\r\n            padding: 0;\r\n            font: inherit;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n            text-decoration: underline;\r\n            transition: color 0.2s;\r\n        }\r\n\r\n        .filename-link:hover {\r\n            color: var(--uui-color-interactive-emphasis);\r\n        }\r\n\r\n        .filename-link uui-icon {\r\n            margin-right: 4px;\r\n            color: var(--uui-color-primary);\r\n        }\r\n\r\n        /* Pagination Styles */\r\n        .pagination-container {\r\n            display: flex;\r\n            justify-content: center;\r\n            padding: var(--uui-size-space-5) 0;\r\n        }\r\n\r\n        /* Preview Panel Styles */\r\n        .preview-overlay {\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            background: rgba(0, 0, 0, 0.5);\r\n            z-index: 1000;\r\n            animation: fadeIn 0.2s ease-in;\r\n        }\r\n\r\n        @keyframes fadeIn {\r\n            from { opacity: 0; }\r\n            to { opacity: 1; }\r\n        }\r\n\r\n        @keyframes slideIn {\r\n            from { transform: translateX(100%); }\r\n            to { transform: translateX(0); }\r\n        }\r\n\r\n        .preview-panel {\r\n            position: fixed;\r\n            top: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            width: 500px;\r\n            max-width: 90vw;\r\n            background: var(--uui-color-surface);\r\n            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);\r\n            z-index: 1001;\r\n            display: flex;\r\n            flex-direction: column;\r\n            animation: slideIn 0.3s ease-out;\r\n        }\r\n\r\n        .preview-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            padding: var(--uui-size-space-5);\r\n            border-bottom: 1px solid var(--uui-color-border);\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .preview-header h3 {\r\n            margin: 0;\r\n            font-size: 1.2rem;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .preview-content {\r\n            flex: 1;\r\n            overflow-y: auto;\r\n            padding: var(--uui-size-space-5);\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-4);\r\n        }\r\n\r\n        .preview-filename {\r\n            padding: var(--uui-size-space-3);\r\n            background: var(--uui-color-surface-alt);\r\n            border-radius: var(--uui-border-radius);\r\n            word-break: break-all;\r\n        }\r\n\r\n        .preview-image-container {\r\n            flex: 1;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            background: var(--uui-color-surface-alt);\r\n            border-radius: var(--uui-border-radius);\r\n            padding: var(--uui-size-space-4);\r\n            min-height: 300px;\r\n        }\r\n\r\n        .preview-image-container img {\r\n            max-width: 100%;\r\n            max-height: 60vh;\r\n            object-fit: contain;\r\n            border-radius: var(--uui-border-radius);\r\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n        }\r\n\r\n        .preview-actions {\r\n            display: flex;\r\n            gap: var(--uui-size-space-3);\r\n            padding-top: var(--uui-size-space-4);\r\n            border-top: 1px solid var(--uui-color-border);\r\n        }\r\n\r\n        .preview-actions uui-button {\r\n            flex: 1;\r\n        }\r\n\r\n        /* Comparison Panel Styles */\r\n        .comparison-panel {\r\n            position: fixed;\r\n            top: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            width: 900px;\r\n            max-width: 95vw;\r\n            background: var(--uui-color-surface);\r\n            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);\r\n            z-index: 1001;\r\n            display: flex;\r\n            flex-direction: column;\r\n            animation: slideIn 0.3s ease-out;\r\n        }\r\n\r\n        .comparison-content {\r\n            flex: 1;\r\n            overflow-y: auto;\r\n            padding: var(--uui-size-space-5);\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-5);\r\n        }\r\n\r\n        /* Side-by-side image layout */\r\n        .side-by-side {\r\n            display: flex;\r\n            gap: var(--uui-size-space-4);\r\n            align-items: flex-start;\r\n        }\r\n\r\n        .compare-column {\r\n            flex: 1;\r\n            min-width: 0;\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-3);\r\n        }\r\n\r\n        .compare-label {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .compare-filename {\r\n            font-size: 0.85rem;\r\n            color: var(--uui-color-text-alt);\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            white-space: nowrap;\r\n        }\r\n\r\n        .compare-image-container {\r\n            background: var(--uui-color-surface-alt);\r\n            border-radius: var(--uui-border-radius);\r\n            padding: var(--uui-size-space-3);\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            min-height: 200px;\r\n            border: 1px solid var(--uui-color-border);\r\n        }\r\n\r\n        .compare-image-container img {\r\n            max-width: 100%;\r\n            max-height: 50vh;\r\n            object-fit: contain;\r\n            border-radius: var(--uui-border-radius);\r\n        }\r\n\r\n        .compare-divider {\r\n            width: 1px;\r\n            align-self: stretch;\r\n            background: var(--uui-color-border);\r\n        }\r\n\r\n        /* Slider comparison */\r\n        .slider-comparison {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-3);\r\n        }\r\n\r\n        .slider-container {\r\n            position: relative;\r\n            overflow: hidden;\r\n            border-radius: var(--uui-border-radius);\r\n            border: 1px solid var(--uui-color-border);\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .slider-img-under {\r\n            display: block;\r\n            width: 100%;\r\n            max-height: 50vh;\r\n            object-fit: contain;\r\n        }\r\n\r\n        .slider-img-over {\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n            bottom: 0;\r\n            overflow: hidden;\r\n        }\r\n\r\n        .slider-img-over img {\r\n            display: block;\r\n            height: 100%;\r\n            max-height: 50vh;\r\n            object-fit: contain;\r\n        }\r\n\r\n        .slider-handle {\r\n            position: absolute;\r\n            top: 0;\r\n            bottom: 0;\r\n            width: 3px;\r\n            background: var(--uui-color-interactive);\r\n            transform: translateX(-50%);\r\n            pointer-events: none;\r\n        }\r\n\r\n        .slider-handle-line {\r\n            position: absolute;\r\n            top: 50%;\r\n            left: 50%;\r\n            transform: translate(-50%, -50%);\r\n            width: 28px;\r\n            height: 28px;\r\n            border-radius: 50%;\r\n            background: var(--uui-color-interactive);\r\n            border: 2px solid var(--uui-color-surface);\r\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\r\n        }\r\n\r\n        .slider-range {\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            opacity: 0;\r\n            cursor: ew-resize;\r\n            margin: 0;\r\n        }\r\n\r\n        .slider-labels {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            font-size: 0.85rem;\r\n        }\r\n\r\n        .slider-labels span {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        /* Metadata diff table */\r\n        .metadata-comparison {\r\n            border-top: 1px solid var(--uui-color-border);\r\n            padding-top: var(--uui-size-space-4);\r\n        }\r\n\r\n        .metadata-comparison h4 {\r\n            margin: 0 0 var(--uui-size-space-3) 0;\r\n            font-size: 1rem;\r\n        }\r\n\r\n        @media (max-width: 768px) {\r\n            .preview-panel {\r\n                width: 100vw;\r\n                max-width: 100vw;\r\n            }\r\n            .comparison-panel {\r\n                width: 100vw;\r\n                max-width: 100vw;\r\n            }\r\n            .side-by-side {\r\n                flex-direction: column;\r\n            }\r\n            .compare-divider {\r\n                width: 100%;\r\n                height: 1px;\r\n            }\r\n        }\r\n    `;\r\n}\r\n\r\n// Global declaration for TS intellisense\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'snapshot-viewer': SnapshotViewerElement;\r\n    }\r\n}"],"names":["SnapshotViewerElement","UmbElementMixin","LitElement","UMB_AUTH_CONTEXT","instance","UMB_NOTIFICATION_CONTEXT","UMB_MODAL_MANAGER_CONTEXT","UMB_WORKSPACE_CONTEXT","workspaceContext","entityWorkspace","unique","mediaKey","token","url","response","error","snapshotVersion","currentMedia","input","start","event","target","filename","imageExtensions","extension","version","modalHandler","UMB_CONFIRM_MODAL","html","result","bytes","units","i","index","snapshot","current","bothAreImages","sizeDiff","sizeDiffLabel","isSingleVersion","pagedVersions","pageOffset","v","dateString","css","__decorateClass","state","customElement"],"mappings":";;;;;;;;;;;AAgBO,IAAMA,IAAN,cAAoCC,EAAgBC,CAAU,EAAE;AAAA,EAmDnE,cAAc;AACV,UAAA,GAjDJ,KAAQ,YAAmB,CAAA,GAG3B,KAAQ,WAAW,IAGnB,KAAQ,YAAY,IAGpB,KAAQ,mBAAkC,MAG1C,KAAQ,oBAA4B,IAGpC,KAAQ,eAAe,IAGvB,KAAQ,eAAe,IAGvB,KAAQ,eAAe,GAIvB,KAAQ,kBAAkB,IAG1B,KAAQ,sBAA2B,MAGnC,KAAQ,qBAA0B,MAGlC,KAAQ,qBAAqB,IAG7B,KAAQ,kBAA6C,gBAGrD,KAAQ,kBAAkB,IAE1B,KAAQ,YAAY,IAUhB,KAAK,eAAeC,GAAkB,CAACC,MAAa;AAChD,WAAK,eAAeA;AAAA,IACxB,CAAC,GAGD,KAAK,eAAeC,GAA0B,CAACD,MAAa;AACxD,WAAK,uBAAuBA;AAAA,IAChC,CAAC,GAGD,KAAK,eAAeE,GAA2B,CAACF,MAAa;AACzD,WAAK,uBAAuBA;AAAA,IAChC,CAAC,GAED,KAAK,eAAeG,GAAuB,CAACC,MAAqB;AAC7D,YAAMC,IAAkBD;AACxB,MAAIC,EAAgB,UAChB,KAAK,QAAQA,EAAgB,QAAQ,CAACC,MAAW;AAC7C,QAAIA,KAAUA,MAAW,KAAK,cAC1B,KAAK,YAAYA,EAAO,SAAA,GACxB,KAAK,eAAe,GACpB,KAAK,eAAe,KAAK,SAAS;AAAA,MAE1C,CAAC;AAAA,IAET,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAc,eAAeC,GAAkB;AAC3C,SAAK,WAAW;AAGhB,UAAMC,IAAQ,MAAM,KAAK,cAAc,eAAA;AAEvC,QAAI,CAACA,GAAO;AACR,cAAQ,MAAM,oCAAoC,GAClD,KAAK,sBAAsB,KAAK,UAAU;AAAA,QACtC,MAAM,EAAE,UAAU,wBAAwB,SAAS,qCAAA;AAAA,MAAqC,CAC3F,GACD,KAAK,WAAW;AAChB;AAAA,IACJ;AAEA,QAAI;AACA,YAAMC,IAAM,gDAAgDF,CAAQ,IAG9DG,IAAW,MAAM,MAAMD,GAAK;AAAA,QAC9B,QAAQ;AAAA,QACR,SAAS;AAAA,UACL,eAAiB,UAAUD,CAAK;AAAA,UAChC,gBAAgB;AAAA,QAAA;AAAA,MACpB,CACH;AAED,MAAIE,EAAS,KACT,KAAK,YAAY,MAAMA,EAAS,KAAA,IACzBA,EAAS,WAAW,QAC3B,QAAQ,MAAM,6CAA6C,GAC3D,KAAK,sBAAsB,KAAK,UAAU;AAAA,QACtC,MAAM,EAAE,UAAU,gBAAgB,SAAS,gCAAA;AAAA,MAAgC,CAC9E;AAAA,IAET,SAASC,GAAO;AACZ,cAAQ,MAAM,8BAA8BA,CAAK,GACjD,KAAK,sBAAsB,KAAK,UAAU;AAAA,QACtC,MAAM,EAAE,UAAU,SAAS,SAAS,6BAAA;AAAA,MAA6B,CACpE;AAAA,IACL,UAAA;AACI,WAAK,WAAW;AAAA,IACpB;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,qBAA0C;AACpD,UAAMH,IAAQ,MAAM,KAAK,cAAc,eAAA;AACvC,QAAI,CAACA,EAAO,QAAO;AAEnB,QAAI;AACA,YAAMC,IAAM,+CAA+C,KAAK,SAAS,IACnEC,IAAW,MAAM,MAAMD,GAAK;AAAA,QAC9B,QAAQ;AAAA,QACR,SAAS;AAAA,UACL,eAAiB,UAAUD,CAAK;AAAA,UAChC,gBAAgB;AAAA,QAAA;AAAA,MACpB,CACH;AAED,UAAIE,EAAS;AACT,eAAO,MAAMA,EAAS,KAAA;AAAA,IAE9B,SAASC,GAAO;AACZ,cAAQ,MAAM,kCAAkCA,CAAK;AAAA,IACzD;AACA,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,gBAAgBC,GAAsB;AAChD,SAAK,qBAAqB,IAC1B,KAAK,sBAAsBA,GAC3B,KAAK,kBAAkB,IACvB,KAAK,kBAAkB;AAEvB,UAAMC,IAAe,MAAM,KAAK,mBAAA;AAChC,SAAK,qBAAqBA,GAC1B,KAAK,qBAAqB;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB;AACvB,SAAK,kBAAkB,IACvB,KAAK,sBAAsB,MAC3B,KAAK,qBAAqB;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKQ,wBAAwB;AAC5B,SAAK,kBAAkB,KAAK,oBAAoB,iBAAiB,WAAW;AAAA,EAChF;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAe,GAAU;AAC7B,UAAMC,IAAQ,EAAE;AAChB,SAAK,kBAAkB,SAASA,EAAM,OAAO,EAAE;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA,EAKA,IAAY,cAAsB;AAC9B,WAAO,KAAK,IAAI,GAAG,KAAK,KAAK,KAAK,UAAU,SAAS,KAAK,SAAS,CAAC;AAAA,EACxE;AAAA;AAAA;AAAA;AAAA,EAKA,IAAY,iBAAwB;AAChC,UAAMC,KAAS,KAAK,eAAe,KAAK,KAAK;AAC7C,WAAO,KAAK,UAAU,MAAMA,GAAOA,IAAQ,KAAK,SAAS;AAAA,EAC7D;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAcC,GAAc;AAChC,UAAMC,IAASD,EAAM;AACrB,SAAK,eAAeC,EAAO;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKQ,SAASC,GAA2B;AACxC,UAAMC,IAAkB,CAAC,QAAQ,SAAS,QAAQ,QAAQ,QAAQ,SAAS,MAAM,GAC3EC,IAAYF,EAAS,UAAUA,EAAS,YAAY,GAAG,CAAC,EAAE,YAAA;AAChE,WAAOC,EAAgB,SAASC,CAAS;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkBC,GAAc;AACpC,IAAK,KAAK,SAASA,EAAQ,IAAI,MAE/B,KAAK,mBAAmBA,EAAQ,KAChC,KAAK,oBAAoBA,EAAQ,MACjC,KAAK,eAAe;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB;AACpB,SAAK,eAAe,IACpB,KAAK,mBAAmB,MACxB,KAAK,oBAAoB;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,gBAAgBA,GAAc;AAExC,QAAI,KAAK,cAAc;AACnB,cAAQ,KAAK,6BAA6B;AAC1C;AAAA,IACJ;AAEA,QAAI,CAAC,KAAK,sBAAsB;AAC5B,cAAQ,MAAM,qCAAqC;AACnD;AAAA,IACJ;AAGA,UAAMC,IAAe,KAAK,qBAAqB,KAAK,MAAMC,GAAmB;AAAA,MACzE,MAAM;AAAA,QACF,UAAU;AAAA,QACV,SAASC;AAAA,mEAC0CH,EAAQ,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAS/D,OAAO;AAAA,QACP,cAAc;AAAA,MAAA;AAAA,IAClB,CACH;AAGD,QAAI;AACA,YAAMC,EAAa,SAAA;AAAA,IACvB,QAAQ;AAEJ;AAAA,IACJ;AAGA,SAAK,eAAe;AAEpB,UAAMd,IAAQ,MAAM,KAAK,cAAc,eAAA;AACvC,QAAI,CAACA,GAAO;AACR,WAAK,sBAAsB,KAAK,UAAU;AAAA,QACtC,MAAM,EAAE,UAAU,wBAAwB,SAAS,qCAAA;AAAA,MAAqC,CAC3F,GACD,KAAK,eAAe;AACpB;AAAA,IACJ;AAEA,QAAI;AAEA,YAAME,IAAW,MAAM,MADX,+CACsB;AAAA,QAC9B,QAAQ;AAAA,QACR,SAAS;AAAA,UACL,eAAiB,UAAUF,CAAK;AAAA,UAChC,gBAAgB;AAAA,QAAA;AAAA,QAEpB,MAAM,KAAK,UAAU;AAAA,UACjB,UAAU,KAAK;AAAA,UACf,cAAca,EAAQ;AAAA,QAAA,CACzB;AAAA,MAAA,CACJ;AAED,UAAIX,EAAS,IAAI;AACb,cAAMe,IAAS,MAAMf,EAAS,KAAA;AAG9B,aAAK,sBAAsB,KAAK,YAAY;AAAA,UACxC,MAAM;AAAA,YACF,UAAU;AAAA,YACV,SAASe,EAAO;AAAA,UAAA;AAAA,QACpB,CACH,GAGD,MAAM,KAAK,eAAe,KAAK,SAAS;AAAA,MAC5C,WAAWf,EAAS,WAAW;AAC3B,aAAK,sBAAsB,KAAK,UAAU;AAAA,UACtC,MAAM;AAAA,YACF,UAAU;AAAA,YACV,SAAS;AAAA,UAAA;AAAA,QACb,CACH;AAAA,WACE;AACH,cAAMC,IAAQ,MAAMD,EAAS,KAAA;AAC7B,aAAK,sBAAsB,KAAK,UAAU;AAAA,UACtC,MAAM;AAAA,YACF,UAAU;AAAA,YACV,SAASC,EAAM,UAAU;AAAA,UAAA;AAAA,QAC7B,CACH;AAAA,MACL;AAAA,IACJ,SAASA,GAAO;AACZ,cAAQ,MAAM,+BAA+BA,CAAK,GAClD,KAAK,sBAAsB,KAAK,UAAU;AAAA,QACtC,MAAM;AAAA,UACF,UAAU;AAAA,UACV,SAAS;AAAA,QAAA;AAAA,MACb,CACH;AAAA,IACL,UAAA;AAEI,WAAK,eAAe;AAAA,IACxB;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAYe,GAAuB;AACvC,QAAIA,MAAU,EAAG,QAAO;AACxB,UAAMC,IAAQ,CAAC,KAAK,MAAM,MAAM,IAAI,GAC9BC,IAAI,KAAK,MAAM,KAAK,IAAIF,CAAK,IAAI,KAAK,IAAI,IAAI,CAAC;AACrD,YAAQA,IAAQ,KAAK,IAAI,MAAME,CAAC,GAAG,QAAQ,CAAC,IAAI,MAAMD,EAAMC,CAAC;AAAA,EACjE;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAcP,GAAcQ,GAAe;AAC/C,WAAIR,EAAQ,aACDG;AAAA;AAAA;AAAA,+BAGYH,EAAQ,eAAe,KAAK,YAAYA,EAAQ,YAAY,IAAI,EAAE;AAAA;AAAA,gBAMrFQ,MAAU,IACHL;AAAA;AAAA;AAAA;AAAA;AAAA,gBAQJA;AAAA;AAAA;AAAA;AAAA;AAAA,EAKX;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB;AACxB,QAAI,CAAC,KAAK,gBAAiB,QAAO;AAElC,UAAMM,IAAW,KAAK,qBAChBC,IAAU,KAAK,oBACfC,IAAgBF,KAAYC,KAC3B,KAAK,SAASD,EAAS,IAAI,KAAK,KAAK,SAASC,EAAQ,IAAI;AAEjE,WAAOP;AAAA,mDACoC,KAAK,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAQ9CQ,IAAgBR;AAAA;AAAA;AAAA;AAAA,0CAIA,KAAK,qBAAqB;AAAA;AAAA,kDAElB,KAAK,oBAAoB,iBAAiB,oBAAoB,YAAY;AAAA,kCAC1F,KAAK,oBAAoB,iBAAiB,WAAW,cAAc;AAAA;AAAA,4BAEzE,EAAE;AAAA;AAAA;AAAA;AAAA,sCAIQ,KAAK,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAMrC,KAAK,qBACDA,iFACCO,IAEGC,IACI,KAAK,uBAAuBD,GAASD,CAAQ,IAC7C,KAAK,0BAA0BC,GAASD,CAAQ,IAHpDN,kFAIV;AAAA;AAAA;AAAA;AAAA,EAIhB;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAAuBO,GAAcD,GAAe;AACxD,WAAI,KAAK,oBAAoB,WAClBN;AAAA;AAAA;AAAA,6DAG0CO,EAAQ,GAAG;AAAA,qEACH,KAAK,eAAe;AAAA,wCACjDD,EAAS,GAAG;AAAA;AAAA,kEAEc,KAAK,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAOhD,OAAO,KAAK,eAAe,CAAC;AAAA,sCAC5B,KAAK,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA,2FAKkCA,EAAS,IAAI;AAAA,2FACbC,EAAQ,IAAI;AAAA;AAAA;AAAA,kBAGrF,KAAK,0BAA0BA,GAASD,CAAQ,CAAC;AAAA,gBAIpDN;AAAA;AAAA;AAAA;AAAA;AAAA,yDAK0CM,EAAS,IAAI;AAAA;AAAA;AAAA,oCAGlCA,EAAS,GAAG,UAAUA,EAAS,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yDAOdC,EAAQ,IAAI;AAAA;AAAA;AAAA,oCAGjCA,EAAQ,GAAG,UAAUA,EAAQ,IAAI;AAAA;AAAA;AAAA;AAAA,cAIvD,KAAK,0BAA0BA,GAASD,CAAQ,CAAC;AAAA;AAAA,EAE3D;AAAA;AAAA;AAAA;AAAA,EAKQ,0BAA0BC,GAAcD,GAAe;AAC3D,UAAMG,IAAWF,EAAQ,OAAOD,EAAS,MACnCI,IAAgBD,IAAW,IAC3B,IAAI,KAAK,YAAYA,CAAQ,CAAC,KAC9BA,IAAW,IACP,IAAI,KAAK,YAAY,KAAK,IAAIA,CAAQ,CAAC,CAAC,KACxC;AAEV,WAAOT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0CAY2BM,EAAS,IAAI;AAAA,0CACbC,EAAQ,IAAI;AAAA;AAAA,8BAExBD,EAAS,SAASC,EAAQ,OACtBP,8DACAA,4DACN;AAAA;AAAA;AAAA;AAAA;AAAA,0CAKc,KAAK,YAAYM,EAAS,IAAI,CAAC;AAAA,0CAC/B,KAAK,YAAYC,EAAQ,IAAI,CAAC;AAAA;AAAA,+DAETE,MAAa,IAAI,YAAYA,IAAW,IAAI,YAAY,UAAU;AAAA,kCAC/FC,CAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0CAML,KAAK,YAAYJ,EAAS,IAAI,CAAC;AAAA,0CAC/B,KAAK,YAAYC,EAAQ,YAAY,CAAC;AAAA;AAAA;AAAA,sBAG1DD,EAAS,WAAWN;AAAA;AAAA;AAAA,8CAGIM,EAAS,SAAS,QAAQ,MAAM,GAAG,CAAC;AAAA;AAAA;AAAA;AAAA,wBAI1D,EAAE;AAAA;AAAA;AAAA;AAAA,EAItB;AAAA,EAEA,SAAS;AACL,QAAI,KAAK;AACL,aAAON;AAGX,QAAI,KAAK,UAAU,WAAW;AAC1B,aAAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUX,UAAMW,IAAkB,KAAK,UAAU,WAAW,GAC5CC,IAAgB,KAAK,gBACrBC,KAAc,KAAK,eAAe,KAAK,KAAK;AAElD,WAAOb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAWOY,EAAc,IAAI,CAACE,GAAGV,MAAMJ;AAAA;AAAA;AAAA,kCAGhB,KAAK,SAASc,EAAE,IAAI,IAChBd;AAAA;AAAA;AAAA,sDAGgB,MAAM,KAAK,kBAAkBc,CAAC,CAAC;AAAA;AAAA;AAAA,8CAGvCA,EAAE,IAAI;AAAA;AAAA,wCAGdd,UAAac,EAAE,IAAI,SACzB;AAAA;AAAA,8CAEc,KAAK,YAAYA,EAAE,IAAI,CAAC;AAAA,8CACxBA,EAAE,SAAS,QAAQ,MAAM,GAAG,CAAC;AAAA;AAAA,kCAEzC,KAAK,cAAcA,GAAGD,IAAaT,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qDAOjBS,IAAaT,MAAO,CAAC;AAAA,iDACzBS,IAAaT,MAAO,IAAI,+BAA+B,2BAA2B;AAAA,kDAClF,MAAM,KAAK,gBAAgBU,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gDAM/BA,EAAE,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qDAQAH,KAAmB,KAAK,gBAAiBE,IAAaT,MAAO,CAAC;AAAA,iDAClEO,IAAkB,gDAAiDE,IAAaT,MAAO,IAAI,uCAAuC,sBAAsB;AAAA,kDACvJ,MAAM,KAAK,gBAAgBU,CAAC,CAAC;AAAA,oFACK,KAAK,eAAe,iBAAiB,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA,qBAK7G,CAAC;AAAA;AAAA;AAAA,kBAGJ,KAAK,cAAc,IAAId;AAAA;AAAA;AAAA,wCAGD,KAAK,YAAY;AAAA,sCACnB,KAAK,WAAW;AAAA,uCACf,KAAK,aAAa;AAAA;AAAA;AAAA,oBAGrC,EAAE;AAAA;AAAA;AAAA,kBAGJ,KAAK,eAAeA;AAAA,2DACqB,KAAK,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0CAUnC,KAAK,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kEAMM,KAAK,iBAAiB;AAAA;AAAA;AAAA,kCAGtD,KAAK,mBACDA;AAAA;AAAA,mDAEa,KAAK,gBAAgB;AAAA,mDACrB,KAAK,iBAAiB;AAAA,sDACnB,MAAM;AACZ,WAAK,sBAAsB,KAAK,WAAW;AAAA,QACvC,MAAM;AAAA,UACF,UAAU;AAAA,UACV,SAAS;AAAA,QAAA;AAAA,MACb,CACH;AAAA,IACL,CAAC;AAAA;AAAA,wCAGPA,4BACN;AAAA;AAAA;AAAA;AAAA;AAAA,4CAKY,KAAK,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4CAMrB,KAAK,gBAAgB;AAAA,gDACjB,KAAK,iBAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAMlD,EAAE;AAAA;AAAA;AAAA,kBAGJ,KAAK,mBAAmB;AAAA;AAAA;AAAA,EAGtC;AAAA,EAEQ,YAAYe,GAAoB;AAEpC,WADa,IAAI,KAAKA,CAAU,EACpB,mBAAmB,QAAW;AAAA,MACtC,KAAK;AAAA,MACL,OAAO;AAAA,MACP,MAAM;AAAA,MACN,MAAM;AAAA,MACN,QAAQ;AAAA,IAAA,CACX;AAAA,EACL;AAkWJ;AApkCa3C,EAouBF,SAAS4C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAjuBRC,EAAA;AAAA,EADPC,EAAA;AAAM,GAFE9C,EAGD,WAAA,aAAA,CAAA;AAGA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GALE9C,EAMD,WAAA,YAAA,CAAA;AAGA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GARE9C,EASD,WAAA,aAAA,CAAA;AAGA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GAXE9C,EAYD,WAAA,oBAAA,CAAA;AAGA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GAdE9C,EAeD,WAAA,qBAAA,CAAA;AAGA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GAjBE9C,EAkBD,WAAA,gBAAA,CAAA;AAGA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GApBE9C,EAqBD,WAAA,gBAAA,CAAA;AAGA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GAvBE9C,EAwBD,WAAA,gBAAA,CAAA;AAIA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GA3BE9C,EA4BD,WAAA,mBAAA,CAAA;AAGA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GA9BE9C,EA+BD,WAAA,uBAAA,CAAA;AAGA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GAjCE9C,EAkCD,WAAA,sBAAA,CAAA;AAGA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GApCE9C,EAqCD,WAAA,sBAAA,CAAA;AAGA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GAvCE9C,EAwCD,WAAA,mBAAA,CAAA;AAGA6C,EAAA;AAAA,EADPC,EAAA;AAAM,GA1CE9C,EA2CD,WAAA,mBAAA,CAAA;AA3CCA,IAAN6C,EAAA;AAAA,EADNE,EAAc,iBAAiB;AAAA,GACnB/C,CAAA;"}