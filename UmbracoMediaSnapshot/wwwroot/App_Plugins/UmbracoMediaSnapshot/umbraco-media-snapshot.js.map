{"version":3,"file":"umbraco-media-snapshot.js","sources":["../../../Client/src/snapshot-viewer.ts"],"sourcesContent":["import { LitElement, html, css, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbElementMixin } from '@umbraco-cms/backoffice/element-api';\r\nimport { UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_NOTIFICATION_CONTEXT } from '@umbraco-cms/backoffice/notification';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_CONFIRM_MODAL } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbEntityWorkspaceContext } from '@umbraco-cms/backoffice/workspace';\r\nimport type { UmbNotificationContext } from '@umbraco-cms/backoffice/notification';\r\nimport type { UmbModalManagerContext } from '@umbraco-cms/backoffice/modal';\r\n\r\n/**\r\n * Snapshot Viewer Property Editor\r\n * Displays a list of file versions from the umbraco-snapshots Azure container\r\n */\r\n@customElement('snapshot-viewer')\r\nexport class SnapshotViewerElement extends UmbElementMixin(LitElement) {\r\n\r\n    @state()\r\n    private _versions: any[] = [];\r\n\r\n    @state()\r\n    private _loading = true;\r\n\r\n    @state()\r\n    private _mediaKey = '';\r\n\r\n    @state()\r\n    private _previewImageUrl: string | null = null;\r\n\r\n    @state()\r\n    private _previewImageName: string = '';\r\n\r\n    @state()\r\n    private _showPreview = false;\r\n\r\n    @state()\r\n    private _isRestoring = false;\r\n\r\n    @state()\r\n    private _currentPage = 1;\r\n\r\n    private _pageSize = 10;\r\n\r\n    private _authContext?: typeof UMB_AUTH_CONTEXT.TYPE;\r\n    private _notificationContext?: UmbNotificationContext;\r\n    private _modalManagerContext?: UmbModalManagerContext;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        // 1. Consume the Auth Context to manage tokens\r\n        this.consumeContext(UMB_AUTH_CONTEXT, (instance) => {\r\n            this._authContext = instance;\r\n        });\r\n\r\n        // Consume the Notification Context\r\n        this.consumeContext(UMB_NOTIFICATION_CONTEXT, (instance) => {\r\n            this._notificationContext = instance;\r\n        });\r\n\r\n        // Consume the Modal Manager Context\r\n        this.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => {\r\n            this._modalManagerContext = instance;\r\n        });\r\n\r\n        this.consumeContext(UMB_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n            const entityWorkspace = workspaceContext as unknown as UmbEntityWorkspaceContext;\r\n            if (entityWorkspace.unique) {\r\n                this.observe(entityWorkspace.unique, (unique) => {\r\n                    if (unique && unique !== this._mediaKey) {\r\n                        this._mediaKey = unique.toString();\r\n                        this._currentPage = 1;\r\n                        this._fetchVersions(this._mediaKey);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Calls the C# Management API to get the list of blobs\r\n     * Umbraco 17 automatically injects Auth Bearer tokens into fetch \r\n     * requests starting with /umbraco/management/api/\r\n     */\r\n    private async _fetchVersions(mediaKey: string) {\r\n        this._loading = true;\r\n\r\n        // 2. Get the latest token from the auth context\r\n        const token = await this._authContext?.getLatestToken();\r\n\r\n        if (!token) {\r\n            console.error(\"No authentication token available.\");\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Authentication Error', message: 'No authentication token available.' } \r\n            });\r\n            this._loading = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const url = `/umbraco/management/api/v1/snapshot/versions/${mediaKey}`;\r\n\r\n            // 3. Manually add the Authorization header\r\n            const response = await fetch(url, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            });\r\n\r\n            if (response.ok) {\r\n                this._versions = await response.json();\r\n            } else if (response.status === 401) {\r\n                console.error(\"Unauthorized: The session may have expired.\");\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { headline: 'Unauthorized', message: 'The session may have expired.' } \r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch snapshots:\", error);\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Error', message: 'Failed to fetch snapshots.' } \r\n            });\r\n        } finally {\r\n            this._loading = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns the total number of pages based on versions count and page size\r\n     */\r\n    private get _totalPages(): number {\r\n        return Math.max(1, Math.ceil(this._versions.length / this._pageSize));\r\n    }\r\n\r\n    /**\r\n     * Returns the versions for the current page\r\n     */\r\n    private get _pagedVersions(): any[] {\r\n        const start = (this._currentPage - 1) * this._pageSize;\r\n        return this._versions.slice(start, start + this._pageSize);\r\n    }\r\n\r\n    /**\r\n     * Handles page change from the pagination component\r\n     */\r\n    private _onPageChange(event: Event) {\r\n        const target = event.target as HTMLElement & { current: number };\r\n        this._currentPage = target.current;\r\n    }\r\n\r\n    /**\r\n     * Checks if a filename is an image based on extension\r\n     */\r\n    private _isImage(filename: string): boolean {\r\n        const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp', '.svg'];\r\n        const extension = filename.substring(filename.lastIndexOf('.')).toLowerCase();\r\n        return imageExtensions.includes(extension);\r\n    }\r\n\r\n    /**\r\n     * Opens the image preview panel\r\n     */\r\n    private _openImagePreview(version: any) {\r\n        if (!this._isImage(version.name)) return;\r\n        \r\n        this._previewImageUrl = version.url;\r\n        this._previewImageName = version.name;\r\n        this._showPreview = true;\r\n    }\r\n\r\n    /**\r\n     * Closes the image preview panel\r\n     */\r\n    private _closePreview() {\r\n        this._showPreview = false;\r\n        this._previewImageUrl = null;\r\n        this._previewImageName = '';\r\n    }\r\n\r\n    /**\r\n     * Restores a specific snapshot version as the current file\r\n     */\r\n    private async _restoreVersion(version: any) {\r\n        // Prevent multiple simultaneous restore operations\r\n        if (this._isRestoring) {\r\n            console.warn(\"Restore already in progress\");\r\n            return;\r\n        }\r\n\r\n        if (!this._modalManagerContext) {\r\n            console.error(\"Modal manager context not available\");\r\n            return;\r\n        }\r\n\r\n        // Show Umbraco-styled confirmation modal\r\n        const modalHandler = this._modalManagerContext.open(this, UMB_CONFIRM_MODAL, {\r\n            data: {\r\n                headline: 'Restore File Version',\r\n                content: html`\r\n                    <p>Are you sure you want to restore <strong>\"${version.name}\"</strong>?</p>\r\n                    <p>This will replace the current file and create a new snapshot.</p>\r\n                    <uui-box>\r\n                        <p style=\"margin: 0;\">\r\n                            <uui-icon name=\"icon-alert\"></uui-icon>\r\n                            <strong>Warning:</strong> This action cannot be undone.\r\n                        </p>\r\n                    </uui-box>\r\n                `,\r\n                color: 'danger',\r\n                confirmLabel: 'Restore'\r\n            }\r\n        });\r\n\r\n        // Wait for user to confirm or cancel\r\n        try {\r\n            await modalHandler.onSubmit();\r\n        } catch {\r\n            // User cancelled the modal\r\n            return;\r\n        }\r\n\r\n        // Set the restoring flag\r\n        this._isRestoring = true;\r\n\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) {\r\n            this._notificationContext?.peek('danger', { \r\n                data: { headline: 'Authentication Error', message: 'No authentication token available.' } \r\n            });\r\n            this._isRestoring = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const url = `/umbraco/management/api/v1/snapshot/restore`;\r\n            const response = await fetch(url, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    mediaKey: this._mediaKey,\r\n                    snapshotName: version.name\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                const result = await response.json();\r\n                \r\n                // Use Umbraco notification instead of alert\r\n                this._notificationContext?.peek('positive', { \r\n                    data: { \r\n                        headline: 'Snapshot Restored', \r\n                        message: result.message \r\n                    } \r\n                });\r\n                \r\n                // Refresh the version list\r\n                await this._fetchVersions(this._mediaKey);\r\n            } else if (response.status === 401) {\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { \r\n                        headline: 'Unauthorized', \r\n                        message: 'Your session may have expired. Please refresh the page.' \r\n                    } \r\n                });\r\n            } else {\r\n                const error = await response.json();\r\n                this._notificationContext?.peek('danger', { \r\n                    data: { \r\n                        headline: 'Restore Failed', \r\n                        message: error.detail || 'Unknown error' \r\n                    } \r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to restore snapshot:\", error);\r\n            this._notificationContext?.peek('danger', { \r\n                data: { \r\n                    headline: 'Error', \r\n                    message: 'An error occurred while restoring the snapshot. Please try again.' \r\n                } \r\n            });\r\n        } finally {\r\n            // Always reset the restoring flag\r\n            this._isRestoring = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Renders the status tag for a snapshot version based on its metadata\r\n     */\r\n    private _renderStatus(version: any, index: number) {\r\n        if (version.isRestored) {\r\n            return html`\r\n                <uui-tag look=\"primary\" color=\"positive\">\r\n                    <uui-icon name=\"icon-refresh\"></uui-icon>\r\n                    Restored ${version.restoredDate ? this._formatDate(version.restoredDate) : ''}\r\n                </uui-tag>\r\n            `;\r\n        }\r\n\r\n        // The first item (index 0) in the sorted-by-date-descending list is the latest version\r\n        if (index === 0) {\r\n            return html`\r\n                <uui-tag look=\"primary\" color=\"default\">\r\n                    <uui-icon name=\"icon-check\"></uui-icon>\r\n                    Latest\r\n                </uui-tag>\r\n            `;\r\n        }\r\n\r\n        return html`\r\n            <uui-tag look=\"secondary\" color=\"default\">\r\n                Original\r\n            </uui-tag>\r\n        `;\r\n    }\r\n\r\n    render() {\r\n        if (this._loading) {\r\n            return html`<div class=\"loader\"><uui-loader></uui-loader> Fetching snapshots...</div>`;\r\n        }\r\n\r\n        if (this._versions.length === 0) {\r\n            return html`\r\n                <uui-box>\r\n                    <div style=\"display: flex; align-items: center; gap: var(--uui-size-space-3);\">\r\n                        <uui-icon name=\"info\" style=\"color: var(--uui-color-primary);\"></uui-icon>\r\n                        <span>No previous versions found in the snapshots container.</span>\r\n                    </div>\r\n                </uui-box>\r\n            `;\r\n        }\r\n\r\n        const isSingleVersion = this._versions.length === 1;\r\n        const pagedVersions = this._pagedVersions;\r\n        const pageOffset = (this._currentPage - 1) * this._pageSize;\r\n\r\n        return html`\r\n            <div class=\"snapshot-container\">\r\n                <uui-table>\r\n                    <uui-table-head>\r\n                        <uui-table-head-cell>Version Filename</uui-table-head-cell>\r\n                        <uui-table-head-cell>Date Uploaded</uui-table-head-cell>\r\n                        <uui-table-head-cell>Uploaded By</uui-table-head-cell>\r\n                        <uui-table-head-cell>Status</uui-table-head-cell>\r\n                        <uui-table-head-cell>Actions</uui-table-head-cell>\r\n                    </uui-table-head>\r\n\r\n                    ${pagedVersions.map((v, i) => html`\r\n                        <uui-table-row>\r\n                            <uui-table-cell>\r\n                                ${this._isImage(v.name) \r\n                                    ? html`\r\n                                        <button \r\n                                            class=\"filename-link\" \r\n                                            @click=\"${() => this._openImagePreview(v)}\"\r\n                                            title=\"Click to preview image\">\r\n                                            <uui-icon name=\"icon-picture\"></uui-icon>\r\n                                            ${v.name}\r\n                                        </button>\r\n                                    `\r\n                                    : html`<span>${v.name}</span>`\r\n                                }\r\n                            </uui-table-cell>\r\n                            <uui-table-cell>${this._formatDate(v.date)}</uui-table-cell>\r\n                            <uui-table-cell>${v.uploader.replace(/_/g, ' ')}</uui-table-cell>\r\n                            <uui-table-cell>\r\n                                ${this._renderStatus(v, pageOffset + i)}\r\n                            </uui-table-cell>\r\n                            <uui-table-cell>\r\n                                <div style=\"display: flex; gap: 8px;\">\r\n                                    <uui-button \r\n                                        look=\"secondary\" \r\n                                        compact \r\n                                        href=\"${v.url}\" \r\n                                        target=\"_blank\">\r\n                                        <uui-icon name=\"icon-download-alt\"></uui-icon> Download\r\n                                    </uui-button>\r\n                                    <uui-button \r\n                                        look=\"primary\" \r\n                                        color=\"positive\"\r\n                                        compact\r\n                                        ?disabled=\"${isSingleVersion || this._isRestoring || (pageOffset + i) === 0}\"\r\n                                        title=\"${isSingleVersion ? 'Cannot restore when only one version exists' : (pageOffset + i) === 0 ? 'This is already the latest version' : 'Restore this version'}\"\r\n                                        @click=\"${() => this._restoreVersion(v)}\">\r\n                                        <uui-icon name=\"icon-refresh\"></uui-icon> ${this._isRestoring ? 'Restoring...' : 'Restore'}\r\n                                    </uui-button>\r\n                                </div>\r\n                            </uui-table-cell>\r\n                        </uui-table-row>\r\n                    `)}\r\n                </uui-table>\r\n\r\n                ${this._totalPages > 1 ? html`\r\n                    <div class=\"pagination-container\">\r\n                        <uui-pagination\r\n                            .current=\"${this._currentPage}\"\r\n                            .total=\"${this._totalPages}\"\r\n                            @change=\"${this._onPageChange}\">\r\n                        </uui-pagination>\r\n                    </div>\r\n                ` : ''}\r\n\r\n                <!-- Image Preview Side Panel -->\r\n                ${this._showPreview ? html`\r\n                    <div class=\"preview-overlay\" @click=\"${this._closePreview}\"></div>\r\n                    <div class=\"preview-panel\">\r\n                        <div class=\"preview-header\">\r\n                            <h3>\r\n                                <uui-icon name=\"icon-picture\"></uui-icon>\r\n                                Image Preview\r\n                            </h3>\r\n                            <uui-button \r\n                                look=\"secondary\" \r\n                                compact\r\n                                @click=\"${this._closePreview}\">\r\n                                <uui-icon name=\"icon-delete\"></uui-icon>\r\n                            </uui-button>\r\n                        </div>\r\n                        <div class=\"preview-content\">\r\n                            <div class=\"preview-filename\">\r\n                                <strong>Filename:</strong> <br/>${this._previewImageName}\r\n                            </div>\r\n                            <div class=\"preview-image-container\">\r\n                                ${this._previewImageUrl \r\n                                    ? html`\r\n                                        <img \r\n                                            src=\"${this._previewImageUrl}\" \r\n                                            alt=\"${this._previewImageName}\"\r\n                                            @error=\"${() => {\r\n                                                this._notificationContext?.peek('warning', { \r\n                                                    data: { \r\n                                                        headline: 'Preview Error', \r\n                                                        message: 'Unable to load image preview' \r\n                                                    } \r\n                                                });\r\n                                            }}\"\r\n                                        />\r\n                                    `\r\n                                    : html`<uui-loader></uui-loader>`\r\n                                }\r\n                            </div>\r\n                            <div class=\"preview-actions\">\r\n                                <uui-button \r\n                                    look=\"primary\" \r\n                                    href=\"${this._previewImageUrl}\" \r\n                                    target=\"_blank\">\r\n                                    <uui-icon name=\"icon-out\"></uui-icon> Open in New Tab\r\n                                </uui-button>\r\n                                <uui-button \r\n                                    look=\"secondary\" \r\n                                    href=\"${this._previewImageUrl}\" \r\n                                    download=\"${this._previewImageName}\">\r\n                                    <uui-icon name=\"icon-download-alt\"></uui-icon> Download\r\n                                </uui-button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ` : ''}\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    private _formatDate(dateString: string) {\r\n        const date = new Date(dateString);\r\n        return date.toLocaleDateString(undefined, {\r\n            day: '2-digit',\r\n            month: 'short',\r\n            year: 'numeric',\r\n            hour: '2-digit',\r\n            minute: '2-digit'\r\n        });\r\n    }\r\n\r\n    static styles = css`\r\n        :host {\r\n            display: block;\r\n            margin-bottom: 20px;\r\n        }\r\n\r\n        .snapshot-container {\r\n            position: relative;\r\n        }\r\n        \r\n        .loader {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 10px;\r\n            padding: 20px;\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        uui-table {\r\n            border: 1px solid var(--uui-color-border);\r\n            border-radius: var(--uui-border-radius);\r\n            background: var(--uui-color-surface);\r\n        }\r\n\r\n        uui-table-head-cell {\r\n            font-weight: bold;\r\n        }\r\n\r\n        uui-icon {\r\n            margin-right: 4px;\r\n        }\r\n\r\n        .filename-link {\r\n            background: none;\r\n            border: none;\r\n            color: var(--uui-color-interactive);\r\n            cursor: pointer;\r\n            padding: 0;\r\n            font: inherit;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n            text-decoration: underline;\r\n            transition: color 0.2s;\r\n        }\r\n\r\n        .filename-link:hover {\r\n            color: var(--uui-color-interactive-emphasis);\r\n        }\r\n\r\n        .filename-link uui-icon {\r\n            margin-right: 4px;\r\n            color: var(--uui-color-primary);\r\n        }\r\n\r\n        /* Pagination Styles */\r\n        .pagination-container {\r\n            display: flex;\r\n            justify-content: center;\r\n            padding: var(--uui-size-space-5) 0;\r\n        }\r\n\r\n        /* Preview Panel Styles */\r\n        .preview-overlay {\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            background: rgba(0, 0, 0, 0.5);\r\n            z-index: 1000;\r\n            animation: fadeIn 0.2s ease-in;\r\n        }\r\n\r\n        @keyframes fadeIn {\r\n            from { opacity: 0; }\r\n            to { opacity: 1; }\r\n        }\r\n\r\n        @keyframes slideIn {\r\n            from { transform: translateX(100%); }\r\n            to { transform: translateX(0); }\r\n        }\r\n\r\n        .preview-panel {\r\n            position: fixed;\r\n            top: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            width: 500px;\r\n            max-width: 90vw;\r\n            background: var(--uui-color-surface);\r\n            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);\r\n            z-index: 1001;\r\n            display: flex;\r\n            flex-direction: column;\r\n            animation: slideIn 0.3s ease-out;\r\n        }\r\n\r\n        .preview-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            padding: var(--uui-size-space-5);\r\n            border-bottom: 1px solid var(--uui-color-border);\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .preview-header h3 {\r\n            margin: 0;\r\n            font-size: 1.2rem;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .preview-content {\r\n            flex: 1;\r\n            overflow-y: auto;\r\n            padding: var(--uui-size-space-5);\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-4);\r\n        }\r\n\r\n        .preview-filename {\r\n            padding: var(--uui-size-space-3);\r\n            background: var(--uui-color-surface-alt);\r\n            border-radius: var(--uui-border-radius);\r\n            word-break: break-all;\r\n        }\r\n\r\n        .preview-image-container {\r\n            flex: 1;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            background: var(--uui-color-surface-alt);\r\n            border-radius: var(--uui-border-radius);\r\n            padding: var(--uui-size-space-4);\r\n            min-height: 300px;\r\n        }\r\n\r\n        .preview-image-container img {\r\n            max-width: 100%;\r\n            max-height: 60vh;\r\n            object-fit: contain;\r\n            border-radius: var(--uui-border-radius);\r\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n        }\r\n\r\n        .preview-actions {\r\n            display: flex;\r\n            gap: var(--uui-size-space-3);\r\n            padding-top: var(--uui-size-space-4);\r\n            border-top: 1px solid var(--uui-color-border);\r\n        }\r\n\r\n        .preview-actions uui-button {\r\n            flex: 1;\r\n        }\r\n\r\n        @media (max-width: 768px) {\r\n            .preview-panel {\r\n                width: 100vw;\r\n                max-width: 100vw;\r\n            }\r\n        }\r\n    `;\r\n}\r\n\r\n// Global declaration for TS intellisense\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'snapshot-viewer': SnapshotViewerElement;\r\n    }\r\n}"],"names":["SnapshotViewerElement","UmbElementMixin","LitElement","UMB_AUTH_CONTEXT","instance","UMB_NOTIFICATION_CONTEXT","UMB_MODAL_MANAGER_CONTEXT","UMB_WORKSPACE_CONTEXT","workspaceContext","entityWorkspace","unique","mediaKey","token","url","response","error","start","event","target","filename","imageExtensions","extension","version","modalHandler","UMB_CONFIRM_MODAL","html","result","index","isSingleVersion","pagedVersions","pageOffset","v","i","dateString","css","__decorateClass","state","customElement"],"mappings":"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"}