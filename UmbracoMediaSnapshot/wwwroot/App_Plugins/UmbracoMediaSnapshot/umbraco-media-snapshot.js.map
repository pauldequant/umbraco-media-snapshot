{"version":3,"file":"umbraco-media-snapshot.js","sources":["../../../Client/src/snapshot-viewer.ts"],"sourcesContent":["import { LitElement, html, css, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbElementMixin } from '@umbraco-cms/backoffice/element-api';\r\nimport { UmbLocalizationController } from '@umbraco-cms/backoffice/localization-api';\r\nimport { UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\nimport { UMB_NOTIFICATION_CONTEXT } from '@umbraco-cms/backoffice/notification';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_CONFIRM_MODAL } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbEntityWorkspaceContext } from '@umbraco-cms/backoffice/workspace';\r\nimport type { UmbNotificationContext } from '@umbraco-cms/backoffice/notification';\r\nimport type { UmbModalManagerContext } from '@umbraco-cms/backoffice/modal';\r\n\r\n/**\r\n * Snapshot Viewer Property Editor\r\n * Displays a list of file versions from the umbraco-snapshots Azure container\r\n */\r\n@customElement('snapshot-viewer')\r\nexport class SnapshotViewerElement extends UmbElementMixin(LitElement) {\r\n\r\n    readonly #localize = new UmbLocalizationController(this);\r\n\r\n    /** Shorthand for localize.term with the package prefix */\r\n    #t(key: string): string {\r\n        return this.#localize.term(`umbracoMediaSnapshot_${key}`);\r\n    }\r\n\r\n    @state()\r\n    private _versions: any[] = [];\r\n\r\n    @state()\r\n    private _loading = true;\r\n\r\n    @state()\r\n    private _mediaKey = '';\r\n\r\n    @state()\r\n    private _previewImageUrl: string | null = null;\r\n\r\n    @state()\r\n    private _previewImageName: string = '';\r\n\r\n    @state()\r\n    private _showPreview = false;\r\n\r\n    @state()\r\n    private _isRestoring = false;\r\n\r\n    @state()\r\n    private _currentPage = 1;\r\n\r\n    // --- Comparison state ---\r\n    @state()\r\n    private _showComparison = false;\r\n\r\n    @state()\r\n    private _comparisonSnapshot: any = null;\r\n\r\n    @state()\r\n    private _comparisonCurrent: any = null;\r\n\r\n    @state()\r\n    private _comparisonLoading = false;\r\n\r\n    @state()\r\n    private _comparisonMode: 'side-by-side' | 'slider' = 'side-by-side';\r\n\r\n    @state()\r\n    private _sliderPosition = 50;\r\n\r\n    // --- Delete / selection state ---\r\n    @state()\r\n    private _selectedSnapshots: Set<string> = new Set();\r\n\r\n    @state()\r\n    private _isDeleting = false;\r\n\r\n    // --- Note editing state ---\r\n    @state()\r\n    private _editingNoteName: string | null = null;\r\n\r\n    @state()\r\n    private _editingNoteValue: string = '';\r\n\r\n    @state()\r\n    private _savingNote = false;\r\n\r\n    @state()\r\n    private _totalCount = 0;\r\n\r\n    @state()\r\n    private _totalPages = 1;\r\n\r\n    @state()\r\n    private _totalSizeBytes = 0;\r\n\r\n    @state()\r\n    private _oldestDate: string | null = null;\r\n\r\n    @state()\r\n    private _newestDate: string | null = null;\r\n\r\n    @state()\r\n    private _uniqueUploaderCount = 0;\r\n\r\n    @state()\r\n    private _togglingPin: string | null = null;\r\n\r\n    private _pageSize = 10;\r\n\r\n    private _authContext?: typeof UMB_AUTH_CONTEXT.TYPE;\r\n    private _notificationContext?: UmbNotificationContext;\r\n    private _modalManagerContext?: UmbModalManagerContext;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.consumeContext(UMB_AUTH_CONTEXT, (instance) => {\r\n            this._authContext = instance;\r\n        });\r\n\r\n        this.consumeContext(UMB_NOTIFICATION_CONTEXT, (instance) => {\r\n            this._notificationContext = instance;\r\n        });\r\n\r\n        this.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => {\r\n            this._modalManagerContext = instance;\r\n        });\r\n\r\n        this.consumeContext(UMB_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n            const entityWorkspace = workspaceContext as unknown as UmbEntityWorkspaceContext;\r\n            if (entityWorkspace?.unique) {\r\n                this.observe(entityWorkspace.unique, (unique) => {\r\n                    if (unique && unique !== this._mediaKey) {\r\n                        this._mediaKey = unique.toString();\r\n                        this._currentPage = 1;\r\n                        this._fetchVersions(this._mediaKey);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Calls the C# Management API to get the list of blobs\r\n     * Umbraco 17 automatically injects Auth Bearer tokens into fetch \r\n     * requests starting with /umbraco/management/api/\r\n     */\r\n    private async _fetchVersions(mediaKey: string) {\r\n        this._loading = true;\r\n\r\n        // 2. Get the latest token from the auth context\r\n        const token = await this._authContext?.getLatestToken();\r\n\r\n        if (!token) {\r\n            console.error(\"No authentication token available.\");\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: this.#t('authError'), message: this.#t('noAuthToken') }\r\n            });\r\n            this._loading = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const url = `/umbraco/management/api/v1/snapshot/versions/${mediaKey}?page=${this._currentPage}&pageSize=${this._pageSize}`;\r\n\r\n            // 3. Manually add the Authorization header\r\n            const response = await fetch(url, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            });\r\n\r\n            if (response.ok) {\r\n                const result = await response.json();\r\n                this._versions = result.items;\r\n                this._totalCount = result.totalCount;\r\n                this._totalPages = result.totalPages;\r\n                this._totalSizeBytes = result.totalSizeBytes;\r\n                this._oldestDate = result.oldestDate;\r\n                this._newestDate = result.newestDate;\r\n                this._uniqueUploaderCount = result.uniqueUploaderCount;\r\n                // Clear selection when versions are refreshed\r\n                this._selectedSnapshots = new Set();\r\n            } else if (response.status === 401) {\r\n                console.error(\"Unauthorized: The session may have expired.\");\r\n                this._notificationContext?.peek('danger', {\r\n                    data: { headline: this.#t('unauthorized'), message: this.#t('sessionExpired') }\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch snapshots:\", error);\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: this.#t('error'), message: this.#t('failedToFetchSnapshots') }\r\n            });\r\n        } finally {\r\n            this._loading = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fetches the current (live) media file metadata and SAS URL\r\n     */\r\n    private async _fetchCurrentMedia(): Promise<any | null> {\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) return null;\r\n\r\n        try {\r\n            const url = `/umbraco/management/api/v1/snapshot/current/${this._mediaKey}`;\r\n            const response = await fetch(url, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            });\r\n\r\n            if (response.ok) {\r\n                return await response.json();\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to fetch current media:\", error);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Opens the comparison panel for a specific snapshot version\r\n     */\r\n    private async _openComparison(snapshotVersion: any) {\r\n        this._comparisonLoading = true;\r\n        this._comparisonSnapshot = snapshotVersion;\r\n        this._showComparison = true;\r\n        this._sliderPosition = 50;\r\n\r\n        const currentMedia = await this._fetchCurrentMedia();\r\n        this._comparisonCurrent = currentMedia;\r\n        this._comparisonLoading = false;\r\n    }\r\n\r\n    /**\r\n     * Closes the comparison panel\r\n     */\r\n    private _closeComparison() {\r\n        this._showComparison = false;\r\n        this._comparisonSnapshot = null;\r\n        this._comparisonCurrent = null;\r\n    }\r\n\r\n    /**\r\n     * Toggles the comparison mode between side-by-side and slider\r\n     */\r\n    private _toggleComparisonMode() {\r\n        this._comparisonMode = this._comparisonMode === 'side-by-side' ? 'slider' : 'side-by-side';\r\n    }\r\n\r\n    /**\r\n     * Handles the slider input for overlay comparison\r\n     */\r\n    private _onSliderInput(e: Event) {\r\n        const input = e.target as HTMLInputElement;\r\n        this._sliderPosition = parseInt(input.value, 10);\r\n    }\r\n\r\n    /**\r\n     * Handles page change from the pagination component\r\n     */\r\n    private _onPageChange(event: Event) {\r\n        const target = event.target as HTMLElement & { current: number };\r\n        this._currentPage = target.current;\r\n        this._fetchVersions(this._mediaKey);\r\n    }\r\n\r\n    /**\r\n     * Determines the previewable file type from a filename\r\n     */\r\n    private _getFileType(filename: string): 'image' | 'video' | 'audio' | 'pdf' | 'svg' | null {\r\n        const ext = filename.substring(filename.lastIndexOf('.')).toLowerCase();\r\n\r\n        if (['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp'].includes(ext)) return 'image';\r\n        if (ext === '.svg') return 'svg';\r\n        if (ext === '.pdf') return 'pdf';\r\n        if (['.mp4', '.webm', '.ogg', '.mov'].includes(ext)) return 'video';\r\n        if (['.mp3', '.wav', '.ogg', '.aac', '.flac', '.m4a'].includes(ext)) return 'audio';\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Checks if a filename is an image (including SVG) for comparison support\r\n     */\r\n    private _isImage(filename: string): boolean {\r\n        const type = this._getFileType(filename);\r\n        return type === 'image' || type === 'svg';\r\n    }\r\n\r\n    /**\r\n     * Whether a file can be previewed in the side panel\r\n     */\r\n    private _isPreviewable(filename: string): boolean {\r\n        return this._getFileType(filename) !== null;\r\n    }\r\n\r\n    /**\r\n     * Returns the appropriate icon name for a file type\r\n     */\r\n    private _getFileIcon(filename: string): string {\r\n        switch (this._getFileType(filename)) {\r\n            case 'image':\r\n            case 'svg': return 'icon-picture';\r\n            case 'video': return 'icon-video';\r\n            case 'audio': return 'icon-sound-waves';\r\n            case 'pdf': return 'icon-document';\r\n            default: return 'icon-document';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Opens the preview panel for any supported file type\r\n     */\r\n    private _openPreview(version: any) {\r\n        if (!this._isPreviewable(version.name)) return;\r\n\r\n        this._previewImageUrl = version.url;\r\n        this._previewImageName = version.name;\r\n        this._showPreview = true;\r\n    }\r\n\r\n    /**\r\n     * Closes the preview panel\r\n     */\r\n    private _closePreview() {\r\n        this._showPreview = false;\r\n        this._previewImageUrl = null;\r\n        this._previewImageName = '';\r\n    }\r\n\r\n    /**\r\n     * Returns the panel header title based on the current preview file type\r\n     */\r\n    private _getPreviewTitle(): string {\r\n        switch (this._getFileType(this._previewImageName)) {\r\n            case 'image':\r\n            case 'svg': return this.#t('imagePreview');\r\n            case 'video': return this.#t('videoPreview');\r\n            case 'audio': return this.#t('audioPreview');\r\n            case 'pdf': return this.#t('pdfPreview');\r\n            default: return this.#t('filePreview');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Renders the appropriate preview element based on file type\r\n     */\r\n    private _renderPreviewContent() {\r\n        if (!this._previewImageUrl) {\r\n            return html`<uui-loader></uui-loader>`;\r\n        }\r\n\r\n        const fileType = this._getFileType(this._previewImageName);\r\n\r\n        switch (fileType) {\r\n            case 'image':\r\n            case 'svg':\r\n                return html`\r\n                    <img\r\n                        src=\"${this._previewImageUrl}\"\r\n                        alt=\"${this._previewImageName}\"\r\n                        @error=\"${() => {\r\n                            this._notificationContext?.peek('warning', {\r\n                                data: { headline: this.#t('previewError'), message: this.#t('unableToLoadImagePreview') }\r\n                            });\r\n                        }}\"\r\n                    />\r\n                `;\r\n\r\n            case 'video':\r\n                return html`\r\n                    <video\r\n                        controls\r\n                        preload=\"metadata\"\r\n                        class=\"preview-video\"\r\n                        @error=\"${() => {\r\n                            this._notificationContext?.peek('warning', {\r\n                                data: { headline: this.#t('previewError'), message: this.#t('unableToLoadVideoPreview') }\r\n                            });\r\n                        }}\">\r\n                        <source src=\"${this._previewImageUrl}\" />\r\n                        ${this.#t('videoNotSupported')}\r\n                    </video>\r\n                `;\r\n\r\n            case 'audio':\r\n                return html`\r\n                    <div class=\"preview-audio-wrapper\">\r\n                        <uui-icon name=\"icon-sound-waves\" class=\"preview-audio-icon\"></uui-icon>\r\n                        <audio\r\n                            controls\r\n                            preload=\"metadata\"\r\n                            class=\"preview-audio\"\r\n                            @error=\"${() => {\r\n                                this._notificationContext?.peek('warning', {\r\n                                    data: { headline: this.#t('previewError'), message: this.#t('unableToLoadAudioPreview') }\r\n                                });\r\n                            }}\">\r\n                            <source src=\"${this._previewImageUrl}\" />\r\n                            ${this.#t('audioNotSupported')}\r\n                        </audio>\r\n                    </div>\r\n                `;\r\n\r\n            case 'pdf':\r\n                return html`\r\n                    <iframe\r\n                        src=\"${this._previewImageUrl}\"\r\n                        class=\"preview-pdf\"\r\n                        title=\"${this.#t('pdfPreview')}: ${this._previewImageName}\"\r\n                        @error=\"${() => {\r\n                            this._notificationContext?.peek('warning', {\r\n                                data: { headline: this.#t('previewError'), message: this.#t('unableToLoadPdfPreview') }\r\n                            });\r\n                        }}\">\r\n                    </iframe>\r\n                `;\r\n\r\n            default:\r\n                return html`\r\n                    <div class=\"preview-unsupported\">\r\n                        <uui-icon name=\"icon-document\"></uui-icon>\r\n                        <p>${this.#t('previewNotAvailable')}</p>\r\n                    </div>\r\n                `;\r\n        }\r\n    }\r\n\r\n    // --- Selection helpers ---\r\n\r\n    /**\r\n     * Toggles a single snapshot's selection state\r\n     */\r\n    private _toggleSelection(name: string) {\r\n        const updated = new Set(this._selectedSnapshots);\r\n        if (updated.has(name)) {\r\n            updated.delete(name);\r\n        } else {\r\n            updated.add(name);\r\n        }\r\n        this._selectedSnapshots = updated;\r\n    }\r\n\r\n    /**\r\n     * Toggles select-all for the current page (excluding the latest version at index 0)\r\n     */\r\n    private _toggleSelectAll() {\r\n        const pageOffset = (this._currentPage - 1) * this._pageSize;\r\n        const selectableOnPage = this._versions\r\n            .filter((_, i) => (pageOffset + i) !== 0)\r\n            .map(v => v.name);\r\n\r\n        const allSelected = selectableOnPage.every(name => this._selectedSnapshots.has(name));\r\n        const updated = new Set(this._selectedSnapshots);\r\n\r\n        if (allSelected) {\r\n            // Deselect all on this page\r\n            selectableOnPage.forEach(name => updated.delete(name));\r\n        } else {\r\n            // Select all on this page\r\n            selectableOnPage.forEach(name => updated.add(name));\r\n        }\r\n\r\n        this._selectedSnapshots = updated;\r\n    }\r\n\r\n    /**\r\n     * Whether all selectable items on the current page are selected\r\n     */\r\n    private get _allPageSelected(): boolean {\r\n        const pageOffset = (this._currentPage - 1) * this._pageSize;\r\n        const selectableOnPage = this._versions\r\n            .filter((_, i) => (pageOffset + i) !== 0);\r\n        return selectableOnPage.length > 0\r\n            && selectableOnPage.every(v => this._selectedSnapshots.has(v.name));\r\n    }\r\n\r\n    /**\r\n     * Clears all selections\r\n     */\r\n    private _clearSelection() {\r\n        this._selectedSnapshots = new Set();\r\n    }\r\n\r\n    // --- Delete operations ---\r\n\r\n    /**\r\n     * Deletes a single snapshot after confirmation\r\n     */\r\n    private async _deleteSnapshot(version: any) {\r\n        if (this._isDeleting) return;\r\n\r\n        if (!this._modalManagerContext) {\r\n            console.error(\"Modal manager context not available\");\r\n            return;\r\n        }\r\n\r\n        const modalHandler = this._modalManagerContext.open(this, UMB_CONFIRM_MODAL, {\r\n            data: {\r\n                headline: this.#t('deleteSnapshotHeadline'),\r\n                content: html`\r\n                    <p>${this.#t('areYouSureDelete')} <strong>\"${version.name}\"</strong>?</p>\r\n                    <uui-box>\r\n                        <p style=\"margin: 0;\">\r\n                            <uui-icon name=\"icon-alert\"></uui-icon>\r\n                            <strong>${this.#t('warning')}:</strong> ${this.#t('deleteWarning')}\r\n                        </p>\r\n                    </uui-box>\r\n                `,\r\n                color: 'danger',\r\n                confirmLabel: this.#t('delete')\r\n            }\r\n        });\r\n\r\n        try {\r\n            await modalHandler.onSubmit();\r\n        } catch {\r\n            return;\r\n        }\r\n\r\n        this._isDeleting = true;\r\n\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) {\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: this.#t('authError'), message: this.#t('noAuthToken') }\r\n            });\r\n            this._isDeleting = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch(`/umbraco/management/api/v1/snapshot/delete`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    mediaKey: this._mediaKey,\r\n                    snapshotName: version.name\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                const result = await response.json();\r\n                this._notificationContext?.peek('positive', {\r\n                    data: { headline: this.#t('snapshotDeleted'), message: result.message }\r\n                });\r\n                await this._fetchVersions(this._mediaKey);\r\n            } else if (response.status === 401) {\r\n                this._notificationContext?.peek('danger', {\r\n                    data: { headline: this.#t('unauthorized'), message: this.#t('sessionExpired') }\r\n                });\r\n            } else {\r\n                const error = await response.json();\r\n                this._notificationContext?.peek('danger', {\r\n                    data: { headline: this.#t('deleteFailed'), message: error.detail || this.#t('unknownError') }\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to delete snapshot:\", error);\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: this.#t('error'), message: this.#t('errorDeletingSnapshot') }\r\n            });\r\n        } finally {\r\n            this._isDeleting = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Deletes all selected snapshots after confirmation\r\n     */\r\n    private async _bulkDeleteSnapshots() {\r\n        if (this._isDeleting || this._selectedSnapshots.size === 0) return;\r\n\r\n        if (!this._modalManagerContext) {\r\n            console.error(\"Modal manager context not available\");\r\n            return;\r\n        }\r\n\r\n        const count = this._selectedSnapshots.size;\r\n        const modalHandler = this._modalManagerContext.open(this, UMB_CONFIRM_MODAL, {\r\n            data: {\r\n                headline: this.#t('deleteSelectedHeadline'),\r\n                content: html`\r\n                    <p>${this.#t('areYouSureDelete')} <strong>${count} ${count > 1 ? this.#t('snapshots') : this.#t('snapshot')}</strong>?</p>\r\n                    <uui-box>\r\n                        <p style=\"margin: 0;\">\r\n                            <uui-icon name=\"icon-alert\"></uui-icon>\r\n                            <strong>${this.#t('warning')}:</strong> ${this.#t('deleteSelectedWarning')}\r\n                        </p>\r\n                    </uui-box>\r\n                `,\r\n                color: 'danger',\r\n                confirmLabel: `${this.#t('delete')} ${count} ${count > 1 ? this.#t('snapshots') : this.#t('snapshot')}`\r\n            }\r\n        });\r\n\r\n        try {\r\n            await modalHandler.onSubmit();\r\n        } catch {\r\n            return;\r\n        }\r\n\r\n        this._isDeleting = true;\r\n\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) {\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: this.#t('authError'), message: this.#t('noAuthToken') }\r\n            });\r\n            this._isDeleting = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch(`/umbraco/management/api/v1/snapshot/delete-bulk`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    mediaKey: this._mediaKey,\r\n                    snapshotNames: Array.from(this._selectedSnapshots)\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                const result = await response.json();\r\n                this._notificationContext?.peek('positive', {\r\n                    data: { headline: this.#t('snapshotsDeleted'), message: result.message }\r\n                });\r\n                await this._fetchVersions(this._mediaKey);\r\n            } else if (response.status === 401) {\r\n                this._notificationContext?.peek('danger', {\r\n                    data: { headline: this.#t('unauthorized'), message: this.#t('sessionExpired') }\r\n                });\r\n            } else {\r\n                const error = await response.json();\r\n                this._notificationContext?.peek('danger', {\r\n                    data: { headline: this.#t('bulkDeleteFailed'), message: error.detail || this.#t('unknownError') }\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to bulk delete snapshots:\", error);\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: this.#t('error'), message: this.#t('errorDeletingSnapshots') }\r\n            });\r\n        } finally {\r\n            this._isDeleting = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restores a specific snapshot version as the current file\r\n     */\r\n    private async _restoreVersion(version: any) {\r\n        // Prevent multiple simultaneous restore operations\r\n        if (this._isRestoring) {\r\n            console.warn(\"Restore already in progress\");\r\n            return;\r\n        }\r\n\r\n        if (!this._modalManagerContext) {\r\n            console.error(\"Modal manager context not available\");\r\n            return;\r\n        }\r\n\r\n        // Show Umbraco-styled confirmation modal\r\n        const modalHandler = this._modalManagerContext.open(this, UMB_CONFIRM_MODAL, {\r\n            data:\r\n                {\r\n                    headline: this.#t('restoreHeadline'),\r\n                    content: html`\r\n                        <p>${this.#t('areYouSureRestore')} <strong>\"${version.name}\"</strong>?</p>\r\n                        <p>${this.#t('restoreDescription')}</p>\r\n                        <uui-box>\r\n                            <p style=\"margin: 0;\">\r\n                                <uui-icon name=\"icon-alert\"></uui-icon>\r\n                                <strong>${this.#t('warning')}:</strong> ${this.#t('restoreWarning')}\r\n                            </p>\r\n                        </uui-box>\r\n                    `,\r\n                    color: 'danger',\r\n                    confirmLabel: this.#t('restore')\r\n                }\r\n        });\r\n\r\n        // Wait for user to confirm or cancel\r\n        try {\r\n            await modalHandler.onSubmit();\r\n        } catch {\r\n            // User cancelled the modal\r\n            return;\r\n        }\r\n\r\n        // Set the restoring flag\r\n        this._isRestoring = true;\r\n\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) {\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: this.#t('authError'), message: this.#t('noAuthToken') }\r\n            });\r\n            this._isRestoring = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const url = `/umbraco/management/api/v1/snapshot/restore`;\r\n            const response = await fetch(url, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    mediaKey: this._mediaKey,\r\n                    snapshotName: version.name\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                const result = await response.json();\r\n                \r\n                // Use Umbraco notification instead of alert\r\n                this._notificationContext?.peek('positive', {\r\n                    data: { \r\n                        headline: this.#t('snapshotRestored'), \r\n                        message: result.message \r\n                    } \r\n                });\r\n                \r\n                // Refresh the version list\r\n                await this._fetchVersions(this._mediaKey);\r\n            } else if (response.status === 409) {\r\n                this._notificationContext?.peek('warning', {\r\n                    data: { \r\n                        headline: this.#t('restoreInProgress'), \r\n                        message: this.#t('restoreInProgressMessage') \r\n                    } \r\n                });\r\n            } else if (response.status === 401) {\r\n                this._notificationContext?.peek('danger', {\r\n                    data: { \r\n                        headline: this.#t('unauthorized'), \r\n                        message: this.#t('sessionExpired') \r\n                    } \r\n                });\r\n            } else {\r\n                const error = await response.json();\r\n                this._notificationContext?.peek('danger', {\r\n                    data: { \r\n                        headline: this.#t('restoreFailed'), \r\n                        message: error.detail || this.#t('unknownError') \r\n                    } \r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to restore snapshot:\", error);\r\n            this._notificationContext?.peek('danger', {\r\n                data: { \r\n                    headline: this.#t('error'), \r\n                    message: this.#t('errorRestoringSnapshot') \r\n                } \r\n            });\r\n        } finally {\r\n            // Always reset the restoring flag\r\n            this._isRestoring = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Formats a byte count into a human-readable size string\r\n     */\r\n    private _formatSize(bytes: number): string {\r\n        if (bytes === 0) return '0 B';\r\n        const units = ['B', 'KB', 'MB', 'GB'];\r\n        const i = Math.floor(Math.log(bytes) / Math.log(1024));\r\n        return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + units[i];\r\n    }\r\n\r\n    /**\r\n     * Renders a compact inline status badge for a snapshot version\r\n     */\r\n    private _renderStatus(version: any, index: number) {\r\n        const badges = [];\r\n        if (version.isPinned) {\r\n            badges.push(html`<uui-tag class=\"status-badge\" look=\"primary\" color=\"warning\">${this.#t('pinned')}</uui-tag>`);\r\n        }\r\n        if (version.isRestored) {\r\n            badges.push(html`<uui-tag class=\"status-badge\" look=\"primary\" color=\"positive\">${this.#t('restored')}</uui-tag>`);\r\n        }\r\n        if (index === 0) {\r\n            badges.push(html`<uui-tag class=\"status-badge\" look=\"primary\" color=\"default\">${this.#t('latest')}</uui-tag>`);\r\n        }\r\n        return badges;\r\n    }\r\n\r\n    /**\r\n     * Renders the comparison panel content\r\n     */\r\n    private _renderComparison() {\r\n        if (!this._showComparison) return '';\r\n\r\n        const snapshot = this._comparisonSnapshot;\r\n        const current = this._comparisonCurrent;\r\n        const bothAreImages = snapshot && current\r\n            && this._isImage(snapshot.name) && this._isImage(current.name);\r\n\r\n        return html`\r\n            <div class=\"preview-overlay\" @click=\"${this._closeComparison}\"></div>\r\n            <div class=\"comparison-panel\">\r\n                <div class=\"preview-header\">\r\n                    <h3>\r\n                        <uui-icon name=\"icon-split\"></uui-icon>\r\n                        ${this.#t('compareVersions')}\r\n                    </h3>\r\n                    <div style=\"display: flex; gap: 8px; align-items: center;\">\r\n                        ${bothAreImages ? html`\r\n                            <uui-button\r\n                                look=\"secondary\"\r\n                                compact\r\n                                @click=\"${this._toggleComparisonMode}\"\r\n                                title=\"${this.#t('toggleComparisonMode')}\">\r\n                                <uui-icon name=\"${this._comparisonMode === 'side-by-side' ? 'icon-layers-alt' : 'icon-split'}\"></uui-icon>\r\n                                ${this._comparisonMode === 'side-by-side' ? this.#t('slider') : this.#t('sideBySide')}\r\n                            </uui-button>\r\n                        ` : ''}\r\n                        <uui-button\r\n                            look=\"secondary\"\r\n                            compact\r\n                            @click=\"${this._closeComparison}\">\r\n                            <uui-icon name=\"icon-delete\"></uui-icon>\r\n                        </uui-button>\r\n                    </div>\r\n                </div>\r\n                <div class=\"comparison-content\">\r\n                    ${this._comparisonLoading\r\n                        ? html`<div class=\"loader\"><uui-loader></uui-loader> ${this.#t('loadingCurrentFile')}</div>`\r\n                        : !current\r\n                            ? html`<uui-box><p>${this.#t('unableToLoadCurrent')}</p></uui-box>`\r\n                            : bothAreImages\r\n                                ? this._renderImageComparison(current, snapshot)\r\n                                : this._renderMetadataComparison(current, snapshot)\r\n                    }\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Renders a side-by-side or slider image comparison\r\n     */\r\n    private _renderImageComparison(current: any, snapshot: any) {\r\n        if (this._comparisonMode === 'slider') {\r\n            return html`\r\n                <div class=\"slider-comparison\">\r\n                    <div class=\"slider-container\">\r\n                        <img class=\"slider-img-under\" src=\"${current.url}\" alt=\"${this.#t('current')}\" />\r\n                        <div class=\"slider-img-over\" style=\"width: ${this._sliderPosition}%;\">\r\n                            <img src=\"${snapshot.url}\" alt=\"${this.#t('snapshot')}\" />\r\n                        </div>\r\n                        <div class=\"slider-handle\" style=\"left: ${this._sliderPosition}%;\">\r\n                            <div class=\"slider-handle-line\"></div>\r\n                        </div>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"0\"\r\n                            max=\"100\"\r\n                            .value=\"${String(this._sliderPosition)}\"\r\n                            @input=\"${this._onSliderInput}\"\r\n                            class=\"slider-range\"\r\n                        />\r\n                    </div>\r\n                    <div class=\"slider-labels\">\r\n                        <span><uui-tag look=\"primary\" color=\"default\">${this.#t('snapshot')}</uui-tag> ${snapshot.name}</span>\r\n                        <span><uui-tag look=\"primary\" color=\"positive\">${this.#t('current')}</uui-tag> ${current.name}</span>\r\n                    </div>\r\n                </div>\r\n                ${this._renderMetadataComparison(current, snapshot)}\r\n            `;\r\n        }\r\n\r\n        return html`\r\n            <div class=\"side-by-side\">\r\n                <div class=\"compare-column\">\r\n                    <div class=\"compare-label\">\r\n                        <uui-tag look=\"primary\" color=\"default\">${this.#t('snapshot')}</uui-tag>\r\n                        <span class=\"compare-filename\">${snapshot.name}</span>\r\n                    </div>\r\n                    <div class=\"compare-image-container\">\r\n                        <img src=\"${snapshot.url}\" alt=\"${snapshot.name}\" />\r\n                    </div>\r\n                </div>\r\n                <div class=\"compare-divider\"></div>\r\n                <div class=\"compare-column\">\r\n                    <div class=\"compare-label\">\r\n                        <uui-tag look=\"primary\" color=\"positive\">${this.#t('current')}</uui-tag>\r\n                        <span class=\"compare-filename\">${current.name}</span>\r\n                    </div>\r\n                    <div class=\"compare-image-container\">\r\n                        <img src=\"${current.url}\" alt=\"${current.name}\" />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            ${this._renderMetadataComparison(current, snapshot)}\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Renders a metadata diff table comparing the snapshot and current file\r\n     */\r\n    private _renderMetadataComparison(current: any, snapshot: any) {\r\n        const sizeDiff = current.size - snapshot.size;\r\n        const sizeDiffLabel = sizeDiff > 0\r\n            ? `+${this._formatSize(sizeDiff)}`\r\n            : sizeDiff < 0\r\n                ? `-${this._formatSize(Math.abs(sizeDiff))}`\r\n                : this.#t('noChange');\r\n\r\n        return html`\r\n            <div class=\"metadata-comparison\">\r\n                <h4>${this.#t('fileDetails')}</h4>\r\n                <uui-table>\r\n                    <uui-table-head>\r\n                        <uui-table-head-cell>${this.#t('property')}</uui-table-head-cell>\r\n                        <uui-table-head-cell>${this.#t('snapshot')}</uui-table-head-cell>\r\n                        <uui-table-head-cell>${this.#t('current')}</uui-table-head-cell>\r\n                        <uui-table-head-cell>${this.#t('difference')}</uui-table-head-cell>\r\n                    </uui-table-head>\r\n                    <uui-table-row>\r\n                        <uui-table-cell><strong>${this.#t('filename')}</strong></uui-table-cell>\r\n                        <uui-table-cell>${snapshot.name}</uui-table-cell>\r\n                        <uui-table-cell>${current.name}</uui-table-cell>\r\n                        <uui-table-cell>\r\n                            ${snapshot.name === current.name\r\n                                ? html`<uui-tag look=\"secondary\" color=\"default\">${this.#t('same')}</uui-tag>`\r\n                                : html`<uui-tag look=\"primary\" color=\"warning\">${this.#t('changed')}</uui-tag>`\r\n                            }\r\n                        </uui-table-cell>\r\n                    </uui-table-row>\r\n                    <uui-table-row>\r\n                        <uui-table-cell><strong>${this.#t('fileSize')}</strong></uui-table-cell>\r\n                        <uui-table-cell>${this._formatSize(snapshot.size)}</uui-table-cell>\r\n                        <uui-table-cell>${this._formatSize(current.size)}</uui-table-cell>\r\n                        <uui-table-cell>\r\n                            <uui-tag look=\"secondary\" color=\"${sizeDiff === 0 ? 'default' : sizeDiff > 0 ? 'warning' : 'positive'}\">\r\n                                ${sizeDiffLabel}\r\n                            </uui-tag>\r\n                        </uui-table-cell>\r\n                    </uui-table-row>\r\n                    <uui-table-row>\r\n                        <uui-table-cell><strong>${this.#t('date')}</strong></uui-table-cell>\r\n                        <uui-table-cell>${this._formatDate(snapshot.date)}</uui-table-cell>\r\n                        <uui-table-cell>${this._formatDate(current.lastModified)}</uui-table-cell>\r\n                        <uui-table-cell></uui-table-cell>\r\n                    </uui-table-row>\r\n                    ${snapshot.uploader ? html`\r\n                        <uui-table-row>\r\n                            <uui-table-cell><strong>${this.#t('uploadedBy')}</strong></uui-table-cell>\r\n                            <uui-table-cell>${snapshot.uploader.replace(/_/g, ' ')}</uui-table-cell>\r\n                            <uui-table-cell>—</uui-table-cell>\r\n                            <uui-table-cell></uui-table-cell>\r\n                        </uui-table-row>\r\n                    ` : ''}\r\n                </uui-table>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Renders a compact summary stats strip for this media item's snapshots\r\n     */\r\n    private _renderStats() {\r\n        if (this._totalCount === 0) return '';\r\n\r\n        return html`\r\n            <div class=\"stats-strip\">\r\n                <div class=\"stats-strip-item\">\r\n                    <uui-icon name=\"icon-documents\"></uui-icon>\r\n                    <span class=\"stats-strip-value\">${this._totalCount}</span>\r\n                    <span class=\"stats-strip-label\">${this._totalCount !== 1 ? this.#t('snapshots') : this.#t('snapshot')}</span>\r\n                </div>\r\n                <div class=\"stats-strip-divider\"></div>\r\n                <div class=\"stats-strip-item\">\r\n                    <uui-icon name=\"icon-server\"></uui-icon>\r\n                    <span class=\"stats-strip-value\">${this._formatSize(this._totalSizeBytes)}</span>\r\n                    <span class=\"stats-strip-label\">${this.#t('totalSize')}</span>\r\n                </div>\r\n                <div class=\"stats-strip-divider\"></div>\r\n                <div class=\"stats-strip-item\">\r\n                    <uui-icon name=\"icon-calendar\"></uui-icon>\r\n                    <span class=\"stats-strip-value\">${this._oldestDate ? this._formatDate(this._oldestDate) : '—'}</span>\r\n                    <span class=\"stats-strip-label\">${this.#t('oldest')}</span>\r\n                </div>\r\n                <div class=\"stats-strip-divider\"></div>\r\n                <div class=\"stats-strip-item\">\r\n                    <uui-icon name=\"icon-calendar\"></uui-icon>\r\n                    <span class=\"stats-strip-value\">${this._newestDate ? this._formatDate(this._newestDate) : '—'}</span>\r\n                    <span class=\"stats-strip-label\">${this.#t('latest')}</span>\r\n                </div>\r\n                <div class=\"stats-strip-divider\"></div>\r\n                <div class=\"stats-strip-item\">\r\n                    <uui-icon name=\"icon-users\"></uui-icon>\r\n                    <span class=\"stats-strip-value\">${this._uniqueUploaderCount}</span>\r\n                    <span class=\"stats-strip-label\">${this._uniqueUploaderCount !== 1 ? this.#t('contributors') : this.#t('contributor')}</span>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    render() {\r\n        if (this._loading) {\r\n            return html`<div class=\"loader\"><uui-loader></uui-loader> ${this.#t('fetchingSnapshots')}</div>`;\r\n        }\r\n\r\n        if (this._versions.length === 0) {\r\n            return html`\r\n                <uui-box>\r\n                    <div style=\"display: flex; align-items: center; gap: var(--uui-size-space-3);\">\r\n                        <uui-icon name=\"info\" style=\"color: var(--uui-color-primary);\"></uui-icon>\r\n                        <span>${this.#t('noVersionsFound')}</span>\r\n                    </div>\r\n                </uui-box>\r\n            `;\r\n        }\r\n\r\n        const isSingleVersion = this._versions.length === 1 && this._totalCount === 1;\r\n        const pageOffset = (this._currentPage - 1) * this._pageSize;\r\n        const hasSelection = this._selectedSnapshots.size > 0;\r\n\r\n        return html`\r\n            <div class=\"snapshot-container\">\r\n\r\n                <!-- Summary stats for this media item -->\r\n                ${this._renderStats()}\r\n\r\n                <!-- Bulk action toolbar -->\r\n                ${hasSelection ? html`\r\n                    <div class=\"bulk-toolbar\">\r\n                        <span class=\"bulk-toolbar-count\">\r\n                            <uui-icon name=\"icon-check\"></uui-icon>\r\n                            ${this._selectedSnapshots.size} ${this._selectedSnapshots.size > 1 ? this.#t('snapshots') : this.#t('snapshot')} ${this.#t('selected')}\r\n                        </span>\r\n                        <div class=\"bulk-toolbar-actions\">\r\n                            <uui-button\r\n                                look=\"secondary\"\r\n                                compact\r\n                                @click=\"${this._clearSelection}\">\r\n                                ${this.#t('clearSelection')}\r\n                            </uui-button>\r\n                            <uui-button\r\n                                look=\"primary\"\r\n                                color=\"danger\"\r\n                                compact\r\n                                ?disabled=\"${this._isDeleting}\"\r\n                                @click=\"${this._bulkDeleteSnapshots}\">\r\n                                <uui-icon name=\"icon-trash\"></uui-icon>\r\n                                ${this._isDeleting ? this.#t('deleting') : `${this.#t('delete')} ${this._selectedSnapshots.size} ${this._selectedSnapshots.size > 1 ? this.#t('snapshots') : this.#t('snapshot')}`}\r\n                            </uui-button>\r\n                        </div>\r\n                    </div>\r\n                ` : ''}\r\n\r\n                <uui-table>\r\n                    <uui-table-head>\r\n                        <uui-table-head-cell style=\"width: 40px;\">\r\n                            <input\r\n                                type=\"checkbox\"\r\n                                .checked=\"${this._allPageSelected}\"\r\n                                @change=\"${this._toggleSelectAll}\"\r\n                                title=\"${this.#t('selectAllOnPage')}\"\r\n                                class=\"select-checkbox\"\r\n                            />\r\n                        </uui-table-head-cell>\r\n                        <uui-table-head-cell>${this.#t('version')}</uui-table-head-cell>\r\n                        <uui-table-head-cell>${this.#t('uploaded')}</uui-table-head-cell>\r\n                        <uui-table-head-cell style=\"text-align: right;\">${this.#t('actions')}</uui-table-head-cell>\r\n                    </uui-table-head>\r\n\r\n                    ${this._versions.map((v, i) => {\r\n                        const globalIndex = pageOffset + i;\r\n                        const isLatest = globalIndex === 0;\r\n                        const isSelected = this._selectedSnapshots.has(v.name);\r\n\r\n                        return html`\r\n                            <uui-table-row class=\"${isSelected ? 'row-selected' : ''}\">\r\n                                <uui-table-cell style=\"width: 40px;\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        .checked=\"${isSelected}\"\r\n                                        ?disabled=\"${isLatest}\"\r\n                                        @change=\"${() => this._toggleSelection(v.name)}\"\r\n                                        title=\"${isLatest ? this.#t('cannotSelectLatest') : this.#t('selectThisSnapshot')}\"\r\n                                        class=\"select-checkbox\"\r\n                                    />\r\n                                </uui-table-cell>\r\n\r\n                                <!-- Version: filename + status badge + note -->\r\n                                <uui-table-cell>\r\n                                    <div class=\"version-cell\">\r\n                                        <div class=\"version-cell-primary\">\r\n                                            ${this._isPreviewable(v.name)\r\n                                                ? html`\r\n                                                    <button\r\n                                                        class=\"filename-link\"\r\n                                                        @click=\"${() => this._openPreview(v)}\"\r\n                                                        title=\"${this.#t('clickToPreview')}\">\r\n                                                        <uui-icon name=\"${this._getFileIcon(v.name)}\"></uui-icon>\r\n                                                        ${v.name}\r\n                                                    </button>\r\n                                                `\r\n                                                : html`<span class=\"filename-text\"><uui-icon name=\"icon-document\"></uui-icon> ${v.name}</span>`\r\n                                            }\r\n                                            ${this._renderStatus(v, globalIndex)}\r\n                                        </div>\r\n                                        <div class=\"version-cell-secondary\">\r\n                                            ${this._renderNoteCell(v)}\r\n                                        </div>\r\n                                    </div>\r\n                                </uui-table-cell>\r\n\r\n                                <!-- Uploaded: date + uploader stacked -->\r\n                                <uui-table-cell>\r\n                                    <div class=\"upload-cell\">\r\n                                        <span class=\"upload-date\">${this._formatDate(v.date)}</span>\r\n                                        <span class=\"upload-user\">${v.uploader.replace(/_/g, ' ')}</span>\r\n                                    </div>\r\n                                </uui-table-cell>\r\n\r\n                                <!-- Actions: icon-only buttons -->\r\n                                <uui-table-cell>\r\n                                    <div class=\"actions-cell\">\r\n                                        <uui-button\r\n                                            look=\"secondary\"\r\n                                            compact\r\n                                            ?disabled=\"${isLatest}\"\r\n                                            title=\"${isLatest ? this.#t('thisIsLatest') : this.#t('compareWithCurrent')}\"\r\n                                            @click=\"${() => this._openComparison(v)}\">\r\n                                            <uui-icon name=\"icon-split\"></uui-icon>\r\n                                        </uui-button>\r\n                                        <uui-button\r\n                                            look=\"secondary\"\r\n                                            compact\r\n                                            href=\"${v.url}\"\r\n                                            target=\"_blank\"\r\n                                            title=\"${this.#t('downloadThisVersion')}\">\r\n                                            <uui-icon name=\"icon-download-alt\"></uui-icon>\r\n                                        </uui-button>\r\n                                        <uui-button\r\n                                            look=\"${v.isPinned ? 'primary' : 'secondary'}\"\r\n                                            color=\"${v.isPinned ? 'warning' : 'default'}\"\r\n                                            compact\r\n                                            ?disabled=\"${this._togglingPin === v.name}\"\r\n                                            title=\"${v.isPinned ? this.#t('unpinAllow') : this.#t('pinProtect')}\"\r\n                                            @click=\"${() => this._togglePin(v)}\">\r\n                                            <uui-icon name=\"icon-pin-location\"></uui-icon>\r\n                                        </uui-button>\r\n                                        <uui-button\r\n                                            look=\"primary\"\r\n                                            color=\"positive\"\r\n                                            compact\r\n                                            ?disabled=\"${isSingleVersion || this._isRestoring || isLatest}\"\r\n                                            title=\"${isSingleVersion ? this.#t('cannotRestoreSingleVersion') : isLatest ? this.#t('alreadyLatest') : this.#t('restoreThisVersion')}\"\r\n                                            @click=\"${() => this._restoreVersion(v)}\">\r\n                                            <uui-icon name=\"icon-refresh\"></uui-icon>\r\n                                        </uui-button>\r\n                                        <uui-button\r\n                                            look=\"secondary\"\r\n                                            color=\"danger\"\r\n                                            compact\r\n                                            ?disabled=\"${isLatest || this._isDeleting || v.isPinned}\"\r\n                                            title=\"${v.isPinned ? this.#t('unpinBeforeDeleting') : isLatest ? this.#t('cannotDeleteLatest') : this.#t('deleteThisSnapshot')}\"\r\n                                            @click=\"${() => this._deleteSnapshot(v)}\">\r\n                                            <uui-icon name=\"icon-trash\"></uui-icon>\r\n                                        </uui-button>\r\n                                    </div>\r\n                                </uui-table-cell>\r\n                            </uui-table-row>\r\n                        `;\r\n                    })}\r\n                </uui-table>\r\n\r\n                ${this._totalPages > 1 ? html`\r\n                    <div class=\"pagination-container\">\r\n                        <uui-pagination\r\n                            .current=\"${this._currentPage}\"\r\n                            .total=\"${this._totalPages}\"\r\n                            @change=\"${this._onPageChange}\">\r\n                        </uui-pagination>\r\n                    </div>\r\n                ` : ''}\r\n\r\n                <!-- File Preview Side Panel -->\r\n                ${this._showPreview ? html`\r\n                    <div class=\"preview-overlay\" @click=\"${this._closePreview}\"></div>\r\n                    <div class=\"preview-panel\">\r\n                        <div class=\"preview-header\">\r\n                            <h3>\r\n                                <uui-icon name=\"${this._getFileIcon(this._previewImageName)}\"></uui-icon>\r\n                                ${this._getPreviewTitle()}\r\n                            </h3>\r\n                            <uui-button\r\n                                look=\"secondary\"\r\n                                compact\r\n                                @click=\"${this._closePreview}\">\r\n                                <uui-icon name=\"icon-delete\"></uui-icon>\r\n                            </uui-button>\r\n                        </div>\r\n                        <div class=\"preview-content\">\r\n                            <div class=\"preview-filename\">\r\n                                <strong>${this.#t('filename')}:</strong> <br/>${this._previewImageName}\r\n                            </div>\r\n                            <div class=\"preview-media-container\">\r\n                                ${this._renderPreviewContent()}\r\n                            </div>\r\n                            <div class=\"preview-actions\">\r\n                                <uui-button\r\n                                    look=\"primary\"\r\n                                    href=\"${this._previewImageUrl}\"\r\n                                    target=\"_blank\">\r\n                                    <uui-icon name=\"icon-out\"></uui-icon> ${this.#t('openInNewTab')}\r\n                                </uui-button>\r\n                                <uui-button\r\n                                    look=\"secondary\"\r\n                                    href=\"${this._previewImageUrl}\"\r\n                                    download=\"${this._previewImageName}\">\r\n                                    <uui-icon name=\"icon-download-alt\"></uui-icon> ${this.#t('download')}\r\n                                </uui-button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ` : ''}\r\n\r\n                <!-- Comparison Panel -->\r\n                ${this._renderComparison()}\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    private _formatDate(dateString: string) {\r\n        const date = new Date(dateString);\r\n        return date.toLocaleDateString(undefined, {\r\n            day: '2-digit',\r\n            month: 'short',\r\n            year: 'numeric',\r\n            hour: '2-digit',\r\n            minute: '2-digit'\r\n        });\r\n    }\r\n\r\n    // --- Note operations ---\r\n\r\n    /**\r\n     * Enters inline edit mode for a snapshot's note\r\n     */\r\n    private _startEditNote(version: any) {\r\n        this._editingNoteName = version.name;\r\n        this._editingNoteValue = version.note || '';\r\n    }\r\n\r\n    /**\r\n     * Cancels note editing\r\n     */\r\n    private _cancelEditNote() {\r\n        this._editingNoteName = null;\r\n        this._editingNoteValue = '';\r\n    }\r\n\r\n    /**\r\n     * Saves the note to the snapshot's blob metadata\r\n     */\r\n    private async _saveNote(version: any) {\r\n        if (this._savingNote) return;\r\n\r\n        this._savingNote = true;\r\n\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) {\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: this.#t('authError'), message: this.#t('noAuthToken') }\r\n            });\r\n            this._savingNote = false;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch('/umbraco/management/api/v1/snapshot/update-note', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    mediaKey: this._mediaKey,\r\n                    snapshotName: version.name,\r\n                    note: this._editingNoteValue\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                // Update the local version object so the UI reflects the change immediately\r\n                version.note = this._editingNoteValue.trim() || null;\r\n                this._editingNoteName = null;\r\n                this._editingNoteValue = '';\r\n                this.requestUpdate();\r\n            } else {\r\n                const error = await response.json();\r\n                this._notificationContext?.peek('danger', {\r\n                    data: { headline: this.#t('saveFailed'), message: error.detail || this.#t('failedToSaveNote') }\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to save note:\", error);\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: this.#t('error'), message: this.#t('errorSavingNote') }\r\n            });\r\n        } finally {\r\n            this._savingNote = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handles keydown in the note input — Enter saves, Escape cancels\r\n     */\r\n    private _onNoteKeydown(e: KeyboardEvent, version: any) {\r\n        if (e.key === 'Enter') {\r\n            e.preventDefault();\r\n            this._saveNote(version);\r\n        } else if (e.key === 'Escape') {\r\n            this._cancelEditNote();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Renders the note cell for a snapshot row\r\n     */\r\n    private _renderNoteCell(version: any) {\r\n        const isEditing = this._editingNoteName === version.name;\r\n\r\n        if (isEditing) {\r\n            return html`\r\n                <div class=\"note-edit\">\r\n                    <input\r\n                        type=\"text\"\r\n                        class=\"note-input\"\r\n                        maxlength=\"500\"\r\n                        placeholder=\"${this.#t('addNotePlaceholder')}\"\r\n                        .value=\"${this._editingNoteValue}\"\r\n                        @input=\"${(e: Event) => this._editingNoteValue = (e.target as HTMLInputElement).value}\"\r\n                        @keydown=\"${(e: KeyboardEvent) => this._onNoteKeydown(e, version)}\"\r\n                    />\r\n                    <div class=\"note-edit-actions\">\r\n                        <uui-button\r\n                            look=\"primary\"\r\n                            compact\r\n                            ?disabled=\"${this._savingNote}\"\r\n                            @click=\"${() => this._saveNote(version)}\">\r\n                            <uui-icon name=\"icon-check\"></uui-icon>\r\n                        </uui-button>\r\n                        <uui-button\r\n                            look=\"secondary\"\r\n                            compact\r\n                            @click=\"${this._cancelEditNote}\">\r\n                            <uui-icon name=\"icon-delete\"></uui-icon>\r\n                        </uui-button>\r\n                    </div>\r\n                </div>\r\n            `;\r\n        }\r\n\r\n        if (version.note) {\r\n            return html`\r\n                <button class=\"note-display\" @click=\"${() => this._startEditNote(version)}\" title=\"${this.#t('clickToEditNote')}\">\r\n                    <uui-icon name=\"icon-edit\"></uui-icon>\r\n                    <span class=\"note-text\">${version.note}</span>\r\n                </button>\r\n            `;\r\n        }\r\n\r\n        return html`\r\n            <button class=\"note-add\" @click=\"${() => this._startEditNote(version)}\" title=\"${this.#t('addNoteTitle')}\">\r\n                <uui-icon name=\"icon-edit\"></uui-icon> ${this.#t('addNote')}\r\n            </button>\r\n        `;\r\n    }\r\n\r\n    // --- Pin operations ---\r\n\r\n    /**\r\n     * Toggles the pinned state of a snapshot\r\n     */\r\n    private async _togglePin(version: any) {\r\n        if (this._togglingPin) return;\r\n\r\n        this._togglingPin = version.name;\r\n\r\n        const token = await this._authContext?.getLatestToken();\r\n        if (!token) {\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: this.#t('authError'), message: this.#t('noAuthToken') }\r\n            });\r\n            this._togglingPin = null;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch('/umbraco/management/api/v1/snapshot/toggle-pin', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    mediaKey: this._mediaKey,\r\n                    snapshotName: version.name\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                const result = await response.json();\r\n                version.isPinned = result.isPinned;\r\n                this.requestUpdate();\r\n                this._notificationContext?.peek('positive', {\r\n                    data: { headline: result.isPinned ? this.#t('snapshotPinned') : this.#t('snapshotUnpinned'), message: result.message }\r\n                });\r\n            } else {\r\n                const error = await response.json();\r\n                this._notificationContext?.peek('danger', {\r\n                    data: { headline: this.#t('pinFailed'), message: error.detail || this.#t('errorTogglingPin') }\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to toggle pin:\", error);\r\n            this._notificationContext?.peek('danger', {\r\n                data: { headline: this.#t('error'), message: this.#t('errorTogglingPin') }\r\n            });\r\n        } finally {\r\n            this._togglingPin = null;\r\n        }\r\n    }\r\n\r\n    static styles = css`\r\n        :host {\r\n            display: block;\r\n            margin-bottom: 20px;\r\n        }\r\n\r\n        .snapshot-container {\r\n            position: relative;\r\n        }\r\n        \r\n        .loader {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 10px;\r\n            padding: 20px;\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        uui-table {\r\n            border: 1px solid var(--uui-color-border);\r\n            border-radius: var(--uui-border-radius);\r\n            background: var(--uui-color-surface);\r\n        }\r\n\r\n        uui-table-head-cell {\r\n            font-weight: bold;\r\n        }\r\n\r\n        uui-icon {\r\n            margin-right: 4px;\r\n        }\r\n\r\n        .filename-link {\r\n            background: none;\r\n            border: none;\r\n            color: var(--uui-color-interactive);\r\n            cursor: pointer;\r\n            padding: 0;\r\n            font: inherit;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n            text-decoration: underline;\r\n            transition: color 0.2s;\r\n        }\r\n\r\n        .filename-link:hover {\r\n            color: var(--uui-color-interactive-emphasis);\r\n        }\r\n\r\n        .filename-link uui-icon {\r\n            margin-right: 4px;\r\n            color: var(--uui-color-primary);\r\n        }\r\n\r\n        /* Selection checkbox */\r\n        .select-checkbox {\r\n            cursor: pointer;\r\n            width: 16px;\r\n            height: 16px;\r\n            accent-color: var(--uui-color-interactive);\r\n        }\r\n\r\n        .select-checkbox:disabled {\r\n            cursor: not-allowed;\r\n            opacity: 0.3;\r\n        }\r\n\r\n        /* Selected row highlight */\r\n        .row-selected {\r\n            background-color: color-mix(in srgb, var(--uui-color-selected) 10%, transparent);\r\n        }\r\n\r\n        /* Bulk action toolbar */\r\n        .bulk-toolbar {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            padding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n            margin-bottom: var(--uui-size-space-3);\r\n            background: color-mix(in srgb, var(--uui-color-selected) 8%, var(--uui-color-surface));\r\n            border: 1px solid var(--uui-color-selected);\r\n            border-radius: var(--uui-border-radius);\r\n            animation: fadeIn 0.2s ease-in;\r\n        }\r\n\r\n        .bulk-toolbar-count {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n            font-weight: 600;\r\n            color: var(--uui-color-selected);\r\n        }\r\n\r\n        .bulk-toolbar-actions {\r\n            display: flex;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        /* Pagination Styles */\r\n        .pagination-container {\r\n            display: flex;\r\n            justify-content: center;\r\n            padding: var(--uui-size-space-5) 0;\r\n        }\r\n\r\n        /* Preview Panel Styles */\r\n        .preview-overlay {\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            background: rgba(0, 0, 0, 0.5);\r\n            z-index: 1000;\r\n            animation: fadeIn 0.2s ease-in;\r\n        }\r\n\r\n        @keyframes fadeIn {\r\n            from { opacity: 0; }\r\n            to { opacity: 1; }\r\n        }\r\n\r\n        @keyframes slideIn {\r\n            from { transform: translateX(100%); }\r\n            to { transform: translateX(0); }\r\n        }\r\n\r\n        .preview-panel {\r\n            position: fixed;\r\n            top: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            width: 500px;\r\n            max-width: 90vw;\r\n            background: var(--uui-color-surface);\r\n            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);\r\n            z-index: 1001;\r\n            display: flex;\r\n            flex-direction: column;\r\n            animation: slideIn 0.3s ease-out;\r\n        }\r\n\r\n        .preview-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            padding: var(--uui-size-space-5);\r\n            border-bottom: 1px solid var(--uui-color-border);\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .preview-header h3 {\r\n            margin: 0;\r\n            font-size: 1.2rem;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .preview-content {\r\n            flex: 1;\r\n            overflow-y: auto;\r\n            padding: var(--uui-size-space-5);\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-4);\r\n        }\r\n\r\n        .preview-filename {\r\n            padding: var(--uui-size-space-3);\r\n            background: var(--uui-color-surface-alt);\r\n            border-radius: var(--uui-border-radius);\r\n            word-break: break-all;\r\n        }\r\n\r\n        /* Preview media container — shared wrapper for all file types */\r\n        .preview-media-container {\r\n            flex: 1;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            background: var(--uui-color-surface-alt);\r\n            border-radius: var(--uui-border-radius);\r\n            padding: var(--uui-size-space-4);\r\n            min-height: 200px;\r\n            overflow: hidden;\r\n        }\r\n\r\n        .preview-media-container img {\r\n            max-width: 100%;\r\n            max-height: 60vh;\r\n            object-fit: contain;\r\n            border-radius: var(--uui-border-radius);\r\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n        }\r\n\r\n        /* Video preview */\r\n        .preview-video {\r\n            max-width: 100%;\r\n            max-height: 60vh;\r\n            border-radius: var(--uui-border-radius);\r\n            background: #000;\r\n        }\r\n\r\n        /* Audio preview */\r\n        .preview-audio-wrapper {\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-5);\r\n            padding: var(--uui-size-space-6);\r\n            width: 100%;\r\n        }\r\n\r\n        .preview-audio-icon {\r\n            font-size: 4rem;\r\n            color: var(--uui-color-primary);\r\n            opacity: 0.6;\r\n        }\r\n\r\n        .preview-audio {\r\n            width: 100%;\r\n            max-width: 400px;\r\n        }\r\n\r\n        /* PDF preview */\r\n        .preview-pdf {\r\n            width: 100%;\r\n            height: 60vh;\r\n            border: none;\r\n            border-radius: var(--uui-border-radius);\r\n        }\r\n\r\n        /* Unsupported file type */\r\n        .preview-unsupported {\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-3);\r\n            padding: var(--uui-size-space-6);\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        .preview-unsupported uui-icon {\r\n            font-size: 3rem;\r\n            opacity: 0.4;\r\n        }\r\n\r\n        /* Comparison Panel Styles */\r\n        .comparison-panel {\r\n            position: fixed;\r\n            top: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            width: 900px;\r\n            max-width: 95vw;\r\n            background: var(--uui-color-surface);\r\n            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);\r\n            z-index: 1001;\r\n            display: flex;\r\n            flex-direction: column;\r\n            animation: slideIn 0.3s ease-out;\r\n        }\r\n\r\n        .comparison-content {\r\n            flex: 1;\r\n            overflow-y: auto;\r\n            padding: var(--uui-size-space-5);\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-5);\r\n        }\r\n\r\n        /* Side-by-side image layout */\r\n        .side-by-side {\r\n            display: flex;\r\n            gap: var(--uui-size-space-4);\r\n            align-items: flex-start;\r\n        }\r\n\r\n        .compare-column {\r\n            flex: 1;\r\n            min-width: 0;\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-3);\r\n        }\r\n\r\n        .compare-label {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .compare-filename {\r\n            font-size: 0.85rem;\r\n            color: var(--uui-color-text-alt);\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            white-space: nowrap;\r\n        }\r\n\r\n        .compare-image-container {\r\n            background: var(--uui-color-surface-alt);\r\n            border-radius: var(--uui-border-radius);\r\n            padding: var(--uui-size-space-3);\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            min-height: 200px;\r\n            border: 1px solid var(--uui-color-border);\r\n        }\r\n\r\n        .compare-image-container img {\r\n            max-width: 100%;\r\n            max-height: 50vh;\r\n            object-fit: contain;\r\n            border-radius: var(--uui-border-radius);\r\n        }\r\n\r\n        .compare-divider {\r\n            width: 1px;\r\n            align-self: stretch;\r\n            background: var(--uui-color-border);\r\n        }\r\n\r\n        /* Slider comparison */\r\n        .slider-comparison {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-3);\r\n        }\r\n\r\n        .slider-container {\r\n            position: relative;\r\n            overflow: hidden;\r\n            border-radius: var(--uui-border-radius);\r\n            border: 1px solid var(--uui-color-border);\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .slider-img-under {\r\n            display: block;\r\n            width: 100%;\r\n            max-height: 50vh;\r\n            object-fit: contain;\r\n        }\r\n\r\n        .slider-img-over {\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n            bottom: 0;\r\n            overflow: hidden;\r\n        }\r\n\r\n        .slider-img-over img {\r\n            display: block;\r\n            height: 100%;\r\n            max-height: 50vh;\r\n            object-fit: contain;\r\n        }\r\n\r\n        .slider-handle {\r\n            position: absolute;\r\n            top: 0;\r\n            bottom: 0;\r\n            width: 3px;\r\n            background: var(--uui-color-interactive);\r\n            transform: translateX(-50%);\r\n            pointer-events: none;\r\n        }\r\n\r\n        .slider-handle-line {\r\n            position: absolute;\r\n            top: 50%;\r\n            left: 50%;\r\n            transform: translate(-50%, -50%);\r\n            width: 28px;\r\n            height: 28px;\r\n            border-radius: 50%;\r\n            background: var(--uui-color-interactive);\r\n            border: 2px solid var(--uui-color-surface);\r\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\r\n        }\r\n\r\n        .slider-range {\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            opacity: 0;\r\n            cursor: ew-resize;\r\n            margin: 0;\r\n        }\r\n\r\n        .slider-labels {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            font-size: 0.85rem;\r\n        }\r\n\r\n        .slider-labels span {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        /* Metadata diff table */\r\n        .metadata-comparison {\r\n            border-top: 1px solid var(--uui-color-border);\r\n            padding-top: var(--uui-size-space-4);\r\n        }\r\n\r\n        .metadata-comparison h4 {\r\n            margin: 0 0 var(--uui-size-space-3) 0;\r\n            font-size: 1rem;\r\n        }\r\n\r\n        /* Stats strip */\r\n        .stats-strip {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-4);\r\n            padding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n            margin-bottom: var(--uui-size-space-4);\r\n            background: var(--uui-color-surface-alt);\r\n            border: 1px solid var(--uui-color-border);\r\n            border-radius: var(--uui-border-radius);\r\n            flex-wrap: wrap;\r\n        }\r\n\r\n        .stats-strip-item {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .stats-strip-item uui-icon {\r\n            color: var(--uui-color-primary);\r\n            font-size: 0.9rem;\r\n        }\r\n\r\n        .stats-strip-value {\r\n            font-weight: 700;\r\n            font-size: 0.9rem;\r\n        }\r\n\r\n        .stats-strip-label {\r\n            font-size: 0.8rem;\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        .stats-strip-divider {\r\n            width: 1px;\r\n            height: 20px;\r\n            background: var(--uui-color-border);\r\n        }\r\n\r\n        /* Note cell */\r\n        .note-edit {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n        }\r\n\r\n        .note-input {\r\n            flex: 1;\r\n            padding: 4px 8px;\r\n            border: 1px solid var(--uui-color-border);\r\n            border-radius: var(--uui-border-radius);\r\n            font: inherit;\r\n            font-size: 0.85rem;\r\n            min-width: 120px;\r\n            background: var(--uui-color-surface);\r\n            color: var(--uui-color-text);\r\n        }\r\n\r\n        .note-input:focus {\r\n            outline: none;\r\n            border-color: var(--uui-color-interactive);\r\n            box-shadow: 0 0 0 1px var(--uui-color-interactive);\r\n        }\r\n\r\n        .note-edit-actions {\r\n            display: flex;\r\n            gap: 2px;\r\n            flex-shrink: 0;\r\n        }\r\n\r\n        .note-display {\r\n            background: none;\r\n            border: none;\r\n            cursor: pointer;\r\n            padding: 2px 4px;\r\n            font: inherit;\r\n            font-size: 0.85rem;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n            color: var(--uui-color-text);\r\n            border-radius: var(--uui-border-radius);\r\n            transition: background 0.2s;\r\n            max-width: 200px;\r\n        }\r\n\r\n        .note-display:hover {\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .note-display uui-icon {\r\n            color: var(--uui-color-text-alt);\r\n            font-size: 0.75rem;\r\n            flex-shrink: 0;\r\n            opacity: 0;\r\n            transition: opacity 0.2s;\r\n        }\r\n\r\n        .note-display:hover uui-icon {\r\n            opacity: 1;\r\n        }\r\n\r\n        .note-text {\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            white-space: nowrap;\r\n        }\r\n\r\n        .note-add {\r\n            background: none;\r\n            border: none;\r\n            cursor: pointer;\r\n            padding: 2px 4px;\r\n            font: inherit;\r\n            font-size: 0.8rem;\r\n            color: var(--uui-color-text-alt);\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n            opacity: 0.5;\r\n            transition: opacity 0.2s;\r\n        }\r\n\r\n        .note-add:hover {\r\n            opacity: 1;\r\n            color: var(--uui-color-interactive);\r\n        }\r\n\r\n        /* Version cell: stacked filename + note */\r\n        .version-cell {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: 2px;\r\n        }\r\n\r\n        .version-cell-primary {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .version-cell-secondary {\r\n            padding-left: 0;\r\n        }\r\n\r\n        .filename-text {\r\n            font-weight: 500;\r\n        }\r\n\r\n        /* Uploaded date and user */\r\n        .upload-cell {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: 2px;\r\n        }\r\n\r\n        .upload-date {\r\n            font-size: 0.85rem;\r\n        }\r\n\r\n        .upload-user {\r\n            font-size: 0.8rem;\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        /* Actions cell: right-aligned icon buttons */\r\n        .actions-cell {\r\n            display: flex;\r\n            gap: 4px;\r\n            justify-content: flex-end;\r\n        }\r\n\r\n        /* -- Comparison specific styles -- */\r\n        .comparison-panel {\r\n            position: fixed;\r\n            top: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            width: 80%;\r\n            max-width: 1000px;\r\n            background: var(--uui-color-surface);\r\n            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.3);\r\n            z-index: 1100;\r\n            display: flex;\r\n            flex-direction: column;\r\n            animation: slideIn 0.3s ease-out;\r\n        }\r\n\r\n        .comparison-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            padding: var(--uui-size-space-5);\r\n            border-bottom: 1px solid var(--uui-color-border);\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .comparison-header h3 {\r\n            margin: 0;\r\n            font-size: 1.2rem;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .comparison-content {\r\n            flex: 1;\r\n            overflow-y: auto;\r\n            padding: var(--uui-size-space-5);\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: var(--uui-size-space-5);\r\n        }\r\n\r\n        .slider-comparison {\r\n            position: relative;\r\n            height: 400px;\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: 16px;\r\n        }\r\n\r\n        .slider-container {\r\n            position: relative;\r\n            overflow: hidden;\r\n            border-radius: var(--uui-border-radius);\r\n            border: 1px solid var(--uui-color-border);\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .slider-img-under {\r\n            display: block;\r\n            width: 100%;\r\n            max-height: 400px;\r\n            object-fit: contain;\r\n        }\r\n\r\n        .slider-img-over {\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n            bottom: 0;\r\n            overflow: hidden;\r\n        }\r\n\r\n        .slider-img-over img {\r\n            display: block;\r\n            height: 100%;\r\n            max-height: 400px;\r\n            object-fit: contain;\r\n        }\r\n\r\n        .slider-handle {\r\n            position: absolute;\r\n            top: 0;\r\n            bottom: 0;\r\n            width: 3px;\r\n            background: var(--uui-color-interactive);\r\n            transform: translateX(-50%);\r\n            pointer-events: none;\r\n        }\r\n\r\n        .slider-handle-line {\r\n            position: absolute;\r\n            top: 50%;\r\n            left: 50%;\r\n            transform: translate(-50%, -50%);\r\n            width: 28px;\r\n            height: 28px;\r\n            border-radius: 50%;\r\n            background: var(--uui-color-interactive);\r\n            border: 2px solid var(--uui-color-surface);\r\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\r\n        }\r\n\r\n        .slider-range {\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            opacity: 0;\r\n            cursor: ew-resize;\r\n            margin: 0;\r\n        }\r\n\r\n        .slider-labels {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            font-size: 0.85rem;\r\n        }\r\n\r\n        .slider-labels span {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        /* Metadata diff table */\r\n        .metadata-comparison {\r\n            border-top: 1px solid var(--uui-color-border);\r\n            padding-top: var(--uui-size-space-4);\r\n        }\r\n\r\n        .metadata-comparison h4 {\r\n            margin: 0 0 var(--uui-size-space-3) 0;\r\n            font-size: 1rem;\r\n        }\r\n\r\n        /* Stats strip */\r\n        .stats-strip {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-4);\r\n            padding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n            margin-bottom: var(--uui-size-space-4);\r\n            background: var(--uui-color-surface-alt);\r\n            border: 1px solid var(--uui-color-border);\r\n            border-radius: var(--uui-border-radius);\r\n            flex-wrap: wrap;\r\n        }\r\n\r\n        .stats-strip-item {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .stats-strip-item uui-icon {\r\n            color: var(--uui-color-primary);\r\n            font-size: 0.9rem;\r\n        }\r\n\r\n        .stats-strip-value {\r\n            font-weight: 700;\r\n            font-size: 0.9rem;\r\n        }\r\n\r\n        .stats-strip-label {\r\n            font-size: 0.8rem;\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        .stats-strip-divider {\r\n            width: 1px;\r\n            height: 20px;\r\n            background: var(--uui-color-border);\r\n        }\r\n\r\n        /* Note cell */\r\n        .note-edit {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n        }\r\n\r\n        .note-input {\r\n            flex: 1;\r\n            padding: 4px 8px;\r\n            border: 1px solid var(--uui-color-border);\r\n            border-radius: var(--uui-border-radius);\r\n            font: inherit;\r\n            font-size: 0.85rem;\r\n            min-width: 120px;\r\n            background: var(--uui-color-surface);\r\n            color: var(--uui-color-text);\r\n        }\r\n\r\n        .note-input:focus {\r\n            outline: none;\r\n            border-color: var(--uui-color-interactive);\r\n            box-shadow: 0 0 0 1px var(--uui-color-interactive);\r\n        }\r\n\r\n        .note-edit-actions {\r\n            display: flex;\r\n            gap: 2px;\r\n            flex-shrink: 0;\r\n        }\r\n\r\n        .note-display {\r\n            background: none;\r\n            border: none;\r\n            cursor: pointer;\r\n            padding: 2px 4px;\r\n            font: inherit;\r\n            font-size: 0.85rem;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n            color: var(--uui-color-text);\r\n            border-radius: var(--uui-border-radius);\r\n            transition: background 0.2s;\r\n            max-width: 200px;\r\n        }\r\n\r\n        .note-display:hover {\r\n            background: var(--uui-color-surface-alt);\r\n        }\r\n\r\n        .note-display uui-icon {\r\n            color: var(--uui-color-text-alt);\r\n            font-size: 0.75rem;\r\n            flex-shrink: 0;\r\n            opacity: 0;\r\n            transition: opacity 0.2s;\r\n        }\r\n\r\n        .note-display:hover uui-icon {\r\n            opacity: 1;\r\n        }\r\n\r\n        .note-text {\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            white-space: nowrap;\r\n        }\r\n\r\n        .note-add {\r\n            background: none;\r\n            border: none;\r\n            cursor: pointer;\r\n            padding: 2px 4px;\r\n            font: inherit;\r\n            font-size: 0.8rem;\r\n            color: var(--uui-color-text-alt);\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n            opacity: 0.5;\r\n            transition: opacity 0.2s;\r\n        }\r\n\r\n        .note-add:hover {\r\n            opacity: 1;\r\n            color: var(--uui-color-interactive);\r\n        }\r\n\r\n        /* Version cell: stacked filename + note */\r\n        .version-cell {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: 2px;\r\n        }\r\n\r\n        .version-cell-primary {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: var(--uui-size-space-2);\r\n        }\r\n\r\n        .version-cell-secondary {\r\n            padding-left: 0;\r\n        }\r\n\r\n        .filename-text {\r\n            font-weight: 500;\r\n        }\r\n\r\n        /* Uploaded date and user */\r\n        .upload-cell {\r\n            display: flex;\r\n            flex-direction: column;\r\n            gap: 2px;\r\n        }\r\n\r\n        .upload-date {\r\n            font-size: 0.85rem;\r\n        }\r\n\r\n        .upload-user {\r\n            font-size: 0.8rem;\r\n            color: var(--uui-color-text-alt);\r\n        }\r\n\r\n        /* Actions cell: right-aligned icon buttons */\r\n        .actions-cell {\r\n            display: flex;\r\n            gap: 4px;\r\n            justify-content: flex-end;\r\n        }\r\n\r\n        @media (max-width: 768px) {\r\n            .preview-panel {\r\n                width: 100vw;\r\n                max-width: 100vw;\r\n            }\r\n            .comparison-panel {\r\n                width: 100vw;\r\n                max-width: 100vw;\r\n            }\r\n            .side-by-side {\r\n                flex-direction: column;\r\n            }\r\n            .compare-divider {\r\n                width: 100%;\r\n                height: 1px;\r\n            }\r\n            .bulk-toolbar {\r\n                flex-direction: column;\r\n                gap: var(--uui-size-space-3);\r\n                text-align: center;\r\n            }\r\n        }\r\n    `;\r\n}\r\n\r\n// Global declaration for TS intellisense\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'snapshot-viewer': SnapshotViewerElement;\r\n    }\r\n}"],"names":["_localize","_SnapshotViewerElement_instances","t_fn","SnapshotViewerElement","UmbElementMixin","LitElement","__privateAdd","UmbLocalizationController","UMB_AUTH_CONTEXT","instance","UMB_NOTIFICATION_CONTEXT","UMB_MODAL_MANAGER_CONTEXT","UMB_WORKSPACE_CONTEXT","workspaceContext","entityWorkspace","unique","mediaKey","token","__privateMethod","url","response","result","error","snapshotVersion","currentMedia","e","input","event","target","filename","ext","type","version","html","name","updated","pageOffset","selectableOnPage","_","i","v","allSelected","modalHandler","UMB_CONFIRM_MODAL","count","bytes","units","index","badges","snapshot","current","bothAreImages","sizeDiff","sizeDiffLabel","isSingleVersion","hasSelection","globalIndex","isLatest","isSelected","dateString","key","__privateGet","css","__decorateClass","state","customElement"],"mappings":"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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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"}